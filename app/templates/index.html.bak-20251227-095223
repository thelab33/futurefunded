<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <meta name="format-detection" content="telephone=no">

  <!-- SEO -->
  <title>FutureFunded • Fundraiser</title>
  <meta name="description" content="Fuel the season. Fund the future. Donate securely in under a minute with instant email receipts and transparent impact." />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- Social preview -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="FutureFunded" />
  <meta property="og:title" content="Fundraiser • FutureFunded" />
  <meta property="og:description" content="Support the season with secure checkout and instant receipts." />
  <meta property="og:image" content="" id="ffOgImage" />
  <meta property="og:url" content="" id="ffOgUrl" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Fundraiser • FutureFunded" />
  <meta name="twitter:description" content="Support the season with secure checkout and instant receipts." />
  <meta name="twitter:image" content="" id="ffTwImage" />

  <!-- Canonical (set at runtime safely; kept empty for server-side flexibility) -->
  <link rel="canonical" href="" id="ffCanonical" />

  <!-- PWA hooks (safe/optional) -->
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="application-name" content="FutureFunded" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="FutureFunded" />

  <!-- Text-to-donate / QR meta (UNCHANGED) -->
  <meta name="ff-text-to-donate-phone" content="" />
  <meta name="ff-text-to-donate-keyword" content="" />
  <meta name="ff-qr-endpoint" content="" />

  <!-- App endpoints (UNCHANGED) -->
  <meta name="ff-checkout-endpoint" content="/payments/stripe/intent" />
  <meta name="ff-status-endpoint" content="/api/status" />

  <!-- Stripe publishable key (READ ONLY) (UNCHANGED) -->
  <meta name="ff-stripe-pk" content="{{ STRIPE_PUBLISHABLE_KEY }}">
  <meta name="stripe-pk" content="{{ STRIPE_PUBLISHABLE_KEY }}">

  <!-- Stripe.js (UNCHANGED) -->
  <link rel="preconnect" href="https://js.stripe.com" crossorigin>
  <script src="https://js.stripe.com/v3/"></script>

  <!-- Font: Inter (flagship default) (UNCHANGED URL) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Theme colors -->
  <meta name="theme-color" content="#0B1020" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#EEF0F3" media="(prefers-color-scheme: light)" />

  <!-- JSON-LD (populated at runtime) -->
  <script type="application/ld+json" id="ffJsonLd">{}</script>

  <style>
/* ============================================================
  FutureFunded — FLAGSHIP “Elite” CSS (Consolidated)
  - Drop-in compatible: NO id/class renames required
  - Includes: Flagship base + premium add-ons (deduped)
============================================================ */

/* -------------------------
  Reset / Base
------------------------- */
*, *::before, *::after { box-sizing: border-box; }

html{
  -webkit-text-size-adjust: 100%;
  text-rendering: optimizeLegibility;
  scroll-behavior: smooth;
  scroll-padding-top: var(--scroll-offset, 96px);
}

body{
  margin: 0;
  min-height: 100dvh;
  background: var(--bg);
  color: var(--text);
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  line-height: 1.6;
  letter-spacing: -0.01em;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow-x: clip;
}

img, svg, video { display:block; max-width:100%; }
button, input, select, textarea { font: inherit; color: inherit; }
button{ appearance:none; -webkit-appearance:none; }
a{ color: inherit; text-decoration: none; }
p{ margin:0; }
ul, ol{ margin:0; padding-left:1.25rem; }
h1,h2,h3{ margin:0; line-height:1.12; letter-spacing:-0.02em; }
main:focus{ outline:none; }

::selection { background: color-mix(in oklab, var(--primary) 22%, transparent); }
:focus-visible{
  outline: 3px solid color-mix(in oklab, var(--primary) 62%, white 38%);
  outline-offset: 3px;
  border-radius: 12px;
}

@media (prefers-reduced-motion: reduce){
  html{ scroll-behavior:auto; }
  *{
    transition-duration: 0.001ms !important;
    animation-duration: 0.001ms !important;
    animation-iteration-count: 1 !important;
  }
}

/* -------------------------
  Tokens
------------------------- */
:root{
  /* Brand */
  --primary: #C2410C;
  --primary-2: #9A3412;
  --accent: #F97316;
  --accent2: #24c4ff; /* used by flagship gradients */

  /* Layout */
  --container: 1100px;

  /* Spacing */
  --s-1: .35rem;
  --s-2: .6rem;
  --s-3: .95rem;
  --s-4: 1.25rem;
  --s-5: 1.75rem;
  --s-6: 2.25rem;
  --s-7: 3rem;
  --s-8: 4rem;

  /* Radii */
  --r-1: 12px;
  --r-2: 16px;
  --r-3: 22px;

  /* Shadows */
  --sh-1: 0 10px 28px rgba(2, 6, 23, .10);
  --sh-2: 0 18px 58px rgba(2, 6, 23, .14);

  /* Sticky offsets (JS can overwrite) */
  --topbar-h: 0px;
  --header-h: 64px;
  --scroll-offset: calc(var(--topbar-h) + var(--header-h) + 14px);

  /* Enter[rise] polish */
  --ring: color-mix(in oklab, var(--primary) 16%, transparent);
  --glow: color-mix(in oklab, var(--primary) 22%, transparent);
  --elev: color-mix(in oklab, white 26%, transparent);

  /* Aliases for “premium add-on” vars (prevents undefined tokens) */
  --surface: var(--bg2);
  --surface2: var(--card2);
  --border: var(--line);
  --border2: var(--line2);
  --shadow: var(--sh-2);
}

/* -------------------------
  Theme tokens
------------------------- */
:root,
html:not([data-theme]),
html[data-theme="light"]{
  color-scheme: light;

  --bg: #EEF0F3;
  --bg2: #F7F8FA;
  --text: #0B1220;
  --muted: #1F2937;
  --muted2: #64748B;

  --line: rgba(15, 23, 42, .10);
  --line2: rgba(15, 23, 42, .16);

  --card: rgba(255,255,255,.90);
  --card2: rgba(255,255,255,.98);
  --glass: rgba(255,255,255,.72);

  --danger: #B42318;
  --success: #067647;
  --warn: #B54708;

  --sh-1: 0 14px 34px rgba(2, 6, 23, .10);
  --sh-2: 0 22px 70px rgba(2, 6, 23, .14);
}

html[data-theme="dark"]{
  color-scheme: dark;

  --bg: #070A15;
  --bg2: #0B1020;
  --text: #F8FAFC;
  --muted: rgba(255,255,255,.74);
  --muted2: rgba(255,255,255,.56);

  --line: rgba(255,255,255,.10);
  --line2: rgba(255,255,255,.14);

  --card: rgba(255,255,255,.06);
  --card2: rgba(255,255,255,.09);
  --glass: rgba(255,255,255,.07);

  --danger: #fb7185;
  --success: #4ade80;
  --warn: #fbbf24;

  --sh-1: 0 12px 32px rgba(0,0,0,.34);
  --sh-2: 0 22px 70px rgba(0,0,0,.46);

  --elev: rgba(255,255,255,.08);
}

/* -------------------------
  Premium background
------------------------- */
body::before,
body::after{
  content:"";
  position: fixed;
  inset: -20% -10%;
  pointer-events:none;
  z-index:-1;
  filter: blur(34px);
  opacity:.85;
  transform: translateZ(0);
}
body::before{
  background:
    radial-gradient(900px 520px at 14% 10%, color-mix(in oklab, var(--accent) 18%, transparent), transparent 60%),
    radial-gradient(900px 520px at 86% 12%, color-mix(in oklab, var(--primary) 12%, transparent), transparent 64%),
    radial-gradient(700px 420px at 50% 110%, color-mix(in oklab, var(--primary) 10%, transparent), transparent 60%);
}
body::after{
  opacity:.55;
  background:
    radial-gradient(820px 520px at 90% 40%, color-mix(in oklab, var(--accent) 10%, transparent), transparent 62%),
    radial-gradient(820px 520px at 10% 54%, color-mix(in oklab, var(--primary) 10%, transparent), transparent 62%);
}

/* -------------------------
  Utilities
------------------------- */
.container{
  width: min(var(--container), calc(100% - 2*var(--s-4)));
  margin-inline:auto;
}
.measure{ max-width: 70ch; }
.num{ font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1, "ss01" 1; }

.hide-mobile{ display:inline-flex; }
@media (max-width: 920px){ .hide-mobile{ display:none !important; } }

.divider{
  height: 1px;
  background: color-mix(in oklab, var(--line) 100%, transparent);
  margin: var(--s-4) 0;
}

/* Screen-reader only + skip link */
.sr-only{
  position:absolute !important;
  width:1px; height:1px;
  padding:0; margin:-1px;
  overflow:hidden;
  clip: rect(0,0,0,0);
  white-space:nowrap;
  border:0;
}
a.sr-only:focus,
a.sr-only:focus-visible{
  position: fixed !important;
  top: var(--s-3);
  left: var(--s-3);
  width:auto; height:auto;
  clip:auto;
  padding:.7rem 1rem;
  background: var(--card2);
  border: 1px solid var(--line2);
  border-radius: 999px;
  z-index: 9999;
  box-shadow: var(--sh-2);
}

/* -------------------------
  Pills / badges
------------------------- */
.pill{
  display:inline-flex;
  align-items:center;
  gap:.45rem;
  padding:.35rem .65rem;
  border-radius:999px;
  border:1px solid var(--line);
  background: color-mix(in oklab, var(--glass) 92%, transparent);
  color: color-mix(in oklab, var(--muted) 86%, var(--text) 14%);
  font-size:.82rem;
  line-height:1;
  white-space:nowrap;
  box-shadow: 0 1px 0 color-mix(in oklab, white 40%, transparent);
  backdrop-filter: blur(10px);
}
.pill-muted{ opacity:.96; }
.pill-dot{
  width:.45rem; height:.45rem;
  border-radius:999px;
  background: var(--accent);
  box-shadow: 0 0 0 6px color-mix(in oklab, var(--accent) 18%, transparent);
}
.pill-accent{
  border-color: color-mix(in oklab, var(--accent) 46%, var(--line2));
  background: color-mix(in oklab, var(--accent) 14%, var(--glass));
  color: var(--text);
  font-weight: 850;
}
.pill-verified{
  border-color: color-mix(in oklab, var(--success) 45%, var(--line2));
  background: color-mix(in oklab, var(--success) 12%, var(--glass));
  color: var(--text);
  font-weight: 850;
}
.pill-live{
  border-color: color-mix(in oklab, var(--accent) 55%, var(--line2));
  background: color-mix(in oklab, var(--accent) 16%, var(--glass));
  color: var(--text);
  font-weight: 950;
  letter-spacing: .08em;
}
.pill-status[data-status="ok"]{
  border-color: color-mix(in oklab, var(--success) 35%, var(--line2));
  background: color-mix(in oklab, var(--success) 10%, var(--glass));
}
.pill-status[data-status="stale"]{
  border-color: color-mix(in oklab, var(--warn) 35%, var(--line2));
  background: color-mix(in oklab, var(--warn) 10%, var(--glass));
}
.pill-status[data-status="offline"]{
  border-color: color-mix(in oklab, var(--danger) 35%, var(--line2));
  background: color-mix(in oklab, var(--danger) 10%, var(--glass));
}

/* -------------------------
  Buttons (premium)
------------------------- */
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:.5rem;
  padding:.82rem 1.05rem;
  border-radius:999px;
  border:1px solid transparent;
  cursor:pointer;
  user-select:none;
  transition:
    transform .10s ease,
    background-color .18s ease,
    border-color .18s ease,
    box-shadow .18s ease,
    filter .18s ease,
    opacity .18s ease;
  font-weight: 850;
  letter-spacing: -.01em;
  line-height: 1;
  -webkit-tap-highlight-color: transparent;
}
.btn:active{ transform: translateY(1px) scale(.99); }
.btn[disabled], .btn[aria-disabled="true"]{ opacity:.55; cursor:not-allowed; transform:none; }
.btn-sm{ padding:.58rem .85rem; font-size:.92rem; }

.btn-primary{
  color:#fff;
  background-color: var(--primary);
  background:
    linear-gradient(180deg,
      color-mix(in oklab, var(--primary) 84%, white 16%),
      color-mix(in oklab, var(--primary-2) 92%, black 8%)
    );
  border-color: color-mix(in oklab, var(--primary) 45%, transparent);
  box-shadow:
    0 14px 34px color-mix(in oklab, var(--primary) 18%, transparent),
    0 1px 0 rgba(255,255,255,.18) inset;
}
.btn-primary:hover{
  transform: translateY(-1px);
  filter: saturate(1.05);
  box-shadow:
    0 18px 48px color-mix(in oklab, var(--primary) 22%, transparent),
    0 1px 0 rgba(255,255,255,.20) inset;
}

.btn-secondary{
  background: color-mix(in oklab, var(--card2) 76%, transparent);
  border-color: var(--line2);
  color: var(--text);
  box-shadow: 0 1px 0 color-mix(in oklab, white 45%, transparent) inset;
}
.btn-secondary:hover{ transform: translateY(-1px); background: color-mix(in oklab, var(--card2) 90%, transparent); }

.btn-ghost{
  background: transparent;
  border-color: var(--line);
  color: var(--text);
}
.btn-ghost:hover{
  transform: translateY(-1px);
  background: color-mix(in oklab, var(--glass) 86%, transparent);
  border-color: var(--line2);
}

.icon-btn{
  display:inline-grid;
  place-items:center;
  width:44px; height:44px;
  border-radius:999px;
  border:1px solid var(--line2);
  background: color-mix(in oklab, var(--glass) 92%, transparent);
  cursor:pointer;
  transition: transform .10s ease, background-color .18s ease, border-color .18s ease, box-shadow .18s ease, opacity .18s ease;
  box-shadow: 0 1px 0 color-mix(in oklab, white 35%, transparent) inset;
  -webkit-tap-highlight-color: transparent;
}
.icon-btn:hover{ transform: translateY(-1px); background: color-mix(in oklab, var(--glass) 98%, transparent); }
.icon-btn:active{ transform: translateY(1px); }

/* -------------------------
  Topbar
------------------------- */
.topbar{
  position: sticky;
  top: 0;
  z-index: 40;
  background:
    linear-gradient(180deg,
      color-mix(in oklab, var(--bg2) 92%, transparent),
      color-mix(in oklab, var(--bg) 86%, transparent)
    );
  border-bottom: 1px solid var(--line);
  backdrop-filter: blur(14px);
}
.topbar-row{
  display:flex;
  gap: var(--s-3);
  align-items:center;
  justify-content: space-between;
  padding: .7rem 0;
}
.topbar-left{
  display:flex;
  flex-wrap:wrap;
  gap:.5rem;
  align-items:center;
  min-width:0;
}
.topbar-right{
  display:inline-flex;
  align-items:center;
  gap:.6rem;
  flex-wrap:wrap;
}

/* Mobile: keep topbar from becoming 2–3 lines */
@media (max-width: 920px){
  .topbar-left{
    flex-wrap: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  .topbar-left::-webkit-scrollbar{ display:none; }
}
/* Extra tight: hide lower-priority pills */
@media (max-width: 760px) {
  .topbar-left .pill:nth-child(n+6) { display:none; }
  .topbar-right .btn.btn-secondary { display:none; }
}

/* -------------------------
  Header / Nav
------------------------- */
.site-header{
  position: sticky;
  top: var(--topbar-h, 0px);
  z-index: 35;
  background: color-mix(in oklab, var(--bg2) 92%, transparent);
  border-bottom: 1px solid var(--line);
  backdrop-filter: blur(14px);
}
.site-header[data-scrolled="true"]{
  box-shadow: var(--sh-1);
  border-bottom-color: var(--line2);
}
.header-row{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: var(--s-4);
  padding: .9rem 0;
}
.brand{
  display:inline-flex;
  align-items:center;
  gap:.75rem;
  min-width:220px;
}
.brand-mark{
  width:46px; height:46px;
  border-radius:14px;
  background:
    radial-gradient(16px 16px at 30% 25%, rgba(255,255,255,.32), transparent 70%),
    linear-gradient(180deg, color-mix(in oklab, var(--primary) 85%, white 15%), var(--primary-2));
  color:#fff;
  display:grid;
  place-items:center;
  font-weight:950;
  letter-spacing:.06em;
  box-shadow: 0 16px 38px color-mix(in oklab, var(--primary) 18%, transparent);
  overflow:hidden;
}
.brand-logo{ width:100%; height:100%; object-fit:cover; }
.brand-title{ font-weight:950; font-size:1.03rem; }
.brand-sub{ color: var(--muted2); font-size:.86rem; margin-top:.1rem; }

.nav-links{
  display:flex;
  gap:.45rem;
  align-items:center;
  padding:.25rem;
  border-radius:999px;
  border:1px solid var(--line);
  background: color-mix(in oklab, var(--glass) 92%, transparent);
  backdrop-filter: blur(14px);
  box-shadow: 0 1px 0 color-mix(in oklab, white 35%, transparent) inset;
}
.nav-links a{
  padding:.55rem .8rem;
  border-radius:999px;
  color: color-mix(in oklab, var(--muted) 78%, var(--text) 22%);
  font-weight:850;
  font-size:.92rem;
  transition: background-color .18s ease, color .18s ease, border-color .18s ease, transform .12s ease;
}
.nav-links a:hover{
  background: color-mix(in oklab, var(--card2) 88%, transparent);
  color: var(--text);
  transform: translateY(-1px);
}
.nav-links a[data-active="true"]{
  background: color-mix(in oklab, var(--primary) 14%, white 86%);
  border: 1px solid color-mix(in oklab, var(--primary) 22%, var(--line2));
  color: var(--text);
}
.nav-cta{
  background: color-mix(in oklab, var(--accent) 14%, white 86%);
  border: 1px solid color-mix(in oklab, var(--accent) 26%, var(--line2));
  color: var(--text) !important;
}

.header-actions{
  display:inline-flex;
  align-items:center;
  gap:.6rem;
}

.menu-toggle{ display:none; }
@media (max-width: 920px){
  .nav-links{ display:none; }
  .menu-toggle{ display:inline-grid; }
  .brand{ min-width:0; }
  .header-row{ gap: var(--s-3); }
}

/* -------------------------
  Drawer
------------------------- */
.drawer[hidden]{ display:none !important; }
.drawer{ position:fixed; inset:0; z-index:70; }

.drawer-backdrop{
  position:absolute;
  inset:0;
  background: rgba(2, 6, 23, .50);
  backdrop-filter: blur(8px);
}
.drawer-panel{
  position:absolute;
  right:0; top:0;
  height:100%;
  width: min(92vw, 420px);
  background: color-mix(in oklab, var(--bg2) 94%, black 6%);
  border-left: 1px solid var(--line);
  box-shadow: -26px 0 72px rgba(0,0,0,.22);
  padding: var(--s-5);
  display:flex;
  flex-direction:column;
  gap: var(--s-4);
  transform: translateX(18px);
  opacity:0;
  transition: transform .18s ease, opacity .18s ease;
}
.drawer[data-open="true"] .drawer-panel{ transform: translateX(0); opacity:1; }

.drawer-list{ display:grid; gap:.65rem; }
.drawer-link{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:.95rem 1rem;
  border-radius: var(--r-2);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card) 92%, transparent);
  color: var(--text);
  font-weight:900;
  transition: transform .10s ease, background-color .18s ease, border-color .18s ease;
}
.drawer-link:hover{
  transform: translateY(-1px);
  background: color-mix(in oklab, var(--card2) 92%, transparent);
  border-color: var(--line2);
}
.drawer-primary{
  border-color: color-mix(in oklab, var(--primary) 26%, var(--line2));
  background: color-mix(in oklab, var(--primary) 12%, transparent);
}
.drawer-actions{ display:flex; gap:.6rem; flex-wrap:wrap; }

/* -------------------------
  Cards / minis
------------------------- */
.card{
  border-radius: var(--r-3);
  background:
    linear-gradient(180deg,
      color-mix(in oklab, var(--card2) 92%, transparent),
      color-mix(in oklab, var(--card) 92%, transparent)
    );
  border: 1px solid var(--line);
  box-shadow: var(--sh-1);
  backdrop-filter: blur(12px);
}
.pad{ padding: var(--s-5); }

.lift{
  transition: transform .14s ease, box-shadow .20s ease, border-color .18s ease, filter .18s ease;
  will-change: transform;
}
.lift:hover{
  transform: translateY(-2px);
  box-shadow: var(--sh-2);
  border-color: var(--line2);
  filter: saturate(1.02);
}

.card:focus-within{
  box-shadow: var(--sh-2), 0 0 0 6px var(--ring);
  border-color: color-mix(in oklab, var(--primary) 22%, var(--line2));
}

.card-head{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap: var(--s-4);
}
.card-title{ font-size:1.18rem; font-weight:950; margin-top:.25rem; }
.help{ color: var(--muted2); font-size:.96rem; }
.kicker{
  color: color-mix(in oklab, var(--muted) 70%, var(--text) 30%);
  font-size:.78rem;
  letter-spacing:.14em;
  text-transform:uppercase;
  font-weight:950;
}

.mini{
  border-radius: var(--r-2);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card2) 92%, transparent);
  padding: var(--s-4);
  box-shadow: 0 1px 0 color-mix(in oklab, white 35%, transparent) inset;
}
.mini-title{ font-size:1.08rem; font-weight:950; margin-top:.3rem; }

.mini--callout{
  border: 1px solid color-mix(in oklab, var(--accent) 32%, var(--line2));
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--accent) 10%, var(--card2)),
    color-mix(in oklab, var(--card) 92%, transparent)
  );
}
.mini--compact{
  border-radius: 16px;
  padding: .85rem .9rem;
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:.4rem;
  padding:.28rem .55rem;
  border-radius:999px;
  border: 1px solid color-mix(in oklab, var(--line2) 80%, transparent);
  background: color-mix(in oklab, var(--glass) 92%, transparent);
  font-size:.78rem;
  font-weight:950;
  white-space:nowrap;
}

/* -------------------------
  Layout / Grid
------------------------- */
.grid{ display:grid; gap: var(--s-4); }
.grid-2{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
.grid-3{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
@media (max-width: 980px){ .grid-3{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }
@media (max-width: 680px){ .grid-2, .grid-3{ grid-template-columns: 1fr; } }

/* -------------------------
  Hero (base)
------------------------- */
.hero{
  padding: var(--s-7) 0 var(--s-6);
  background:
    radial-gradient(900px 520px at 14% -10%, color-mix(in oklab, var(--accent) 18%, transparent), transparent 60%),
    radial-gradient(860px 520px at 86% 0%, color-mix(in oklab, var(--primary) 10%, transparent), transparent 62%),
    linear-gradient(180deg, color-mix(in oklab, var(--bg2) 82%, transparent), var(--bg));
  border-bottom: 1px solid color-mix(in oklab, var(--line) 70%, transparent);
}
.hero-grid{
  display:grid;
  grid-template-columns: 1.35fr .85fr;
  gap: var(--s-6);
  align-items:start;
}
@media (max-width: 980px){ .hero-grid{ grid-template-columns: 1fr; } }

.hero-badges{
  display:flex;
  flex-wrap:wrap;
  gap:.55rem;
  margin-bottom: var(--s-4);
}
.hero-head h1{
  font-size: clamp(2rem, 4.2vw, 3.25rem);
  font-weight: 980;
}
.accent{ color: color-mix(in oklab, var(--accent) 88%, var(--text) 12%); }
.hero-lede{ margin-top: var(--s-3); font-size:1.1rem; color: var(--muted); }
.hero-secondary{ margin-top: var(--s-3); color: var(--muted); }

.hero-actions{
  display:flex;
  flex-wrap:wrap;
  gap:.7rem;
  margin-top: var(--s-4);
}
.hero-subgrid{
  margin-top: var(--s-5);
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--s-3);
}
@media (max-width: 680px){ .hero-subgrid{ grid-template-columns: 1fr; } }

/* Hero flagship background layers (used by your new hero markup) */
.hero--flagship{ position: relative; overflow:hidden; }
.hero-bg{ position:absolute; inset:0; pointer-events:none; }
.hero-bg__glow{
  position:absolute; inset:-20%;
  background:
    radial-gradient(closest-side at 18% 22%, color-mix(in oklab, var(--accent) 22%, transparent), transparent 60%),
    radial-gradient(closest-side at 78% 30%, color-mix(in oklab, var(--accent2) 18%, transparent), transparent 62%),
    radial-gradient(closest-side at 50% 90%, color-mix(in oklab, var(--primary) 14%, transparent), transparent 66%);
  filter: blur(14px);
  opacity: .8;
}
.hero-bg__grid{
  position:absolute; inset:0;
  background:
    linear-gradient(to right, color-mix(in oklab, var(--line) 55%, transparent) 1px, transparent 1px),
    linear-gradient(to bottom, color-mix(in oklab, var(--line) 55%, transparent) 1px, transparent 1px);
  background-size: 44px 44px;
  opacity: .14;
  mask-image: radial-gradient(circle at 25% 25%, black 45%, transparent 78%);
}

.hero-points{
  list-style:none;
  padding:0;
  margin: .95rem 0 0;
  display:grid;
  gap:.6rem;
}
.hero-points li{ display:flex; gap:.55rem; align-items:flex-start; }
.hero-point__icon{
  width: 22px; height: 22px;
  border-radius: 999px;
  display:grid; place-items:center;
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card2) 70%, transparent);
  font-weight: 950;
  transform: translateY(1px);
}
.hero-trust{
  display:flex;
  gap:.6rem;
  flex-wrap:wrap;
  align-items:center;
  margin-top: .95rem;
  opacity:.92;
}
.hero-trust__dot{ opacity:.5; }

/* -------------------------
  Progress meter / stats
------------------------- */
.progress-title{ font-size:1.15rem; font-weight:950; }
.big-raise{ font-size:2.25rem; font-weight:980; margin-top:.35rem; }

.progress-head{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap: var(--s-4);
}
.stat-row{
  display:flex;
  justify-content:space-between;
  gap: var(--s-3);
  margin-top: .85rem;
  color: var(--muted);
  font-size:.95rem;
}

.meter{
  position:relative;
  height:12px;
  border-radius:999px;
  background: color-mix(in oklab, var(--card2) 84%, transparent);
  border: 1px solid var(--line);
  overflow:hidden;
  margin-top:.9rem;
  box-shadow: 0 1px 0 color-mix(in oklab, white 28%, transparent) inset;
}
.meter > span{
  position:absolute;
  inset:0;
  width:0%;
  border-radius:999px;
  background:
    linear-gradient(90deg,
      color-mix(in oklab, var(--primary) 92%, white 8%),
      color-mix(in oklab, var(--accent) 76%, var(--primary) 24%)
    );
  box-shadow: 0 10px 24px color-mix(in oklab, var(--primary) 18%, transparent);
}
.milestones{ position:absolute; inset:0; pointer-events:none; opacity:.75; }
.milestones i{
  position:absolute;
  top:-2px;
  width:2px;
  height:16px;
  background: color-mix(in oklab, var(--line2) 84%, transparent);
}
.progress-mini{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap: var(--s-3);
}
.progress-metric{ font-size:1.35rem; font-weight:980; margin-top:.15rem; }
.progress-mini__right{ text-align:right; }
.progress-actions{ display:flex; gap:.7rem; flex-wrap:wrap; margin-top:.9rem; }
.progress-micro{ margin-top:.75rem; }

/* -------------------------
  Chips / segmented
------------------------- */
.chip-row{ display:flex; flex-wrap:wrap; gap:.55rem; }

.chip{
  padding:.62rem .88rem;
  border-radius:999px;
  border: 1px solid var(--line2);
  background: color-mix(in oklab, var(--card2) 84%, transparent);
  cursor:pointer;
  font-weight:900;
  transition: transform .10s ease, background-color .18s ease, border-color .18s ease, box-shadow .18s ease;
  box-shadow: 0 1px 0 color-mix(in oklab, white 35%, transparent) inset;
  -webkit-tap-highlight-color: transparent;
}
.chip:hover{ transform: translateY(-1px); background: color-mix(in oklab, var(--card2) 96%, transparent); }
.chip:active{ transform: translateY(1px); }

.chip[aria-pressed="true"]{
  background: color-mix(in oklab, var(--primary) 12%, white 88%);
  border-color: color-mix(in oklab, var(--primary) 24%, var(--line2));
  color: var(--text);
  box-shadow: 0 10px 24px color-mix(in oklab, var(--primary) 10%, transparent);
}

.segmented{
  display:inline-flex;
  border: 1px solid var(--line);
  border-radius:999px;
  overflow:hidden;
  background: color-mix(in oklab, var(--glass) 92%, transparent);
  box-shadow: 0 1px 0 color-mix(in oklab, white 35%, transparent) inset;
}
.segmented button{
  border:0;
  background:transparent;
  padding:.65rem .9rem;
  cursor:pointer;
  font-weight:900;
  color: color-mix(in oklab, var(--muted) 78%, var(--text) 22%);
  -webkit-tap-highlight-color: transparent;
}
.segmented button[aria-pressed="true"]{
  background: color-mix(in oklab, var(--primary) 10%, white 90%);
  color: var(--text);
}
.segmented button[aria-disabled="true"]{ opacity:.5; cursor:not-allowed; }

/* -------------------------
  Sections
------------------------- */
.section{ padding: var(--s-7) 0; }
.section-head{ display:grid; gap:.65rem; margin-bottom: var(--s-4); }
.section-actions{ display:flex; flex-wrap:wrap; gap:.7rem; margin-top: var(--s-4); }

/* Split section head used by your updated Impact/Teams/Sponsors markup */
.section-head--split{
  display:grid;
  grid-template-columns: 1.15fr .85fr;
  gap: var(--s-4);
  align-items:start;
}
@media (max-width: 980px){
  .section-head--split{ grid-template-columns: 1fr; }
}

/* -------------------------
  Allocation bars
------------------------- */
.allocation{ display:grid; gap: var(--s-3); }
.allocation .meter{ height:10px; margin-top:.5rem; }

/* -------------------------
  Impact cards
------------------------- */
.impact-card{
  text-align:left;
  width:100%;
  border-radius: var(--r-3);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card) 94%, transparent);
  padding: var(--s-5);
  cursor:pointer;
  transition: transform .14s ease, box-shadow .20s ease, border-color .18s ease, background-color .18s ease;
  box-shadow: 0 1px 0 color-mix(in oklab, white 35%, transparent) inset;
  -webkit-tap-highlight-color: transparent;
}
.impact-card:hover{ transform: translateY(-2px); box-shadow: var(--sh-2); border-color: var(--line2); }
.impact-top{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; }

.tag{
  display:inline-flex;
  align-items:center;
  padding:.3rem .55rem;
  border-radius:999px;
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card2) 86%, transparent);
  color: color-mix(in oklab, var(--muted) 84%, var(--text) 16%);
  font-size:.78rem;
  font-weight:900;
}

.impact-amt{ font-size:1.7rem; font-weight:980; margin-top:.8rem; }
.impact-title{ font-size:1.05rem; font-weight:950; margin-top:.35rem; }
.impact-desc{ color: var(--muted); margin-top:.35rem; }
.impact-hint{ margin-top:.8rem; color: var(--muted2); font-weight:900; }

/* -------------------------
  Gifts list
------------------------- */
.gifts{ display:grid; gap:.6rem; margin-top: var(--s-4); }
.gift{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap: var(--s-3);
  padding:.9rem 1rem;
  border-radius: var(--r-2);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card2) 88%, transparent);
  box-shadow: 0 1px 0 color-mix(in oklab, white 30%, transparent) inset;
}
.who{ font-weight:950; }
.when{ font-size:.85rem; color: var(--muted2); margin-top:.15rem; }
.amt{ font-weight:980; }

/* -------------------------
  Team cards + tools
------------------------- */
.tools-head{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: var(--s-4);
  flex-wrap:wrap;
}
.tools-head--flagship{
  display:flex;
  gap: var(--s-3);
  align-items:flex-start;
  justify-content:space-between;
  flex-wrap:wrap;
}

.team-card{
  border-radius: var(--r-3);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card) 94%, transparent);
  overflow:hidden;
  box-shadow: var(--sh-1);
}
.team-media{ aspect-ratio:16/9; background: color-mix(in oklab, var(--card2) 82%, transparent); }
.team-img{ width:100%; height:100%; object-fit:cover; }
.team-body{ padding: var(--s-5); display:grid; gap: var(--s-3); }
.team-head{ display:flex; justify-content:space-between; align-items:flex-start; gap: var(--s-3); }
.team-name{ font-weight:980; font-size:1.05rem; }
.team-blurb{ color: var(--muted); margin-top:.25rem; }
.team-raise{ font-weight:980; white-space:nowrap; }

/* -------------------------
  Sponsors
------------------------- */
.leaderboard{ display:grid; gap:.65rem; margin-top: var(--s-4); }
.leaderboard--flagship{ gap:.6rem; }

.leader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap: var(--s-3);
  padding:.95rem 1rem;
  border-radius: var(--r-2);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card2) 88%, transparent);
  box-shadow: 0 1px 0 color-mix(in oklab, white 30%, transparent) inset;
}
.leader-left{ display:flex; align-items:center; gap:.85rem; min-width:0; }
.rank{
  width:38px; height:38px;
  border-radius:14px;
  display:grid; place-items:center;
  border: 1px solid var(--line2);
  background: color-mix(in oklab, var(--glass) 94%, transparent);
  font-weight:950;
  box-shadow: 0 1px 0 color-mix(in oklab, white 25%, transparent) inset;
}
.leader-name, .leader-meta{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.leader-name{ font-weight:950; }
.leader-meta{ color: var(--muted2); font-size:.9rem; }
.leader-amt{ font-weight:980; white-space:nowrap; }

.mini--spotlight{
  border-radius: var(--r-2);
  border: 1px solid color-mix(in oklab, var(--accent) 28%, var(--line2));
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--accent) 10%, var(--card2)),
    color-mix(in oklab, var(--card) 92%, transparent)
  );
}

.tier{
  border-radius: var(--r-3);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card) 94%, transparent);
  padding: var(--s-5);
  box-shadow: var(--sh-1);
}
.tier-row{ display:flex; justify-content:space-between; align-items:flex-start; gap: var(--s-3); }
.tier-price{ font-weight:980; font-size:1.25rem; white-space:nowrap; }
.tier-desc{ margin-top:.6rem; color: var(--muted); }

/* -------------------------
  Donate form
------------------------- */
.donate__head{ margin-bottom: var(--s-4); }
.donate__card{ overflow:hidden; }
.donate__form{ display:block; }

.donate__top{
  display:grid;
  grid-template-columns: 1.2fr .8fr;
  gap: var(--s-4);
  align-items:start;
}
@media (max-width: 860px){ .donate__top{ grid-template-columns:1fr; } }

.donate__summary-amount{ font-size:1.65rem; font-weight:980; margin-top:.35rem; }
.donate__fee{ margin-top:.35rem; }

.field{ display:grid; gap:.4rem; margin-top: var(--s-4); }
.label, label{ font-weight:900; }

input[type="text"],
input[type="email"],
input[type="number"],
input[type="search"],
select,
textarea{
  width:100%;
  border-radius: var(--r-2);
  border: 1px solid var(--line2);
  background: color-mix(in oklab, var(--glass) 92%, transparent);
  padding:.9rem 1rem;
  color: var(--text);
  outline:none;
  transition: border-color .18s ease, background-color .18s ease, box-shadow .18s ease, transform .10s ease;
  box-shadow: 0 1px 0 color-mix(in oklab, white 35%, transparent) inset;
}
textarea{ min-height:110px; resize:vertical; }

input::placeholder, textarea::placeholder{
  color: color-mix(in oklab, var(--muted2) 72%, transparent);
}
input:focus, select:focus, textarea:focus{
  border-color: color-mix(in oklab, var(--primary) 40%, var(--line2));
  background: color-mix(in oklab, var(--glass) 98%, transparent);
  box-shadow: 0 0 0 4px var(--ring);
  transform: translateY(-1px);
}
input[type="search"]::-webkit-search-cancel-button{ -webkit-appearance:none; }

.checks{ margin-top: var(--s-4); border:0; padding:0; }
.check{
  display:flex;
  align-items:flex-start;
  gap:.65rem;
  margin-top:.7rem;
  padding:.8rem .95rem;
  border-radius: var(--r-2);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card2) 86%, transparent);
  box-shadow: 0 1px 0 color-mix(in oklab, white 28%, transparent) inset;
}
.check input{ margin-top:.2rem; }

.alert{
  margin-top: var(--s-4);
  padding:.95rem 1rem;
  border-radius: var(--r-2);
  border: 1px solid color-mix(in oklab, var(--danger) 45%, var(--line2));
  background: color-mix(in oklab, var(--danger) 10%, transparent);
  color: var(--text);
  font-weight:900;
}

.donate__wallet{ margin-top:.7rem; }
.donate__actions{ display:flex; gap:.7rem; flex-wrap:wrap; margin-top:.9rem; }
.donate__trust{ margin-top: 1rem; }

.trust-logos{
  margin-top:.75rem;
  display:flex;
  flex-wrap:wrap;
  gap:.5rem;
  color: var(--muted2);
  font-weight:900;
  font-size:.9rem;
}
.trust-logos span{
  padding:.28rem .55rem;
  border-radius:999px;
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--glass) 92%, transparent);
}

/* Receipt preview */
.receipt{
  margin-top: .85rem;
  display:grid;
  gap:.45rem;
}
.receipt-row,
.receipt-total{
  display:flex;
  justify-content:space-between;
  gap: var(--s-3);
  color: var(--muted);
  font-size:.95rem;
}
.receipt-total{
  color: var(--text);
  font-weight:950;
}
.receipt-row strong{ color: var(--text); }

/* -------------------------
  Modals
------------------------- */
.modal[hidden]{ display:none !important; }
.modal{
  position:fixed;
  inset:0;
  z-index:80;
  display:grid;
  place-items:center;
  padding: var(--s-4);
  background: rgba(2, 6, 23, .52);
  backdrop-filter: blur(10px);
}
.modal-panel{
  width: min(780px, 100%);
  border-radius: var(--r-3);
  border: 1px solid var(--line2);
  background: color-mix(in oklab, var(--bg2) 94%, black 6%);
  box-shadow: 0 28px 90px rgba(0,0,0,.30);
  overflow:hidden;
}
.modal-panel--narrow{ width: min(640px, 100%); }
.modal-body{ padding: var(--s-6); }
.modal-head{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap: var(--s-4);
  margin-bottom: var(--s-4);
}
.modal-title{ font-size:1.25rem; font-weight:980; margin-top:.2rem; }

#paymentElementWrap{
  margin-top: var(--s-3);
  border: 1px solid var(--line);
  border-radius: var(--r-2);
  background: color-mix(in oklab, var(--glass) 92%, transparent);
  padding: var(--s-4);
  box-shadow: 0 1px 0 color-mix(in oklab, white 28%, transparent) inset;
}
.modal-actions{
  display:flex;
  gap:.7rem;
  flex-wrap:wrap;
  margin-top: var(--s-4);
}

/* -------------------------
  Footer
------------------------- */
.site-footer{
  padding: var(--s-7) 0 var(--s-6);
  border-top: 1px solid var(--line);
  background:
    linear-gradient(180deg,
      transparent,
      color-mix(in oklab, var(--bg2) 78%, transparent)
    );
}
.site-footer__container{ display:grid; gap: var(--s-5); }

.site-footer__top{
  display:grid;
  grid-template-columns: 1.25fr .75fr .85fr;
  gap: var(--s-5);
  align-items:start;
}
@media (max-width: 980px){ .site-footer__top{ grid-template-columns:1fr; } }

.site-footer__support{ font-weight:950; }
.site-footer__contact-meta{ display:block; margin-top:.35rem; }

.footer-links{
  list-style:none;
  padding:0;
  margin:0;
  display:grid;
  gap:.55rem;
}
.footer-links a{
  color: var(--muted);
  font-weight:900;
  text-decoration: underline;
  text-underline-offset: 3px;
  text-decoration-color: color-mix(in oklab, var(--primary) 32%, transparent);
}
.footer-links a:hover{
  color: var(--text);
  text-decoration-color: color-mix(in oklab, var(--primary) 58%, transparent);
}

.site-footer__trust{ margin-top: var(--s-5); }
.site-footer__trust-inner{
  display:flex;
  justify-content:space-between;
  gap: var(--s-5);
  flex-wrap:wrap;
  align-items:flex-start;
}
.site-footer__trust-list{ margin-top:.8rem; color: var(--muted2); }
.site-footer__trust-actions{ display:flex; gap:.7rem; flex-wrap:wrap; }

.site-footer__legal{ margin-top: var(--s-5); color: var(--muted2); }
.footer-legal{
  text-decoration: underline;
  text-underline-offset: 3px;
  text-decoration-color: color-mix(in oklab, var(--primary) 40%, transparent);
}
.footer-legal:hover{ text-decoration-color: color-mix(in oklab, var(--primary) 65%, transparent); }

/* FAQ */
.faq{ margin-top: var(--s-5); }
.faq details{
  border-radius: var(--r-2);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card2) 90%, transparent);
  padding: .9rem 1rem;
  box-shadow: 0 1px 0 color-mix(in oklab, white 28%, transparent) inset;
}
.faq details + details{ margin-top:.7rem; }
.faq summary{ cursor:pointer; font-weight:950; list-style:none; }
.faq summary::-webkit-details-marker{ display:none; }
.faq .help{ margin-top:.45rem; }

/* -------------------------
  Sticky donate bar
------------------------- */
.sticky[hidden]{ display:none !important; }
.sticky{
  position: fixed;
  left:0; right:0;
  bottom:0;
  z-index:60;
  padding: var(--s-3);
  padding-bottom: calc(var(--s-3) + env(safe-area-inset-bottom, 0px));
  transform: translateY(14px);
  opacity: 0;
  transition: transform .18s ease, opacity .18s ease;
}
.sticky[data-show="true"]{
  transform: translateY(0);
  opacity: 1;
}
.sticky-inner{
  width: min(var(--container), calc(100% - 2*var(--s-4)));
  margin-inline:auto;
  border-radius: var(--r-3);
  border: 1px solid var(--line2);
  background: color-mix(in oklab, var(--bg2) 94%, black 6%);
  box-shadow: var(--sh-2);
  padding: .95rem 1.05rem;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: var(--s-3);
  backdrop-filter: blur(14px);
}
.sticky-mini{ display:grid; gap:.15rem; }
.sticky-top{ font-weight:980; }
.sticky-bot{ color: var(--muted); font-size:.95rem; }
.sticky-actions{ display:flex; gap:.6rem; flex-wrap:wrap; }

/* -------------------------
  Toast
------------------------- */
.toast-host{
  position: fixed;
  left:0; right:0;
  bottom: 92px;
  z-index: 90;
  display:grid;
  place-items:center;
  padding: var(--s-3);
  pointer-events:none;
}
.toast[hidden]{ display:none !important; }
.toast{
  pointer-events:auto;
  display:inline-flex;
  align-items:center;
  gap:.8rem;
  padding:.85rem 1rem;
  border-radius:999px;
  border: 1px solid var(--line2);
  background: color-mix(in oklab, var(--bg2) 94%, black 6%);
  box-shadow: var(--sh-2);
  max-width: min(92vw, 640px);
  backdrop-filter: blur(14px);
  transform: translateY(10px);
  opacity: 0;
  transition: transform .18s ease, opacity .18s ease;
}
.toast[data-show="true"]{ transform: translateY(0); opacity: 1; }
.toast-text{ color: var(--text); font-weight:900; }
.toast-close{
  border:0;
  background:transparent;
  cursor:pointer;
  font-weight:980;
  opacity:.85;
}
.toast-close:hover{ opacity:1; }

/* -------------------------
  Back to top
------------------------- */
.back-to-top[hidden]{ display:none !important; }
.back-to-top{
  position: fixed;
  right: var(--s-4);
  bottom: 168px;
  z-index:65;
  width:54px;
  height:54px;
  border-radius:999px;
  border: 1px solid var(--line2);
  background: color-mix(in oklab, var(--glass) 96%, transparent);
  display:grid;
  place-items:center;
  cursor:pointer;
  box-shadow: var(--sh-2);
  transition: transform .10s ease, background-color .18s ease, border-color .18s ease;
  backdrop-filter: blur(14px);
  -webkit-tap-highlight-color: transparent;
}
.back-to-top:hover{
  transform: translateY(-2px);
  background: color-mix(in oklab, var(--glass) 100%, transparent);
  border-color: var(--line2);
}

/* -------------------------
  Skeleton / Notices
------------------------- */
.skeleton{
  position: relative;
  overflow: hidden;
  border-radius: 12px;
  background: color-mix(in oklab, var(--glass) 90%, transparent);
  border: 1px solid var(--line);
}
.skeleton::after{
  content:"";
  position:absolute; inset:0;
  transform: translateX(-60%);
  background: linear-gradient(90deg, transparent, color-mix(in oklab, white 32%, transparent), transparent);
  animation: shimmer 1.2s infinite;
}
@keyframes shimmer{ to{ transform: translateX(60%); } }
@media (prefers-reduced-motion: reduce){
  .skeleton::after{ animation:none; }
}

.notice{
  border-radius: var(--r-2);
  border: 1px solid var(--line2);
  background: color-mix(in oklab, var(--card2) 92%, transparent);
  padding: .95rem 1rem;
  box-shadow: 0 1px 0 color-mix(in oklab, white 28%, transparent) inset;
}
.notice--success{ border-color: color-mix(in oklab, var(--success) 40%, var(--line2)); }
.notice--warn{ border-color: color-mix(in oklab, var(--warn) 40%, var(--line2)); }
.notice--danger{ border-color: color-mix(in oklab, var(--danger) 40%, var(--line2)); }

/* -------------------------
  Mobile polish
------------------------- */
@media (max-width: 520px){
  .container{ width: min(var(--container), calc(100% - 2*var(--s-3))); }
  .pad{ padding: var(--s-4); }
  .modal-body{ padding: var(--s-5); }
  .hero{ padding: var(--s-6) 0 var(--s-5); }
  .big-raise{ font-size: 2.05rem; }
  .btn{ padding:.82rem 1rem; }
  .sticky-inner{ padding:.9rem 1rem; }
}

/* -------------------------
  QR / inline actions
------------------------- */
.inline-actions{
  display:flex;
  gap:.6rem;
  flex-wrap:wrap;
  margin-top:.6rem;
}
.qr-row{
  display:flex;
  gap:.9rem;
  align-items:center;
  padding:.85rem;
  border-radius: var(--r-2);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card2) 86%, transparent);
  box-shadow: 0 1px 0 color-mix(in oklab, white 40%, transparent) inset;
}
.qr-img{
  width:112px;
  height:112px;
  border-radius:14px;
  background:#fff;
  border:1px solid var(--line2);
  box-shadow: var(--sh-1);
}
.qr-copy{ min-width:0; }
.text-donate{ display:flex; flex-direction:column; justify-content:center; }
.text-donate__line{ margin-top:.55rem; font-weight:950; letter-spacing:-.01em; }
@media (max-width: 520px){
  .qr-row{ padding:.75rem; }
  .qr-img{ width:96px; height:96px; }
}

/* ============================================================
  HARD OVERRIDES (Bootstrap-like collisions)
============================================================ */
:root{
  --bs-primary: var(--primary) !important;
  --bs-link-color: var(--primary) !important;
  --bs-link-hover-color: var(--primary-2) !important;
}

body .btn.btn-primary,
body a.btn.btn-primary,
body button.btn.btn-primary,
body input.btn.btn-primary{
  color:#fff !important;
  background-color: var(--primary) !important;
  background-image: linear-gradient(
    180deg,
    color-mix(in oklab, var(--primary) 84%, white 16%),
    color-mix(in oklab, var(--primary-2) 92%, black 8%)
  ) !important;
  border-color: color-mix(in oklab, var(--primary) 45%, transparent) !important;
  box-shadow:
    0 14px 34px color-mix(in oklab, var(--primary) 18%, transparent),
    0 1px 0 rgba(255,255,255,.18) inset !important;
  text-decoration: none !important;
}

body .btn.btn-primary{
  --bs-btn-bg: var(--primary) !important;
  --bs-btn-border-color: var(--primary) !important;
  --bs-btn-hover-bg: var(--primary-2) !important;
  --bs-btn-hover-border-color: var(--primary-2) !important;
  --bs-btn-active-bg: var(--primary-2) !important;
  --bs-btn-active-border-color: var(--primary-2) !important;
}

body .btn.btn-secondary{
  background: color-mix(in oklab, var(--card2) 76%, transparent) !important;
  border-color: var(--line2) !important;
  color: var(--text) !important;
  text-decoration:none !important;
}
body .btn.btn-ghost{
  background: transparent !important;
  border-color: var(--line) !important;
  color: var(--text) !important;
  text-decoration:none !important;
}

body .nav-links a,
body .drawer-link{ text-decoration: none !important; }

body a:not(.btn):not(.drawer-link):not(.nav-links a){
  text-decoration-color: color-mix(in oklab, var(--primary) 40%, transparent);
}

/* ============================================================
  FLAGSHIP ADD-ONS (missing utilities + components used in markup)
  - Added without renaming any ids/classes
============================================================ */

/* Simple spacing utilities used by markup */
.stack{ display:grid; }
.stack-xs{ gap:.45rem; }
.stack-sm{ gap:.7rem; }
.stack-md{ gap:1rem; }
.stack-lg{ gap:1.35rem; }

.cluster{ display:flex; gap:.75rem; align-items:center; flex-wrap:wrap; }
.cluster-between{ justify-content:space-between; }
.cluster-start{ justify-content:flex-start; }
.cluster-end{ justify-content:flex-end; }

.break-word{ word-break: break-word; overflow-wrap: anywhere; }

/* Softer mini (used multiple places) */
.mini--soft{
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--card2) 92%, transparent),
    color-mix(in oklab, var(--glass) 72%, transparent)
  );
  border-color: color-mix(in oklab, var(--line) 90%, transparent);
}

/* Scroll progress rail under header */
.scroll-progress{
  position: relative;
  height: 6px;
  border-radius: 999px;
  background: color-mix(in oklab, var(--glass) 92%, transparent);
  border: 1px solid color-mix(in oklab, var(--line) 85%, transparent);
  overflow:hidden;
  margin-bottom: .85rem;
}
.scroll-progress > span{
  position:absolute; inset:0;
  width: 0%;
  background: linear-gradient(90deg,
    color-mix(in oklab, var(--accent) 78%, var(--primary) 22%),
    color-mix(in oklab, var(--primary) 88%, white 12%)
  );
  box-shadow: 0 10px 22px color-mix(in oklab, var(--primary) 18%, transparent);
}

/* Hero noise layer */
.hero-bg__noise{
  position:absolute; inset:0;
  opacity:.14;
  mix-blend-mode: overlay;
  background-image:
    radial-gradient(circle at 10% 10%, rgba(255,255,255,.25), transparent 35%),
    radial-gradient(circle at 80% 30%, rgba(255,255,255,.18), transparent 35%),
    radial-gradient(circle at 40% 90%, rgba(255,255,255,.18), transparent 35%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.02), rgba(255,255,255,.02) 1px, transparent 1px, transparent 3px);
  mask-image: radial-gradient(circle at 20% 20%, black 40%, transparent 75%);
}

/* Quick donate grid (hero right) */
.quick-donate-grid{
  display:grid;
  gap: var(--s-3);
  margin-top: var(--s-4);
}
.quick-donate-card{
  border-radius: var(--r-2);
  border: 1px solid var(--line);
  background: color-mix(in oklab, var(--card2) 90%, transparent);
  padding: var(--s-4);
  box-shadow: 0 1px 0 color-mix(in oklab, white 28%, transparent) inset;
}
.quick-donate-card__inner{
  display:flex;
  gap: var(--s-3);
  align-items:center;
}
.quick-donate-copy{ min-width:0; }

/* Payment element wrap class used in markup */
.payment-element-wrap{ margin-top: var(--s-3); }

/* QR styles used by share options + footer */
.qr-small{
  border-radius: 16px;
  border: 1px solid var(--line2);
  background: #fff;
  box-shadow: var(--sh-1);
}
.qr-big{
  display:grid;
  place-items:center;
  gap: var(--s-3);
  margin: 0;
}
.qr-big__img{
  width: min(240px, 80vw);
  height: auto;
  border-radius: 18px;
  border: 1px solid var(--line2);
  background: #fff;
  box-shadow: var(--sh-2);
}
.qr-caption{ text-align:center; color: var(--muted2); }

/* Footer buttons that look like links */
.linklike{
  border:0;
  background:transparent;
  padding:0;
  margin:0;
  cursor:pointer;
  text-align:left;
  color: var(--muted);
  font-weight:900;
  text-decoration: underline;
  text-underline-offset: 3px;
  text-decoration-color: color-mix(in oklab, var(--primary) 32%, transparent);
}
.linklike:hover{
  color: var(--text);
  text-decoration-color: color-mix(in oklab, var(--primary) 58%, transparent);
}

/* Slightly tighter form cluster */
.cluster.cluster-between{ width:100%; }

/* Small layout niceties */
.hero-console{ position: sticky; top: var(--scroll-offset); }
@media (max-width: 980px){ .hero-console{ position: static; } }
[data-theme="dark"] .btn-secondary,
[data-theme="dark"] .btn-outline,
[data-theme="dark"] .btn-ghost {
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
[data-theme="dark"] .btn-secondary,
[data-theme="dark"] .btn-outline,
[data-theme="dark"] .btn-ghost {
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
/* =========================================================
   Dark theme: make pills/buttons visible (nav + segmented)
   Place at END of your CSS so it wins.
   ========================================================= */

:root[data-theme="dark"] {
  --ff-pill-bg: rgba(255,255,255,.06);
  --ff-pill-bg-hover: rgba(255,255,255,.10);
  --ff-pill-bg-active: rgba(255,255,255,.14);

  --ff-pill-border: rgba(255,255,255,.14);
  --ff-pill-border-active: rgba(255,255,255,.22);

  --ff-pill-text: rgba(255,255,255,.88);
  --ff-pill-text-active: rgba(255,255,255,.96);
}

/* Base pill/tab look in dark mode */
:root[data-theme="dark"] #navLinks a,
:root[data-theme="dark"] .segmented button,
:root[data-theme="dark"] button[data-team-filter],
:root[data-theme="dark"] button[data-frequency],
:root[data-theme="dark"] .pill,
:root[data-theme="dark"] .chip {
  background: var(--ff-pill-bg);
  border: 1px solid var(--ff-pill-border);
  color: var(--ff-pill-text);
}

/* Hover */
:root[data-theme="dark"] #navLinks a:hover,
:root[data-theme="dark"] .segmented button:hover,
:root[data-theme="dark"] button[data-team-filter]:hover,
:root[data-theme="dark"] button[data-frequency]:hover,
:root[data-theme="dark"] .pill:hover,
:root[data-theme="dark"] .chip:hover {
  background: var(--ff-pill-bg-hover);
}

/* Active/selected state (THIS is what fixes your invisible pills) */
:root[data-theme="dark"] #navLinks a[data-active="true"],
:root[data-theme="dark"] #navLinks a[aria-current="true"],
:root[data-theme="dark"] .segmented button[aria-pressed="true"],
:root[data-theme="dark"] button[data-team-filter][aria-pressed="true"],
:root[data-theme="dark"] button[data-frequency][aria-pressed="true"] {
  background: var(--ff-pill-bg-active);
  border-color: var(--ff-pill-border-active);
  color: var(--ff-pill-text-active);
}

/* If any “active pill” is getting a LIGHT theme background, force override */
:root[data-theme="dark"] #navLinks a[data-active="true"],
:root[data-theme="dark"] .segmented button[aria-pressed="true"] {
  box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
}

:root[data-theme="dark"] #navLinks a[data-active="true"],
:root[data-theme="dark"] .segmented button[aria-pressed="true"],
:root[data-theme="dark"] button[data-team-filter][aria-pressed="true"],
:root[data-theme="dark"] button[data-frequency][aria-pressed="true"] {
  background: rgba(249,115,22,.20);
  border-color: rgba(249,115,22,.45);
  color: rgba(255,255,255,.97);
}
/* =========================================================
   Elite Footer Polish — paste at END of CSS
   Works with your existing markup/classes
   ========================================================= */

/* Theme tokens (safe fallbacks) */
:root{
  --ff-border: rgba(0,0,0,.10);
  --ff-border-strong: rgba(0,0,0,.14);
  --ff-soft: rgba(0,0,0,.04);
  --ff-text: rgba(16,24,40,.92);
  --ff-muted: rgba(16,24,40,.66);
}
:root[data-theme="dark"]{
  --ff-border: rgba(255,255,255,.10);
  --ff-border-strong: rgba(255,255,255,.14);
  --ff-soft: rgba(255,255,255,.06);
  --ff-text: rgba(255,255,255,.92);
  --ff-muted: rgba(255,255,255,.66);
}

/* Footer container + top seam */
.site-footer{
  position: relative;
  border-top: 1px solid var(--ff-border);
  padding: clamp(32px, 4vw, 56px) 0 28px;
  color: var(--ff-text);
  background:
    radial-gradient(900px 420px at 14% -10%, rgba(249,115,22,.14), transparent 60%),
    radial-gradient(900px 420px at 86% -10%, rgba(255,255,255,.08), transparent 60%),
    linear-gradient(180deg, transparent 0%, rgba(0,0,0,.02) 100%);
}
:root[data-theme="dark"] .site-footer{
  background:
    radial-gradient(900px 420px at 14% -10%, rgba(249,115,22,.16), transparent 60%),
    radial-gradient(900px 420px at 86% -10%, rgba(255,255,255,.06), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,.10) 0%, rgba(0,0,0,.24) 100%);
}

/* Make the footer grid feel intentional */
.site-footer__top.footer-grid{
  align-items: start;
  gap: clamp(18px, 2.2vw, 32px);
}

/* Brand block tightening */
.site-footer__brand .brand-title{ letter-spacing: -0.01em; }
.site-footer__brand .brand-sub{ color: var(--ff-muted); max-width: 42ch; }
.site-footer__contact .site-footer__support{
  font-weight: 850;
  text-decoration: none;
  color: var(--ff-text);
}
.site-footer__contact .site-footer__support:hover{ text-decoration: underline; }
.site-footer__contact .site-footer__contact-meta{ color: var(--ff-muted); }

/* Footer pills look consistent */
.site-footer__meta .pill{
  border: 1px solid var(--ff-border);
  background: var(--ff-soft);
}
:root[data-theme="dark"] .site-footer__meta .pill{
  background: rgba(255,255,255,.06);
}

/* Footer nav: increase scan-ability */
.footer-nav .kicker{ margin-bottom: 4px; }
.footer-links a,
.footer-links .linklike{
  display: inline-flex;
  align-items: center;
  gap: .4rem;
  color: var(--ff-muted);
  text-decoration: none;
  line-height: 1.2;
}
.footer-links a:hover,
.footer-links .linklike:hover{
  color: var(--ff-text);
  text-decoration: underline;
}
.footer-links .linklike{
  background: none;
  border: 0;
  padding: 0;
  cursor: pointer;
  font: inherit;
}

/* Quick donate card: make it sit "flush" with the system */
.site-footer__cta .footer-mini{
  border: 1px solid var(--ff-border);
  background: rgba(255,255,255,.70);
  backdrop-filter: blur(10px);
}
:root[data-theme="dark"] .site-footer__cta .footer-mini{
  background: rgba(255,255,255,.06);
}
.site-footer__cta .chip{
  border: 1px solid var(--ff-border);
  background: transparent;
}
.site-footer__cta .chip:hover{
  background: var(--ff-soft);
}

/* TRUST CARD: the biggest “bottom looks off” fix */
.site-footer__trust{
  margin-top: 18px;
  border: 1px solid var(--ff-border);
  background: rgba(255,255,255,.60);
  backdrop-filter: blur(10px);
}
:root[data-theme="dark"] .site-footer__trust{
  background: rgba(255,255,255,.06);
}
.site-footer__trust-inner{
  align-items: flex-start;
  gap: 18px;
}
.site-footer__trust-list{
  margin: 0;
  padding-left: 1.1rem;
}
.site-footer__trust-p{ color: var(--ff-muted); }

/* Actions on the trust card stay compact */
.site-footer__trust-actions .btn{ white-space: nowrap; }

/* LEGAL: anchor it + tighten spacing */
.site-footer__legal{
  margin-top: 16px;
  padding-top: 16px;
  border-top: 1px solid var(--ff-border);
  color: var(--ff-muted);
}
.site-footer__legal p{
  margin: 0;
}
.site-footer__legal .footer-legal{
  color: var(--ff-muted);
  text-decoration: none;
}
.site-footer__legal .footer-legal:hover{
  color: var(--ff-text);
  text-decoration: underline;
}

/* Responsive: avoid “giant footer” on tablets */
@media (max-width: 960px){
  .site-footer{ padding: 28px 0 22px; }
  .site-footer__trust-inner{ flex-direction: column; }
  .site-footer__trust-actions{ width: 100%; justify-content: flex-start; }
}

/* Responsive: phones */
@media (max-width: 640px){
  .site-footer__meta{ flex-wrap: wrap; }
  .footer-share{ flex-wrap: wrap; }
  .site-footer__cta .chip-row{ gap: .5rem; }
}
.footer-legal-row{
  display: flex;
  flex-direction: column;
  gap: .4rem;
}
@media (min-width: 900px){
  .footer-legal-row{
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
  }
}
/* =========================================================
   FutureFunded — Elite Refactor Patch (paste at very end)
   Drop-in: NO class/id renames required
   ========================================================= */

/* ---------- Global polish tokens ---------- */
:root{
  --dur-1: 120ms;
  --dur-2: 180ms;
  --dur-3: 260ms;
  --ease-out: cubic-bezier(.16, 1, .3, 1);
  --ease-inout: cubic-bezier(.4, 0, .2, 1);

  --ring-strong: color-mix(in oklab, var(--primary) 26%, transparent);
  --hairline: color-mix(in oklab, var(--line) 78%, transparent);

  /* Prevent “too gray” glass in light mode */
  --glass-strong: color-mix(in oklab, var(--glass) 96%, transparent);
}

html, body{
  accent-color: var(--primary);
}

/* Better overflow-x fallback */
body{
  overflow-x: hidden;
  overflow-x: clip;
}

/* ---------- Scrollbars (subtle, premium) ---------- */
*{ scrollbar-width: thin; scrollbar-color: color-mix(in oklab, var(--muted2) 30%, transparent) transparent; }
*::-webkit-scrollbar{ width: 10px; height: 10px; }
*::-webkit-scrollbar-track{ background: transparent; }
*::-webkit-scrollbar-thumb{
  background: color-mix(in oklab, var(--muted2) 26%, transparent);
  border-radius: 999px;
  border: 3px solid transparent;
  background-clip: padding-box;
}
*::-webkit-scrollbar-thumb:hover{
  background: color-mix(in oklab, var(--muted2) 36%, transparent);
  border: 3px solid transparent;
  background-clip: padding-box;
}

/* ---------- Color-mix fallback (older browsers) ---------- */
@supports not (color: color-mix(in oklab, black, white)){
  :root{
    --ring: rgba(194, 65, 12, .18);
    --ring-strong: rgba(194, 65, 12, .26);
  }
  ::selection{ background: rgba(194, 65, 12, .20); }
}

/* ---------- Typography finishing ---------- */
h2{
  font-size: clamp(1.35rem, 2.2vw, 1.9rem);
  font-weight: 980;
  letter-spacing: -0.02em;
}
h3{
  font-size: 1.18rem;
  font-weight: 950;
}
small, .muted, .help, .when, .leader-meta{
  line-height: 1.35;
}

/* ---------- Link behavior (keeps your “no underline” base) ---------- */
a:not(.btn):not(.drawer-link):not(.nav-links a):hover{
  text-decoration: underline;
  text-underline-offset: 3px;
  text-decoration-color: color-mix(in oklab, var(--primary) 50%, transparent);
}

/* ---------- Mobile hover guard (prevents sticky hover on iOS) ---------- */
@media (hover: none){
  .lift:hover,
  .btn:hover,
  .chip:hover,
  .pill:hover,
  .nav-links a:hover,
  .drawer-link:hover,
  .impact-card:hover,
  .leader:hover{
    transform: none !important;
    filter: none !important;
  }
}

/* ---------- Unified interactive timing ---------- */
.btn,
.icon-btn,
.chip,
.pill,
.nav-links a,
.drawer-link,
.lift,
.impact-card{
  transition-timing-function: var(--ease-out);
}

/* ---------- Premium focus treatment (for interactive components) ---------- */
.btn:focus-visible,
.icon-btn:focus-visible,
.chip:focus-visible,
.pill:focus-visible,
.nav-links a:focus-visible,
.drawer-link:focus-visible,
.impact-card:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
summary:focus-visible{
  outline: none;
  box-shadow: 0 0 0 5px var(--ring-strong);
}

/* ---------- Surface “highlight edge” (makes cards feel expensive) ---------- */
.card,
.team-card,
.tier,
.leader,
.gift,
.mini,
.quick-donate-card,
.notice,
.faq details{
  border-color: color-mix(in oklab, var(--line) 92%, transparent);
  box-shadow:
    var(--sh-1),
    0 1px 0 color-mix(in oklab, white 22%, transparent) inset;
}

/* Slightly nicer hover elevation cadence */
.lift:hover,
.team-card:hover,
.tier:hover{
  box-shadow:
    var(--sh-2),
    0 1px 0 color-mix(in oklab, white 24%, transparent) inset;
}

/* ---------- Button micro-polish (more “hardware” feel) ---------- */
.btn{
  transition-duration: var(--dur-2);
  transition-timing-function: var(--ease-out);
}
.btn:active{
  transform: translateY(1px) scale(.99);
}
@media (hover:hover){
  .btn-primary:hover{
    filter: saturate(1.06) contrast(1.02);
  }
  .btn-secondary:hover,
  .btn-ghost:hover{
    filter: contrast(1.02);
  }
}

/* ---------- Inputs: cleaner filled look (especially on light mode) ---------- */
input[type="text"],
input[type="email"],
input[type="number"],
input[type="search"],
select,
textarea{
  background: color-mix(in oklab, var(--glass-strong) 90%, transparent);
  transition-duration: var(--dur-2);
  transition-timing-function: var(--ease-out);
}
input:focus, select:focus, textarea:focus{
  box-shadow: 0 0 0 5px var(--ring-strong);
}

/* ---------- Dark mode: guarantee “pill/tab” contrast everywhere ---------- */
html[data-theme="dark"] .pill,
html[data-theme="dark"] .chip,
html[data-theme="dark"] .segmented,
html[data-theme="dark"] .segmented button,
html[data-theme="dark"] .nav-links,
html[data-theme="dark"] .nav-links a,
html[data-theme="dark"] #navLinks a{
  border-color: color-mix(in oklab, white 16%, transparent) !important;
}
html[data-theme="dark"] .segmented button[aria-pressed="true"],
html[data-theme="dark"] button[data-team-filter][aria-pressed="true"],
html[data-theme="dark"] button[data-frequency][aria-pressed="true"],
html[data-theme="dark"] .nav-links a[data-active="true"],
html[data-theme="dark"] #navLinks a[data-active="true"]{
  background: rgba(249,115,22,.20) !important;
  border-color: rgba(249,115,22,.45) !important;
  color: rgba(255,255,255,.97) !important;
}

/* ---------- Background layers: reduce GPU cost on very small screens ---------- */
@media (max-width: 520px){
  body::before{ filter: blur(26px); opacity: .75; }
  body::after{ filter: blur(26px); opacity: .45; }
}

/* ---------- Footer: finalize + remove “bottom looks off” ---------- */
.site-footer{
  border-top-color: color-mix(in oklab, var(--line) 85%, transparent);
}
.site-footer__top,
.site-footer__top.footer-grid{
  gap: clamp(18px, 2.2vw, 32px);
}

/* Trust card: give it a crisp edge + consistent padding */
.site-footer__trust{
  border-radius: var(--r-3);
  border: 1px solid color-mix(in oklab, var(--line) 85%, transparent);
  box-shadow: var(--sh-1);
}
.site-footer__trust-inner{
  padding: clamp(14px, 2vw, 20px);
}

/* Legal row: reduce visual noise */
.site-footer__legal{
  border-top: 1px solid color-mix(in oklab, var(--line) 85%, transparent);
}

/* ---------- Forced-colors safety (accessibility) ---------- */
@media (forced-colors: active){
  *{ forced-color-adjust: auto; }
  .btn, .pill, .chip, .card, .mini, .tier, .leader, .gift{
    border: 1px solid CanvasText !important;
    box-shadow: none !important;
  }
}

</style>
</head>
<body>

<a class="sr-only" href="#content">Skip to main content</a>

<!-- Top announcement (premium + tighter) -->
<div class="topbar" role="region" aria-label="Fundraiser announcement" id="topbar">
  <div class="container">
    <div class="topbar-row">
      <div class="topbar-left" aria-label="Trust signals">
        <span class="pill pill-live" aria-label="Live fundraiser">
          <span class="pill-dot" aria-hidden="true"></span>
          <span>LIVE</span>
        </span>

        <span class="pill pill-accent" id="orgPill">Connect ATX Elite Fundraiser</span>

        <span class="pill pill-muted" id="matchPill" hidden>Match active</span>
        <span class="pill pill-muted">Secure Stripe checkout</span>
        <span class="pill pill-muted">Instant receipt</span>
        <span class="pill pill-muted">No login</span>

        <span class="pill pill-accent" id="countdownPill" aria-live="polite" aria-atomic="true">Ends soon</span>

        <span
          class="pill pill-muted pill-status"
          id="lastUpdatedPill"
          data-status="stale"
          aria-live="polite"
          aria-atomic="true"
        >
          Updated —
        </span>
      </div>

      <div class="topbar-right">
        <button class="btn btn-secondary btn-sm" type="button" id="shareBtnTop">Share</button>
        <button class="btn btn-ghost btn-sm" type="button" id="shareOptionsBtn" aria-label="Open share options">Options</button>
        <a class="btn btn-primary btn-sm" href="#donate" aria-label="Jump to donation form">Donate</a>

        <button class="icon-btn" type="button" id="topbarDismiss" aria-label="Dismiss announcement" title="Dismiss">✕</button>
      </div>
    </div>
  </div>
</div>

<!-- Header -->
<header class="site-header site-header--flagship" id="top" role="banner">
  <div class="container">
    <div class="header-row">
      <a class="brand" href="#top" aria-label="Fundraiser home">
        <div class="brand-mark" aria-hidden="true" id="brandMark">FF</div>
        <div class="brand-text">
          <div class="brand-title" id="orgName">Connect ATX Elite</div>
          <div class="brand-sub" id="orgMeta">Youth Basketball • Austin, TX</div>
        </div>
      </a>

      <nav class="nav-links" aria-label="Primary navigation" id="navLinks">
        <a href="#progress" data-spy="progress">Progress</a>
        <a href="#impact" data-spy="impact">Impact</a>
        <a href="#teams" data-spy="teams">Teams</a>
        <a href="#sponsors" data-spy="sponsors">Sponsors</a>
        <a href="#donate" data-spy="donate" class="nav-cta" aria-label="Jump to donate">Donate</a>
      </nav>

      <div class="header-actions" aria-label="Header actions">
        <span class="pill pill-verified" aria-label="Verified fundraiser">Verified</span>

        <button
          class="icon-btn"
          type="button"
          id="themeToggle"
          aria-label="Toggle dark mode"
          aria-pressed="false"
          title="Toggle theme"
        >
          ☾
        </button>

        <button
          class="icon-btn menu-toggle"
          type="button"
          id="menuOpen"
          aria-label="Open menu"
          aria-expanded="false"
          aria-controls="mobileDrawer"
          title="Menu"
        >
          ≡
        </button>

        <a class="btn btn-primary btn-sm hide-mobile" href="#donate" aria-label="Jump to donation form">Donate</a>
      </div>
    </div>

    <!-- Premium: scroll progress rail -->
    <div class="scroll-progress" aria-hidden="true">
      <span id="scrollProgressBar"></span>
    </div>
  </div>
</header>

<!-- Mobile nav drawer -->
<div
  class="drawer"
  id="mobileDrawer"
  data-open="false"
  role="dialog"
  aria-modal="true"
  aria-label="Mobile navigation"
  aria-hidden="true"
  hidden
>
  <div class="drawer-backdrop" data-close="true" aria-hidden="true"></div>

  <div class="drawer-panel" role="document" tabindex="-1">
    <div class="kicker">Navigate</div>

    <div class="drawer-list" role="list">
      <a class="drawer-link" role="listitem" href="#progress">Progress <span aria-hidden="true">→</span></a>
      <a class="drawer-link" role="listitem" href="#impact">Impact <span aria-hidden="true">→</span></a>
      <a class="drawer-link" role="listitem" href="#teams">Teams <span aria-hidden="true">→</span></a>
      <a class="drawer-link" role="listitem" href="#sponsors">Sponsors <span aria-hidden="true">→</span></a>
      <a class="drawer-link drawer-primary" role="listitem" href="#donate">Donate <span aria-hidden="true">→</span></a>
    </div>

    <div class="divider" aria-hidden="true"></div>

    <div class="drawer-actions">
      <button class="btn btn-secondary" type="button" id="shareBtnDrawer">Share</button>
      <button class="btn btn-ghost" type="button" id="copyLinkBtn">Copy link</button>
      <button class="btn btn-ghost btn-sm" type="button" data-close="true" aria-label="Close menu">Close</button>
    </div>
  </div>
</div>

<main id="content" role="main" tabindex="-1">
  <!-- HERO -->
  <section class="hero hero--flagship" aria-labelledby="heroTitle">
    <div class="hero-bg" aria-hidden="true">
      <div class="hero-bg__glow"></div>
      <div class="hero-bg__grid"></div>
      <div class="hero-bg__noise"></div>
    </div>

    <div class="container hero-grid">
      <!-- LEFT: story -->
      <div class="hero-left">
        <div class="hero-badges" aria-label="Fundraiser context">
          <span class="pill" id="seasonPill">Season Fund</span>
          <span class="pill">Live progress</span>
          <span class="pill" id="sportPill">Youth sports</span>
        </div>

        <header class="hero-head">
          <p class="kicker" id="heroOrgLine">Connect ATX Elite • Fundraiser</p>

          <h1 id="heroTitle" class="hero-title">
            Fuel the season. Fund the future.<br />
            <span class="accent">Help more kids stay on the floor.</span>
          </h1>

          <p class="hero-lede measure" id="heroCopy">
            Your donation helps cover real season costs—gym time, travel weekends, and gear—so families aren’t carrying the full load.
            Sponsors also get premium recognition that’s easy to share.
          </p>

          <ul class="hero-points measure" aria-label="What your gift funds">
            <li>
              <span class="hero-point__icon" aria-hidden="true">✓</span>
              <span><strong>Uniforms + gear</strong> every athlete needs to compete.</span>
            </li>
            <li>
              <span class="hero-point__icon" aria-hidden="true">✓</span>
              <span><strong>Gym time + coaching</strong> to keep practice consistent.</span>
            </li>
            <li>
              <span class="hero-point__icon" aria-hidden="true">✓</span>
              <span><strong>Tournament travel</strong> that keeps weekends doable.</span>
            </li>
          </ul>

          <p class="measure hero-secondary" id="heroCopy2">
            Every gift reduces the burden on families and keeps more kids on the same schedule.
            <strong>Secure checkout</strong> stays on this page and receipts are emailed instantly.
          </p>

          <div class="hero-actions" role="group" aria-label="Primary actions">
            <a class="btn btn-primary" href="#donate" aria-label="Donate now">Donate</a>
            <a class="btn btn-secondary" href="#sponsors" aria-label="View sponsor leaderboard">Sponsor leaderboard</a>
            <button class="btn btn-ghost" type="button" id="copyLinkBtn2" data-action="copy-link">Copy link</button>
          </div>

          <div class="hero-trust" aria-label="Checkout explanation">
            <span class="hero-trust__item"><strong>Secure</strong> Stripe checkout</span>
            <span class="hero-trust__dot" aria-hidden="true">•</span>
            <span class="hero-trust__item"><strong>Instant</strong> email receipt</span>
            <span class="hero-trust__dot" aria-hidden="true">•</span>
            <span class="hero-trust__item"><strong>No</strong> account required</span>
          </div>
        </header>

        <div class="hero-subgrid" aria-label="Highlights">
          <article class="mini mini--soft" aria-label="Upcoming event">
            <div class="kicker">Next up</div>
            <h3 class="mini-title" id="eventTitle">Upcoming event</h3>
            <p class="help" id="eventCountdown">
              <span class="skeleton" style="display:inline-block; width: 14ch; height: 1em; vertical-align: -0.15em;"></span>
            </p>
          </article>

          <article class="mini mini--soft" aria-label="Privacy promise">
            <div class="kicker">Privacy</div>
            <h3 class="mini-title">Receipt-only data use.</h3>
            <p class="help">Donor info is used for receipts and optional updates—never sold.</p>
          </article>
        </div>
      </div>

      <!-- RIGHT: progress console -->
      <aside class="hero-right" aria-label="Progress and quick donate">
        <article class="card pad lift hero-console" id="progress" aria-labelledby="progressTitle">
          <div class="progress-head">
            <div class="progress-head__left">
              <div class="kicker">Progress</div>
              <h2 id="progressTitle" class="progress-title">Fundraising progress</h2>

              <div class="big-raise num" id="raisedBig">$0</div>

              <div class="help progress-meta">
                <span class="num" id="remainingText">$0</span> to go •
                <span class="num" id="deadlineText">—</span>
                <span aria-hidden="true"> • </span>
                <span class="num" id="lastUpdatedText">Updated —</span>
              </div>
            </div>

            <span class="pill" aria-label="Goal amount">Goal <span class="num" id="goalPill">$0</span></span>
          </div>

          <div class="quick-donate-grid" aria-label="Donate options">
            <section class="quick-donate-card" aria-label="Scan to donate">
              <div class="quick-donate-card__inner">
                <img
                  id="donateQr"
                  class="qr-img"
                  width="112"
                  height="112"
                  alt="QR code to donate to this fundraiser"
                  loading="lazy"
                  decoding="async"
                  src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=10&data=https%3A%2F%2Fgetfuturefunded.com"
                />
                <div class="quick-donate-copy">
                  <div class="kicker">Scan to donate</div>
                  <p class="help">Open camera → scan → donate.</p>
                  <div class="inline-actions">
                    <button class="btn btn-secondary btn-sm" type="button" id="qrCopyLink" data-action="copy-link">Copy link</button>
                  </div>
                </div>
              </div>
            </section>

            <!-- Remove hidden when SMS is configured -->
            <section class="quick-donate-card" id="textDonateCard" aria-label="Text to donate" hidden>
              <div class="kicker">Text to donate</div>
              <div class="text-donate__line">
                Text <span class="badge" id="textDonateKeyword">—</span> to <span class="num" id="textDonatePhone">—</span>
              </div>
              <p class="help" id="textDonateHint">Standard messaging rates may apply.</p>
              <div class="inline-actions">
                <a class="btn btn-secondary btn-sm" href="#" id="textDonateSmsLink">Open texting</a>
                <button class="btn btn-ghost btn-sm" type="button" id="textDonateCopy">Copy</button>
              </div>
            </section>

            <!-- Flagship add-on: social proof (IDs preserved; safe to ignore if not populated) -->
            <section class="quick-donate-card" aria-label="Recent gifts">
              <div class="kicker">Recent gifts</div>
              <p class="help">Live donor activity helps new supporters trust fast.</p>

              <div class="gifts" id="giftsList" aria-label="Recent donor gifts list">
                <div class="gift skeleton" aria-hidden="true" style="height:56px;"></div>
                <div class="gift skeleton" aria-hidden="true" style="height:56px;"></div>
                <div class="gift skeleton" aria-hidden="true" style="height:56px;"></div>
              </div>

              <p class="help" style="margin-top:.6rem;">
                Tip: sharing a link right after a gift improves follow-on conversions.
              </p>
            </section>
          </div>

          <div class="divider" aria-hidden="true"></div>

          <div
            class="meter meter--flagship"
            role="progressbar"
            aria-label="Overall fundraising progress"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="0"
            aria-valuetext="0% funded"
          >
            <div class="milestones" aria-hidden="true">
              <i style="left:25%"></i>
              <i style="left:50%"></i>
              <i style="left:75%"></i>
              <i style="left:100%"></i>
            </div>
            <span id="overallBar"></span>
          </div>

          <div class="stat-row" aria-label="Raised and goal numbers">
            <span>Raised: <span class="num" id="raisedRow">$0</span></span>
            <span>Goal: <span class="num" id="goalRow">$0</span></span>
            <span><strong class="num" id="pctText">0</strong>%</span>
          </div>

          <div class="divider" aria-hidden="true"></div>

          <div class="grid progress-mini-grid">
            <div class="mini progress-mini mini--soft">
              <div>
                <div class="kicker">Donors</div>
                <div class="progress-metric num" id="donorsText">0</div>
              </div>
              <div class="progress-mini__right">
                <div class="kicker">Avg gift</div>
                <div class="progress-metric num" id="avgGiftText">$0</div>
              </div>
            </div>

            <div class="mini progress-mini mini--soft">
              <div>
                <div class="kicker">Days left</div>
                <div class="progress-metric num" id="daysLeftText">—</div>
              </div>
              <div class="progress-mini__right">
                <div class="kicker">Next milestone</div>
                <div class="progress-metric num" id="nextMilestoneText">—</div>
              </div>
            </div>
          </div>

          <div class="divider" aria-hidden="true"></div>

          <div class="kicker">Quick gifts</div>
          <p class="help progress-help">One tap prefills checkout.</p>

          <div class="chip-row" role="group" aria-label="Quick gift buttons">
            <button class="chip" type="button" data-quick-amount="25" aria-pressed="false">$25</button>
            <button class="chip" type="button" data-quick-amount="75" aria-pressed="false">$75</button>
            <button class="chip" type="button" data-quick-amount="150" aria-pressed="false">$150</button>
            <button class="chip" type="button" data-quick-amount="500" aria-pressed="false">$500</button>
            <button class="chip" type="button" data-quick-amount="1000" aria-pressed="false">Sponsor $1,000</button>
          </div>

          <div class="divider" aria-hidden="true"></div>

          <div class="progress-actions">
            <button class="btn btn-secondary btn-sm" type="button" id="shareBtn2" data-action="share">Share</button>
            <button class="btn btn-ghost btn-sm" type="button" id="copyLinkBtn3" data-action="copy-link">Copy link</button>
            <a class="btn btn-primary btn-sm" href="#donate" aria-label="Jump to donation form">Donate</a>
          </div>

          <p class="help progress-micro">
            Secure payment opens on this page. Receipt arrives by email after payment.
          </p>
        </article>
      </aside>
    </div>
  </section>

  <!-- Impact (flagship) -->
  <section id="impact" class="section section--flagship" aria-labelledby="impactTitle">
    <div class="container">
      <header class="section-head section-head--split">
        <div class="section-head__left">
          <div class="kicker">Impact</div>
          <h2 id="impactTitle">Every dollar has a job.</h2>
          <p class="measure">
            Transparent use of funds across <strong>gear</strong>, <strong>gym time</strong>, <strong>travel</strong>,
            <strong>snacks</strong>, and <strong>scholarships</strong>. Choose an option below to prefill a secure donation.
          </p>
          <div class="sr-only" id="impactStatus" aria-live="polite" aria-atomic="true"></div>
        </div>

        <div class="section-head__right">
          <article class="mini mini--callout" aria-label="Impact note">
            <div class="kicker">Fast checkout</div>
            <h3 class="mini-title">Tap an impact → prefilled gift</h3>
            <p class="help">
              Pick an impact card to prefill the amount and tag—then confirm in Stripe on-page.
              No redirect. No account.
            </p>
            <div class="inline-actions" style="margin-top:.7rem;">
              <a class="btn btn-primary btn-sm" href="#donate" aria-label="Jump to donation form">Donate now</a>
              <a class="btn btn-secondary btn-sm" href="#sponsors" aria-label="Explore sponsorships">Sponsor tiers</a>
            </div>
          </article>
        </div>
      </header>

      <div class="grid grid-2" style="align-items:start; gap:var(--s-4);">
        <article class="card pad lift" aria-label="Typical allocation">
          <div class="card-head">
            <div class="card-head__copy">
              <div class="kicker">Transparency</div>
              <h3 class="card-title">Where funds typically go</h3>
              <p class="help measure">
                These categories reflect real season costs. Exact allocations may shift week-to-week based on tournaments and gym availability.
              </p>
            </div>
            <div class="card-head__actions">
              <a class="btn btn-secondary btn-sm" href="#donate" aria-label="Support the season">Support the season</a>
            </div>
          </div>

          <div class="allocation allocation--flagship" id="allocationBars" aria-label="Typical fund allocation bars">
            <div class="skeleton" aria-hidden="true" style="height:14px;"></div>
            <div class="skeleton" aria-hidden="true" style="height:14px;"></div>
            <div class="skeleton" aria-hidden="true" style="height:14px;"></div>
          </div>

          <div class="divider" aria-hidden="true"></div>
          <div class="help">Tip: pairing this with a sponsor wall increases trust for new donors.</div>
        </article>

        <div>
          <div class="kicker">Pick an impact</div>
          <h3 style="margin-top:.35rem;">Choose what you want to fund</h3>
          <p class="help measure" style="margin-top:.35rem;">
            Each option prefills a secure donation amount and highlights where it helps most.
          </p>

          <div aria-hidden="true" style="height:var(--s-3);"></div>

          <div class="grid grid-3" id="impactGrid" role="list" aria-label="Impact options">
            <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
            <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
            <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
          </div>

          <div class="section-actions" role="group" aria-label="Impact actions" style="margin-top:var(--s-4);">
            <a class="btn btn-primary" href="#donate">Make a donation</a>
            <a class="btn btn-secondary" href="#sponsors">Explore sponsorships</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Teams (flagship) -->
  <section id="teams" class="section section--flagship" aria-labelledby="teamsTitle">
    <div class="container">
      <header class="section-head section-head--split">
        <div class="section-head__left">
          <div class="kicker">Teams</div>
          <h2 id="teamsTitle">Support a team—or the whole program.</h2>
          <p class="measure">
            Team tags help reporting and recognition. Funds still support the full program unless your organization restricts allocations.
          </p>
        </div>

        <div class="section-head__right">
          <article class="mini mini--callout" aria-label="Sharing tip">
            <div class="kicker">Conversion tip</div>
            <h3 class="mini-title">One weekly update = more gifts</h3>
            <p class="help">
              Post a short story (photo + 2–3 sentences). It boosts cold-traffic trust and increases shares.
            </p>
          </article>
        </div>
      </header>

      <article class="card pad lift" aria-label="Team selection tools">
        <div class="tools-head tools-head--flagship">
          <div>
            <h3 style="margin:0;">Find a team <span class="help">(optional)</span></h3>
            <p class="help measure" style="margin-top:.4rem;">
              Choose a team to tag your gift, or keep <strong>All teams</strong> for maximum flexibility.
            </p>
          </div>

          <div class="segmented" role="tablist" aria-label="Team filter" id="teamFilter">
            <button type="button" data-team-filter="all" aria-pressed="true">All teams</button>
            <button type="button" data-team-filter="featured" aria-pressed="false">Featured</button>
            <button type="button" data-team-filter="needs" aria-pressed="false">Needing support</button>
          </div>
        </div>

        <div class="grid grid-2" style="gap:var(--s-3); margin-top:var(--s-3); align-items:end;">
          <div class="field">
            <label for="teamSearch">Search teams</label>
            <input
              id="teamSearch"
              type="search"
              placeholder="Type a team name…"
              autocomplete="off"
              aria-describedby="teamSearchHelp"
            />
            <div class="help" id="teamSearchHelp">
              Try “12U”, “Elite”, or a coach’s name.
            </div>
          </div>

          <div class="mini mini--compact" aria-label="Team tagging note">
            <div class="kicker">Tagging</div>
            <p class="help" style="margin-top:.35rem;">
              Tagging helps recognition and sponsor shoutouts—without limiting support unless restricted.
            </p>
          </div>
        </div>
      </article>

      <div aria-hidden="true" style="height:var(--s-4);"></div>

      <div id="teamsGrid" class="grid grid-3" role="list" aria-label="Team cards">
        <div class="skeleton" aria-hidden="true" style="height:360px;"></div>
        <div class="skeleton" aria-hidden="true" style="height:360px;"></div>
        <div class="skeleton" aria-hidden="true" style="height:360px;"></div>
      </div>
    </div>
  </section>

  <!-- Sponsors (flagship) -->
  <section id="sponsors" class="section section--flagship" aria-labelledby="sponsorsTitle">
    <div class="container">
      <header class="section-head section-head--split">
        <div class="section-head__left">
          <div class="kicker">Sponsors</div>
          <h2 id="sponsorsTitle">A sponsor wall kids can point to.</h2>
          <p class="measure">
            Families and local businesses that step up get pride-of-place online and at key events.
            Sponsor tiers below prefill instantly.
          </p>
        </div>

        <div class="section-head__right">
          <div class="section-actions" role="group" aria-label="Sponsor actions">
            <a class="btn btn-secondary" href="#donate">Make a donation</a>
            <button class="btn btn-primary" type="button" data-prefill-amount="1000" aria-label="Prefill sponsor donation of $1,000">
              Become a sponsor →
            </button>
          </div>
          <p class="help" style="margin-top:.6rem;">
            Sponsors receive a share-ready shoutout and a clean receipt for records.
          </p>
        </div>
      </header>

      <div class="grid grid-2" style="align-items:start; gap:var(--s-4);">
        <aside class="card pad lift" aria-label="Sponsor leaderboard">
          <div class="kicker">VIP sponsor leaderboard</div>
          <h3 style="margin-top:.35rem;">Top sponsors</h3>
          <p class="help measure" style="margin-top:.35rem;">
            Sponsor gifts stabilize travel, equipment, and scholarships—plus sponsors get premium placement.
          </p>

          <div class="divider" aria-hidden="true"></div>

          <div id="sponsorWall" class="leaderboard leaderboard--flagship" aria-label="Sponsor wall list">
            <div class="leader skeleton" aria-hidden="true" style="height:64px;"></div>
            <div class="leader skeleton" aria-hidden="true" style="height:64px;"></div>
            <div class="leader skeleton" aria-hidden="true" style="height:64px;"></div>
          </div>

          <div class="divider" aria-hidden="true"></div>

          <article class="mini mini--spotlight" aria-label="Sponsor spotlight">
            <div class="kicker">Spotlight</div>
            <h3 style="margin-top:.35rem;" id="spotlightTitle">Sponsor spotlight</h3>
            <p class="help measure" style="margin-top:.35rem;" id="spotlightCopy">
              Sponsors receive shareable recognition. Ask about the optional Sponsor Kit.
            </p>

            <div style="display:flex; gap:.6rem; flex-wrap:wrap; margin-top:.85rem;">
              <button class="btn btn-secondary btn-sm" type="button" id="copySponsorBadgeBtn">Copy sponsor badge</button>
              <button class="btn btn-secondary btn-sm" type="button" id="openSponsorKit" aria-label="Open Sponsor Kit">Sponsor Kit</button>
              <button class="btn btn-ghost btn-sm" type="button" data-prefill-amount="250" aria-label="Prefill Bronze sponsor donation of $250">
                Bronze $250
              </button>
            </div>

            <p class="help" style="margin-top:.75rem;">
              Sponsor benefit: simple, ready-to-post copy + a clean receipt for accounting.
            </p>
          </article>
        </aside>

        <div aria-label="Sponsor tiers">
          <div class="kicker">Sponsor tiers</div>
          <h3 style="margin-top:.35rem;">Pick a tier (prefills instantly)</h3>
          <p class="help measure" style="margin-top:.35rem;">
            Designed for small businesses: clear amounts, clean placement, easy receipt.
          </p>

          <div aria-hidden="true" style="height:var(--s-3);"></div>

          <div id="sponsorTiers" style="display:grid; gap:var(--s-3);" aria-label="Sponsor tiers list">
            <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
            <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
          </div>

          <div class="section-actions" role="group" aria-label="Sponsor follow-up actions" style="margin-top:var(--s-4);">
            <button class="btn btn-primary" type="button" data-prefill-amount="1000" aria-label="Prefill sponsor donation of $1,000">
              Sponsor $1,000 →
            </button>
            <a class="btn btn-secondary" href="#donate">Custom amount</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Donate -->
  <section id="donate" class="section donate" aria-labelledby="donateTitle" data-ff-donate>
    <div class="container">
      <header class="section-head donate__head">
        <p class="kicker">Donate</p>
        <h2 id="donateTitle">Make a gift in under a minute.</h2>
        <p class="measure help">
          Secure checkout powered by Stripe. The payment form opens in a modal on this page—no redirect and no account required.
        </p>

        <!-- Flagship add-on: micro stepper (pure markup; safe) -->
        <div class="mini mini--soft" aria-label="Donation steps" style="margin-top:var(--s-4);">
          <div class="kicker">How it works</div>
          <p class="help" style="margin-top:.35rem;">
            <strong>1)</strong> Choose amount
            <span aria-hidden="true"> • </span>
            <strong>2)</strong> Add name + email
            <span aria-hidden="true"> • </span>
            <strong>3)</strong> Pay securely in Stripe
            <span aria-hidden="true"> • </span>
            <strong>Receipt</strong> emailed instantly
          </p>
        </div>
      </header>

      <article class="card pad lift donate__card" aria-label="Donation form">
        <form class="donate__form" data-ff-donation-form novalidate>
          <!-- Summary + intro -->
          <div class="donate__top">
            <div class="donate__intro">
              <h3 class="donate__h3">Donation details</h3>
              <p class="help donate__sub">
                Choose an amount, optionally tag a team, then continue to secure Stripe payment.
              </p>
            </div>

            <aside class="mini donate__summary" aria-label="Donation summary">
              <p class="kicker">Your gift</p>

              <p class="big-raise num donate__summary-amount" data-ff-bind="summaryAmount" aria-live="polite" aria-atomic="true">
                $0
              </p>

              <p class="help" data-ff-bind="summaryFreq" aria-live="polite" aria-atomic="true">One-time</p>

              <p class="help donate__fee" data-ff-bind="summaryFeeLine" hidden></p>

              <!-- Receipt preview (front-end only; updated live) -->
              <div class="receipt" data-ff-receipt aria-label="Receipt preview">
                <div class="receipt-row">
                  <span>Donation</span>
                  <span class="num" data-ff-bind="receiptBase">$0</span>
                </div>

                <div class="receipt-row" data-ff-bind="receiptRoundRow" hidden>
                  <span>Round up</span>
                  <span class="num" data-ff-bind="receiptRound">$0</span>
                </div>

                <div class="receipt-row" data-ff-bind="receiptFeeRow" hidden>
                  <span>Processing fees</span>
                  <span class="num" data-ff-bind="receiptFee">$0</span>
                </div>

                <div class="divider" aria-hidden="true"></div>

                <div class="receipt-total">
                  <span>Total</span>
                  <span class="num" data-ff-bind="receiptTotal" aria-live="polite" aria-atomic="true">$0</span>
                </div>
              </div>

              <p class="help" style="margin-top:.75rem;">
                Privacy: email is used for receipts and optional updates (unsubscribe anytime).
              </p>
            </aside>
          </div>

          <!-- Form-level error -->
          <div class="alert" data-ff-bind="formError" role="alert" aria-live="polite" aria-atomic="true" hidden></div>

          <!-- Hidden fields used by checkout -->
          <input type="hidden" name="ff_total" data-ff-bind="ffTotalHidden" value="0" />
          <input type="hidden" name="ff_idem" data-ff-bind="ffIdemHidden" value="" />

          <!-- Amount -->
          <fieldset class="field" aria-labelledby="amountLegend">
            <legend id="amountLegend" class="label">Amount</legend>

            <div class="kicker">Sponsor tiers</div>
            <div class="chip-row" role="group" aria-label="Sponsor tiers">
              <button
                class="chip chip--tier"
                type="button"
                data-ff-action="prefill"
                data-ff-amount="250"
                data-ff-tier="bronze"
                aria-pressed="false"
              >
                Bronze $250
              </button>
              <button
                class="chip chip--tier"
                type="button"
                data-ff-action="prefill"
                data-ff-amount="500"
                data-ff-tier="silver"
                aria-pressed="false"
              >
                Silver $500
              </button>
              <button
                class="chip chip--tier"
                type="button"
                data-ff-action="prefill"
                data-ff-amount="1000"
                data-ff-tier="gold"
                aria-pressed="false"
              >
                Gold $1,000
              </button>
            </div>

            <p class="help">Sponsors get recognition on the leaderboard and a share-ready shoutout.</p>

            <div class="divider" aria-hidden="true"></div>

            <div class="chip-row" role="group" aria-label="Quick amounts">
              <button class="chip" type="button" data-ff-action="prefill" data-ff-amount="25" aria-pressed="false">$25</button>
              <button class="chip" type="button" data-ff-action="prefill" data-ff-amount="50" aria-pressed="false">$50</button>
              <button class="chip" type="button" data-ff-action="prefill" data-ff-amount="100" aria-pressed="false">$100</button>
              <button class="chip" type="button" data-ff-action="prefill" data-ff-amount="250" aria-pressed="false">$250</button>
              <button class="chip" type="button" data-ff-action="prefill" data-ff-amount="500" aria-pressed="false">$500</button>
            </div>

            <label class="sr-only" for="ffAmount">Custom amount</label>
            <input
              id="ffAmount"
              name="amount"
              type="number"
              inputmode="decimal"
              min="1"
              max="50000"
              step="1"
              placeholder="Custom amount"
              required
              aria-describedby="amountHelp"
              data-ff-field="amount"
            />
            <p id="amountHelp" class="help">Receipt is emailed immediately after successful payment.</p>
          </fieldset>

          <!-- Frequency -->
          <fieldset class="field" aria-labelledby="freqLegend">
            <legend id="freqLegend" class="label">Frequency</legend>

            <div class="segmented" role="group" aria-label="Donation frequency">
              <button type="button" data-ff-action="set-frequency" data-ff-frequency="once" aria-pressed="true">
                One-time
              </button>
              <button
                type="button"
                data-ff-action="set-frequency"
                data-ff-frequency="monthly"
                aria-pressed="false"
                aria-disabled="true"
                disabled
                title="Monthly donations require subscriptions to be enabled"
              >
                Monthly (not enabled)
              </button>
            </div>

            <input type="hidden" name="frequency" data-ff-bind="frequencyHidden" value="once" />
            <p class="help">Monthly can be enabled when subscriptions are configured.</p>
          </fieldset>

          <!-- Team -->
          <div class="field">
            <label for="ffTeamSelect">Tag a team <span class="help">(optional)</span></label>
            <select id="ffTeamSelect" name="team_focus" aria-describedby="teamHelp" data-ff-bind="teamSelect">
              <option value="all">All teams • Support the full program</option>
            </select>
            <p id="teamHelp" class="help">Team tags help reporting and recognition.</p>
          </div>

          <!-- Donor type -->
          <fieldset class="field" aria-labelledby="donorTypeLegend">
            <legend id="donorTypeLegend" class="label">Donor type</legend>

            <div class="segmented" role="group" aria-label="Donor type">
              <button type="button" data-ff-action="set-donor-type" data-ff-donor-type="individual" aria-pressed="true">
                Individual
              </button>
              <button type="button" data-ff-action="set-donor-type" data-ff-donor-type="business" aria-pressed="false">
                Business / Sponsor
              </button>
            </div>

            <input type="hidden" name="donor_type" data-ff-bind="donorTypeHidden" value="individual" />
            <p class="help">Business sponsors can be displayed on the sponsor wall.</p>
          </fieldset>

          <!-- Business fields -->
          <div class="grid grid-2" data-ff-business-fields hidden aria-label="Business sponsor details">
            <div class="field">
              <label for="ffCompanyName">Business name</label>
              <input id="ffCompanyName" name="company_name" placeholder="Company LLC" autocomplete="organization" />
            </div>

            <div class="field">
              <label for="ffCompanyWebsite">Website <span class="help">(optional)</span></label>
              <input id="ffCompanyWebsite" name="company_website" placeholder="https://company.com" inputmode="url" />
            </div>

            <div class="field" style="grid-column:1/-1;">
              <label for="ffSponsorDisplayName">Display name on sponsor wall <span class="help">(optional)</span></label>
              <input
                id="ffSponsorDisplayName"
                name="sponsor_display_name"
                placeholder="Company LLC (or 'Anonymous Sponsor')"
              />
              <p class="help">If blank, we’ll use your Business name.</p>
            </div>

            <div class="field" style="grid-column:1/-1;">
              <label for="ffLogoUrl">Logo URL <span class="help">(optional)</span></label>
              <input id="ffLogoUrl" name="logo_url" placeholder="Paste a logo image URL (PNG/SVG)" inputmode="url" />
              <p class="help">No upload required. You can add this later too.</p>
            </div>

            <label class="check" style="grid-column:1/-1;">
              <input type="checkbox" data-ff-action="toggle-invoice" />
              <span>I need an invoice / receipt for accounting</span>
            </label>

            <div class="field" data-ff-invoice-fields style="grid-column:1/-1;" hidden>
              <label for="ffInvoiceEmail">Invoice email <span class="help">(optional)</span></label>
              <input id="ffInvoiceEmail" name="invoice_email" type="email" placeholder="accounting@company.com" inputmode="email" />
              <p class="help">We’ll send the receipt here in addition to your main email.</p>
            </div>
          </div>

          <!-- Identity -->
          <div class="grid grid-2 donate__identity">
            <div class="field">
              <label for="ffName">Name</label>
              <input id="ffName" name="name" autocomplete="name" placeholder="Your name" required />
            </div>

            <div class="field">
              <label for="ffEmail">Email</label>
              <input
                id="ffEmail"
                name="email"
                type="email"
                autocomplete="email"
                inputmode="email"
                placeholder="you@example.com"
                required
                aria-describedby="emailHelp"
              />
              <p id="emailHelp" class="help">Used for your receipt and optional updates (unsubscribe anytime).</p>
            </div>
          </div>

          <!-- Note -->
          <div class="field">
            <label for="ffNote">Message to the team <span class="help">(optional)</span></label>
            <textarea id="ffNote" name="note" placeholder="Send a note to the team…"></textarea>
            <p class="help">Your note may be shared with coaches/staff.</p>
          </div>

          <!-- Dedication -->
          <label class="check">
            <input type="checkbox" data-ff-action="toggle-dedication" />
            <span>Dedicate this gift (in honor / in memory)</span>
          </label>

          <div class="grid grid-2" data-ff-dedication-fields hidden aria-label="Dedication details">
            <div class="field">
              <label for="ffDedicationType">Dedication type</label>
              <select id="ffDedicationType" name="dedication_type">
                <option value="honor">In honor of</option>
                <option value="memory">In memory of</option>
              </select>
            </div>

            <div class="field">
              <label for="ffHonoreeName">Name</label>
              <input id="ffHonoreeName" name="honoree_name" placeholder="Honoree name" />
            </div>

            <div class="field" style="grid-column:1/-1;">
              <label for="ffNotifyEmail">Notify email <span class="help">(optional)</span></label>
              <input id="ffNotifyEmail" name="notify_email" type="email" placeholder="person@example.com" inputmode="email" />
              <p class="help">We’ll send a simple “a gift was made in your honor” note (no amount shown).</p>
            </div>
          </div>

          <!-- Anonymous -->
          <label class="check">
            <input type="checkbox" name="anonymous" value="1" data-ff-field="anonymous" />
            <span>Show my gift as “Anonymous” on public lists</span>
          </label>

          <!-- Options -->
          <fieldset class="checks" aria-label="Donation options">
            <legend class="sr-only">Donation options</legend>

            <label class="check">
              <input type="checkbox" name="cover_fees" value="1" data-ff-action="toggle-cover-fees" />
              <span>Add a little extra to cover processing fees (optional)</span>
            </label>

            <label class="check">
              <input type="checkbox" name="round_up" value="1" data-ff-action="toggle-round-up" />
              <span>Round up to the next $5</span>
            </label>

            <label class="check">
              <input type="checkbox" name="updates_opt_in" value="1" checked />
              <span>Email me program updates (optional)</span>
            </label>

            <label class="check">
              <input type="checkbox" name="save_info" value="1" checked />
              <span>Save my info for next time on this device</span>
            </label>
          </fieldset>

          <!-- Primary submit -->
          <button class="btn btn-primary" type="submit" data-ff-submit aria-disabled="true" disabled>
            Continue to secure payment
          </button>

          <p class="help donate__wallet">
            Wallet options (Apple Pay / Google Pay) may appear if available on your device.
          </p>

          <!-- Secondary actions -->
          <div class="donate__actions cluster">
            <button
              class="btn btn-secondary"
              type="button"
              data-ff-action="paypal"
              aria-disabled="true"
              disabled
              title="PayPal is not connected yet"
            >
              PayPal (coming soon)
            </button>
            <button class="btn btn-ghost" type="button" data-ff-action="copy-link">Copy link</button>
          </div>

          <p class="help donate__trust">
            Secure checkout by <strong>Stripe</strong>. <strong>Card details never touch our servers.</strong> Receipt emailed instantly.
          </p>

          <!-- Tax / receipt details -->
          <div class="notice donate__tax" aria-label="Tax and receipt details">
            <div class="kicker">Receipt &amp; records</div>
            <p class="help">
              You’ll receive an email receipt immediately. If applicable, include this for tax records.
            </p>
            <p class="help">
              <strong data-ff-bind="orgLegalName">Organization Name</strong> • EIN
              <span class="num" data-ff-bind="orgEin">XX-XXXXXXX</span>
            </p>
          </div>

          <div class="trust-logos" aria-label="Trust logos">
            <span>Stripe</span>
            <span>Apple Pay (if available)</span>
            <span>Google Pay (if available)</span>
            <span>Cards</span>
          </div>

          <noscript>
            <div class="alert" role="alert">
              JavaScript is required to complete secure checkout. Please enable JavaScript or contact support.
            </div>
          </noscript>
        </form>
      </article>

      <div aria-hidden="true" style="height:var(--s-3);"></div>

      <!-- FAQ (conversion + support) -->
      <article class="card pad lift faq" aria-label="Donation FAQ">
        <div class="kicker">FAQ</div>
        <h3 style="margin-top:.35rem;">Quick answers</h3>
        <p class="help measure" style="margin-top:.35rem;">
          These cover the most common questions from donors and sponsors.
        </p>

        <div class="faq__list" role="list">
          <details role="listitem">
            <summary>Will I get a receipt?</summary>
            <p class="help">Yes—an email receipt is sent immediately after a successful payment.</p>
          </details>

          <details role="listitem">
            <summary>Is this payment secure?</summary>
            <p class="help">Yes. Payments are encrypted and processed by Stripe. Card details never touch our servers.</p>
          </details>

          <details role="listitem">
            <summary>Can I sponsor as a business?</summary>
            <p class="help">Absolutely. Sponsors show up on the leaderboard and can use the Sponsor Kit for share-ready recognition.</p>
          </details>

          <details role="listitem">
            <summary>Can I tag a team?</summary>
            <p class="help">Yes. Team tags help reporting and recognition.</p>
          </details>

          <details role="listitem">
            <summary>Can I dedicate a gift?</summary>
            <p class="help">Yes—toggle “Dedicate this gift” to add an in-honor/in-memory note and an optional notification email.</p>
          </details>

          <details role="listitem">
            <summary>What if live totals are temporarily unavailable?</summary>
            <p class="help">You can still donate—checkout remains secure and receipts still send.</p>
          </details>
        </div>
      </article>
    </div>
  </section>
</main>

<!-- Sponsor Kit Modal (front-end only) -->
<div
  class="modal"
  data-ff-sponsor-kit-modal
  data-open="false"
  role="dialog"
  aria-modal="true"
  aria-labelledby="ffSponsorKitTitle"
  aria-describedby="ffSponsorKitDesc"
  aria-hidden="true"
  hidden
>
  <div class="modal-panel modal-panel--narrow" role="document" tabindex="-1">
    <div class="modal-body stack stack-md">
      <div class="modal-head cluster cluster-between">
        <div class="modal-head__copy stack stack-xs">
          <p class="kicker">Sponsor Kit</p>
          <h3 class="modal-title" id="ffSponsorKitTitle">Share-ready sponsor copy</h3>
          <p class="help measure" id="ffSponsorKitDesc">
            Copy a sponsor message, a share link, or a quick badge line. No login. No backend required.
          </p>
        </div>

        <button
          class="icon-btn"
          type="button"
          data-ff-action="close-sponsor-kit"
          aria-label="Close Sponsor Kit"
          title="Close"
        >✕</button>
      </div>

      <div class="notice stack stack-sm" aria-label="Sponsor kit preview">
        <div>
          <div class="kicker">Message</div>
          <p class="help" data-ff-bind="sponsorKitMessagePreview"></p>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <div>
          <div class="kicker">Badge line</div>
          <p class="help" data-ff-bind="sponsorKitBadgePreview"></p>
        </div>
      </div>

      <div class="modal-actions cluster" aria-label="Sponsor kit actions">
        <button class="btn btn-secondary" type="button" data-ff-action="copy-sponsor-message">
          Copy sponsor message
        </button>
        <button class="btn btn-secondary" type="button" data-ff-action="copy-sponsor-badge">
          Copy badge line
        </button>
        <button class="btn btn-ghost" type="button" data-ff-action="copy-link">
          Copy fundraiser link
        </button>
        <button class="btn btn-ghost" type="button" data-ff-action="close-sponsor-kit">
          Close
        </button>
      </div>

      <p class="help">Tip: businesses love simple copy they can paste into email, Instagram, and newsletters.</p>
    </div>
  </div>
</div>

<!-- Share Options Modal (UTM builder + variants; default share buttons remain unchanged) -->
<div
  class="modal"
  data-ff-share-options-modal
  data-open="false"
  role="dialog"
  aria-modal="true"
  aria-labelledby="ffShareOptionsTitle"
  aria-describedby="ffShareOptionsDesc"
  aria-hidden="true"
  hidden
>
  <div class="modal-panel modal-panel--narrow" role="document" tabindex="-1">
    <div class="modal-body stack stack-md">
      <div class="modal-head cluster cluster-between">
        <div class="modal-head__copy stack stack-xs">
          <p class="kicker">Share options</p>
          <h3 class="modal-title" id="ffShareOptionsTitle">Make your link work harder</h3>
          <p class="help measure" id="ffShareOptionsDesc">
            Add optional UTM tags and pick a share message. Default share buttons still use the clean canonical link.
          </p>
        </div>

        <button
          class="icon-btn"
          type="button"
          data-ff-action="close-share-options"
          aria-label="Close share options"
          title="Close"
        >✕</button>
      </div>

      <div class="grid">
        <div class="field">
          <label for="ffShareVariant">Message style</label>
          <select id="ffShareVariant" data-ff-bind="shareVariant">
            <option value="standard">Standard</option>
            <option value="urgent">Urgent / deadline</option>
            <option value="sponsor">Sponsor ask</option>
          </select>
          <p class="help">Choose a tone that matches your audience.</p>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <div class="kicker">UTM (optional)</div>

        <div class="grid grid-2">
          <div class="field">
            <label for="ffUtmSource">utm_source</label>
            <input id="ffUtmSource" type="text" placeholder="instagram, email, newsletter…" data-ff-bind="utmSource" />
          </div>
          <div class="field">
            <label for="ffUtmMedium">utm_medium</label>
            <input id="ffUtmMedium" type="text" placeholder="social, email, sms…" data-ff-bind="utmMedium" />
          </div>
        </div>

        <div class="field">
          <label for="ffUtmCampaign">utm_campaign</label>
          <input id="ffUtmCampaign" type="text" placeholder="winter-fundraiser, tournament-2026…" data-ff-bind="utmCampaign" />
        </div>

        <div class="notice" aria-label="Generated link">
          <div class="kicker">Your share link</div>
          <p class="help break-word" data-ff-bind="shareLinkPreview"></p>
        </div>

        <!-- Premium: QR for the generated UTM link -->
        <div class="notice stack stack-sm" aria-label="QR code for share link">
          <div class="kicker">QR code</div>
          <img
            data-ff-bind="shareQrImg"
            width="160"
            height="160"
            alt="QR code for your share link"
            loading="lazy"
            decoding="async"
            class="qr-small"
          />
          <p class="help">Perfect for flyers and printed handouts.</p>
        </div>

        <div class="notice" aria-label="Generated message">
          <div class="kicker">Your message</div>
          <p class="help" data-ff-bind="shareTextPreview"></p>
        </div>
      </div>

      <div class="modal-actions cluster" aria-label="Share options actions">
        <button class="btn btn-secondary" type="button" data-ff-action="copy-share-link">Copy link</button>
        <button class="btn btn-primary" type="button" data-ff-action="native-share-utm">Share</button>
        <button class="btn btn-ghost" type="button" data-ff-action="close-share-options">Close</button>
      </div>

      <p class="help">Privacy note: UTM tags only help attribution; they don’t change secure checkout.</p>
    </div>
  </div>
</div>

<!-- SITE FOOTER (render ONCE) -->
<footer class="site-footer" role="contentinfo" aria-label="Site footer" data-ff-footer>
  <div class="container site-footer__container stack stack-lg">
    <!-- Top row -->
    <div class="site-footer__top footer-grid">
      <!-- Brand / meta -->
      <div class="site-footer__brand stack stack-md" aria-label="Footer brand">
        <a class="brand brand--footer cluster" href="#top" aria-label="Home">
          <div class="brand-mark" aria-hidden="true" data-ff-bind="brandMark">FF</div>

          <div class="brand-text stack stack-xs">
            <div class="brand-title" data-ff-bind="brandName">FutureFunded</div>
            <div class="brand-sub" data-ff-bind="brandTagline">
              Fundraising infrastructure for teams, schools, and nonprofits.
            </div>
          </div>
        </a>

        <div class="site-footer__meta cluster" aria-label="Fundraiser verification">
          <span class="pill pill-verified" data-ff-bind="verifiedLabel" aria-label="Verified fundraiser">Verified</span>
          <span class="pill pill-muted" data-ff-bind="secureLabel">Secure Stripe checkout</span>
          <span class="pill pill-muted" data-ff-bind="receiptLabel">Instant email receipt</span>
        </div>

        <address class="site-footer__contact stack stack-xs">
          <a
            class="site-footer__support"
            data-ff-bind="supportEmailLink"
            href="mailto:support@getfuturefunded.com"
          >support@getfuturefunded.com</a>
          <span class="site-footer__contact-meta help" data-ff-bind="supportSub">Support &amp; receipts</span>
        </address>

        <div class="footer-share cluster" aria-label="Footer sharing tools">
          <button class="btn btn-secondary btn-sm" type="button" data-ff-action="share">Share</button>
          <button class="btn btn-ghost btn-sm" type="button" data-ff-action="copy-link">Copy link</button>
          <button
            class="btn btn-ghost btn-sm"
            type="button"
            data-ff-action="open-qr"
            aria-haspopup="dialog"
          >QR</button>
        </div>
      </div>

      <!-- Nav -->
      <nav class="site-footer__nav footer-nav" aria-label="Footer navigation">
        <div class="footer-col stack stack-sm">
          <div class="kicker">Fundraiser</div>
          <ul class="footer-links stack stack-xs">
            <li><a href="#donate">Donate</a></li>
            <li><a href="#progress">Progress</a></li>
            <li><a href="#impact">Impact</a></li>
            <li><a href="#teams">Teams</a></li>
            <li><a href="#sponsors">Sponsors</a></li>
          </ul>
        </div>

        <div class="footer-col stack stack-sm">
          <div class="kicker">For sponsors</div>
          <ul class="footer-links stack stack-xs">
            <li>
              <button class="linklike" type="button" data-ff-action="prefill" data-ff-amount="250" aria-label="Prefill $250">
                Bronze $250
              </button>
            </li>
            <li>
              <button class="linklike" type="button" data-ff-action="prefill" data-ff-amount="500" aria-label="Prefill $500">
                Silver $500
              </button>
            </li>
            <li>
              <button class="linklike" type="button" data-ff-action="prefill" data-ff-amount="1000" aria-label="Prefill $1,000">
                Gold $1,000
              </button>
            </li>
            <li>
              <button class="linklike" type="button" data-ff-action="sponsor-kit">Sponsor Kit</button>
            </li>
          </ul>
        </div>

        <div class="site-footer__legal footer-legal-row">
          <p class="help">
            © <span data-ff-bind="year"></span> <span data-ff-bind="legalBrand">FutureFunded</span> ·
            Hosted for <strong data-ff-bind="orgName">Organization</strong> (EIN <span class="num" data-ff-bind="orgEin">—</span>) ·
            <a href="/privacy" class="footer-legal">Privacy</a> ·
            <a href="/terms" class="footer-legal">Terms</a>
          </p>
          <p class="help">Organizations are responsible for their programs and use of funds.</p>
        </div>
      </nav>

      <!-- CTA -->
      <div class="site-footer__cta" aria-label="Footer actions">
        <div class="mini footer-mini mini--soft stack stack-md" aria-label="Quick donate">
          <div class="stack stack-xs">
            <div class="kicker">Quick donate</div>
            <p class="help">Make a gift in seconds. Secure checkout stays on this page.</p>
          </div>

          <div class="chip-row cluster" role="group" aria-label="Quick gift buttons">
            <button class="chip" type="button" data-ff-action="prefill" data-ff-amount="25" aria-label="Prefill $25">$25</button>
            <button class="chip" type="button" data-ff-action="prefill" data-ff-amount="75" aria-label="Prefill $75">$75</button>
            <button class="chip" type="button" data-ff-action="prefill" data-ff-amount="150" aria-label="Prefill $150">$150</button>
            <button class="chip" type="button" data-ff-action="prefill" data-ff-amount="250" aria-label="Prefill $250">$250</button>
          </div>

          <div class="footer-actions cluster">
            <a class="btn btn-primary btn-sm" href="#donate">Donate</a>
            <button class="btn btn-secondary btn-sm" type="button" data-ff-action="give-again">Give again</button>
          </div>

          <p class="help cluster">
            <span class="badge">No login</span>
            <span class="help" aria-hidden="true">·</span>
            <span class="badge">No redirect</span>
          </p>
        </div>
      </div>
    </div>

    <!-- Trust card -->
    <article class="card pad site-footer__trust lift" aria-label="Payment transparency and trust">
      <div class="site-footer__trust-inner cluster cluster-between">
        <div class="site-footer__trust-copy stack stack-sm">
          <div class="kicker">Trust &amp; Transparency</div>
          <p class="help site-footer__trust-p">
            Payments are encrypted and processed securely by <strong>Stripe</strong>. Receipts are emailed immediately after successful donation.
          </p>
          <ul class="site-footer__trust-list stack stack-xs">
            <li class="help">Card details never touch our servers.</li>
            <li class="help">Donor info is used only for receipts and optional updates.</li>
            <li class="help">We do not sell personal data.</li>
          </ul>
          <p class="help">
            Status: <span class="num" data-ff-bind="statusText">Live</span>
            <span aria-hidden="true"> · </span>
            Updated <span class="num" data-ff-bind="updatedText">—</span>
          </p>
        </div>

        <div class="site-footer__trust-actions cluster">
          <a class="btn btn-secondary btn-sm" href="#donate">Donate now</a>
          <a class="btn btn-ghost btn-sm" href="/privacy">Privacy</a>
        </div>
      </div>
    </article>

    <!-- Legal -->
    <div class="site-footer__legal stack stack-xs">
      <p class="help">
        © <span data-ff-bind="year"></span> <span data-ff-bind="legalBrand">FutureFunded</span>.
        Built for teams, schools, nonprofits, and community programs.
      </p>

      <p class="help">
        Fundraiser hosted for <strong data-ff-bind="orgName">Organization</strong>.
        EIN <span class="num" data-ff-bind="orgEin">—</span>.
      </p>

      <p class="help">Organizations are responsible for their programs and use of funds.</p>

      <p class="help">
        <a href="/privacy" class="footer-legal">Privacy Policy</a>
        <span aria-hidden="true"> · </span>
        <a href="/terms" class="footer-legal">Terms of Service</a>
      </p>
    </div>
  </div>
</footer>

<!-- UI LAYER (NOT part of footer; render ONCE) -->
<div data-ff-ui-layer>
  <!-- Footer QR Modal -->
  <div
    class="modal"
    data-ff-qr-modal
    data-open="false"
    role="dialog"
    aria-modal="true"
    aria-labelledby="ffQrTitle"
    aria-describedby="ffQrDesc"
    aria-hidden="true"
    hidden
  >
    <div class="modal-panel modal-panel--narrow" role="document" tabindex="-1">
      <div class="modal-body stack stack-md">
        <div class="modal-head cluster cluster-between">
          <div class="modal-head__copy stack stack-xs">
            <p class="kicker">QR code</p>
            <h3 class="modal-title" id="ffQrTitle">Scan to donate</h3>
            <p class="help measure" id="ffQrDesc">Perfect for flyers, newsletters, and event signage.</p>
          </div>

          <button class="icon-btn" type="button" data-ff-action="close-qr" aria-label="Close QR modal" title="Close">✕</button>
        </div>

        <figure class="qr-big" aria-label="Fundraiser QR code">
          <img
            class="qr-big__img"
            data-ff-bind="qrImg"
            width="240"
            height="240"
            alt="QR code to this fundraiser"
            loading="lazy"
            decoding="async"
          />
          <figcaption class="help qr-caption">
            <span class="kicker">Link</span><br />
            <span data-ff-bind="qrLink">—</span>
          </figcaption>
        </figure>

        <div class="modal-actions cluster" aria-label="QR actions">
          <button class="btn btn-secondary" type="button" data-ff-action="copy-link">Copy link</button>
          <button class="btn btn-ghost" type="button" data-ff-action="close-qr">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sticky donate bar -->
  <section class="sticky" data-ff-sticky data-show="false" role="region" aria-label="Quick donate bar" hidden>
    <div class="sticky-inner cluster cluster-between">
      <div class="sticky-mini stack stack-xs" aria-live="polite" aria-atomic="true">
        <div class="sticky-top cluster">
          <span class="pill pill-live" aria-label="Live fundraiser">
            <span class="pill-dot" aria-hidden="true"></span>
            <span>LIVE</span>
          </span>
          <span class="help" data-ff-bind="stickyOrgName">Fundraiser</span>
        </div>

        <div class="sticky-bot help">
          <span class="num" data-ff-bind="stickyRaised">$0</span> raised
          <span aria-hidden="true">•</span>
          <span class="num" data-ff-bind="stickyPct">0</span>% funded
          <span aria-hidden="true">•</span>
          Goal <span class="num" data-ff-bind="stickyGoal">$0</span>
        </div>

        <div class="sticky-sub help" data-ff-bind="stickyDeadline">Ends —</div>
      </div>

      <div class="sticky-actions cluster" aria-label="Quick actions">
        <button class="btn btn-secondary btn-sm" type="button" data-ff-action="prefill" data-ff-amount="1000" aria-label="Prefill sponsor donation of $1,000">
          Sponsor
        </button>
        <button class="btn btn-ghost btn-sm" type="button" data-ff-action="copy-link" aria-label="Copy fundraiser link">
          Copy
        </button>
        <a class="btn btn-primary btn-sm" href="#donate" aria-label="Make a donation">Donate</a>
      </div>
    </div>
  </section>

  <!-- Toast -->
  <div class="toast-host" aria-live="polite" aria-atomic="true" aria-relevant="additions text" data-ff-toast-host>
    <div class="toast" role="status" data-ff-toast data-show="false" hidden aria-hidden="true">
      <span class="toast-text" data-ff-bind="toastText">Saved.</span>
      <button type="button" class="toast-close" data-ff-action="toast-close" aria-label="Dismiss notification" title="Dismiss">✕</button>
    </div>
  </div>

  <!-- Back to Top -->
  <button class="back-to-top" type="button" data-ff-back-to-top data-ff-action="back-to-top" aria-label="Scroll back to top" hidden>
    <span aria-hidden="true">↑</span>
    <span class="sr-only">Back to top</span>
  </button>
</div>

<!-- Payment Modal (Stripe Elements) -->
<div
  class="modal"
  data-ff-modal="checkout"
  data-open="false"
  role="dialog"
  aria-modal="true"
  aria-labelledby="ffCheckoutTitle"
  aria-describedby="ffCheckoutDesc"
  aria-hidden="true"
  hidden
>
  <div class="modal-panel" role="document" tabindex="-1">
    <div class="modal-body stack stack-md">
      <div class="modal-head cluster cluster-between">
        <div class="modal-head__copy stack stack-xs">
          <p class="kicker">Secure checkout</p>
          <h3 class="modal-title" id="ffCheckoutTitle">Complete your donation</h3>
          <p class="help measure" id="ffCheckoutDesc">
            This payment is encrypted and processed securely by Stripe. You’ll stay on this page.
          </p>
        </div>

        <button
          class="icon-btn"
          type="button"
          data-ff-action="close-modal"
          data-ff-target="checkout"
          aria-label="Close secure checkout"
          title="Close"
        >
          ✕
        </button>
      </div>

      <!-- Error -->
      <div
        class="alert"
        data-ff-bind="checkoutError"
        role="alert"
        aria-live="polite"
        aria-atomic="true"
        hidden
      ></div>

      <!-- Loading -->
      <div
        class="mini"
        data-ff-bind="checkoutLoading"
        role="status"
        aria-live="polite"
        aria-atomic="true"
        hidden
      >
        <strong>Loading secure payment form…</strong><br />
        This usually takes a moment.
      </div>

      <!-- Stripe mount -->
      <div class="payment-element-wrap" id="paymentElementWrap" aria-label="Secure payment form">
        <div data-ff-payment-element></div>
      </div>

      <div class="modal-actions cluster" aria-label="Checkout actions">
        <button
          class="btn btn-primary"
          type="button"
          data-ff-action="pay-now"
          disabled
          aria-disabled="true"
        >
          Pay now
        </button>

        <button
          class="btn btn-secondary"
          type="button"
          data-ff-action="close-modal"
          data-ff-target="checkout"
        >
          Cancel
        </button>

        <button
          class="btn btn-ghost"
          type="button"
          data-ff-action="checkout-help"
          aria-label="Get help with checkout"
        >
          Need help?
        </button>
      </div>

      <p class="help">
        Receipts are emailed after successful payment.
        <strong>Card details never touch our servers.</strong>
      </p>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div
  class="modal"
  data-ff-modal="success"
  data-open="false"
  role="dialog"
  aria-modal="true"
  aria-labelledby="ffSuccessTitle"
  aria-describedby="ffSuccessDesc"
  aria-hidden="true"
  hidden
>
  <div class="modal-panel" role="document" tabindex="-1">
    <div class="modal-body stack stack-md">
      <div class="modal-head cluster cluster-between">
        <div class="modal-head__copy stack stack-xs">
          <p class="kicker">Donation confirmed</p>
          <h3 class="modal-title" id="ffSuccessTitle">Thank you for supporting the program.</h3>
          <p id="ffSuccessDesc" class="help measure">
            A receipt has been sent to <strong data-ff-bind="successEmail">your email</strong>.
          </p>
        </div>

        <button
          class="icon-btn"
          type="button"
          data-ff-action="close-modal"
          data-ff-target="success"
          aria-label="Close donation confirmation"
          title="Close"
        >
          ✕
        </button>
      </div>

      <div class="grid grid-3" aria-label="Donation summary">
        <div class="mini">
          <p class="kicker">Amount</p>
          <p class="big-raise num" data-ff-bind="successAmount" style="font-size:1.35rem;">$0</p>
          <p class="help">Thank you</p>
        </div>

        <div class="mini">
          <p class="kicker">Frequency</p>
          <p class="num" data-ff-bind="successFrequency" style="font-weight:950;">One-time</p>
          <p class="help">Monthly can be enabled later</p>
        </div>

        <div class="mini">
          <p class="kicker">Tagged</p>
          <p class="num" data-ff-bind="successTeam" style="font-weight:950;">All teams</p>
          <p class="help">Helps reporting</p>
        </div>
      </div>

      <div class="modal-actions cluster" aria-label="Next actions">
        <button class="btn btn-primary" type="button" data-ff-action="share">
          Share this fundraiser
        </button>

        <button class="btn btn-secondary" type="button" data-ff-action="copy-link">
          Copy link
        </button>

        <button
          class="btn btn-ghost"
          type="button"
          data-ff-action="close-modal"
          data-ff-target="success"
        >
          Back to fundraiser
        </button>

        <button
          class="btn btn-secondary"
          type="button"
          data-ff-action="prefill"
          data-ff-amount="250"
          aria-label="Prefill sponsor donation of $250"
        >
          Become a sponsor ($250)
        </button>
      </div>

      <p class="help">
        Your support directly helps with season costs like gym time, travel, and scholarships.
      </p>
    </div>
  </div>
</div>


  <!--
    ⚠️ DO NOT MODIFY
    Stripe live checkout logic.
    Changes can cause double charges or failed payments.
  -->

  <!-- SINGLE FILE: v45 flagship (Stripe Elements safe lifecycle + conversion + PWA hooks) -->
  
  <script>
(() => {
"use strict";

/* ============================================================
FutureFunded Flagship — v46 (CLEAN SINGLE-INIT)

Fixes from your current page:
- ONE initializer only (removes stacked IIFEs)
- Avoids repeated JSON config parsing
- Removes duplicate delegated click binding
- Fixes duplicate ID usage in sponsor tiers (uses data attribute instead)
- No HTML comments inside JS
- Keeps Stripe flow + endpoints + IDs intact
============================================================ */

if (window.__ff_flagship_v44_initialized) return; // keep your existing guard for safety
window.__ff_flagship_v44_initialized = true;

/* -------------------------
Helpers
------------------------- */
const $ = (sel, root = document) => root.querySelector(sel);
const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

const meta = (name) => document.querySelector(`meta[name="${name}"]`)?.getAttribute("content") || "";
const getCsrfToken = () => meta("csrf-token") || meta("csrf") || meta("x-csrf-token");
const getCheckoutEndpoint = () => meta("ff-checkout-endpoint") || meta("ff-embedded-endpoint") || "/payments/stripe/intent";
const getStatusEndpoint = () => meta("ff-status-endpoint") || "/api/status";
const getStripePkFromMeta = () => meta("ff-stripe-pk") || meta("stripe-pk") || "";

const isPlainObject = (v) => !!v && typeof v === "object" && Object.prototype.toString.call(v) === "[object Object]";
const safeClone = (obj) => { try { return structuredClone(obj); } catch { return JSON.parse(JSON.stringify(obj)); } };
const deepMerge = (target, ...sources) => {
  for (const src of sources) {
    if (!isPlainObject(src)) continue;
    for (const [k, v] of Object.entries(src)) {
      if (isPlainObject(v) && isPlainObject(target[k])) target[k] = deepMerge(target[k], v);
      else target[k] = v;
    }
  }
  return target;
};
const readJsonScript = (id) => {
  const el = document.getElementById(id);
  if (!el) return null;
  try {
    const txt = String(el.textContent || "").trim();
    if (!txt) return null;
    return JSON.parse(txt);
  } catch { return null; }
};
const escapeHtml = (s) => String(s ?? "")
  .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
  .replace(/"/g, "&quot;").replace(/'/g, "&#39;");
const isEmail = (v) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(v || "").trim());

const setShown = (el, show) => {
  if (!el) return;
  const on = !!show;
  el.hidden = !on;
  el.setAttribute("data-show", on ? "true" : "false");
  el.setAttribute("aria-hidden", on ? "false" : "true");
};
const setOpenHiddenA11y = (el, open) => {
  if (!el) return;
  const on = !!open;
  el.hidden = !on;
  el.setAttribute("aria-hidden", on ? "false" : "true");
};
const debounce = (fn, wait = 180) => {
  let t = null;
  return (...args) => {
    clearTimeout(t);
    t = setTimeout(() => fn(...args), wait);
  };
};
const uuid = () => {
  if (window.crypto?.randomUUID) return crypto.randomUUID();
  return "ff_" + Date.now().toString(16) + "_" + Math.random().toString(16).slice(2);
};

async function fetchJson(url, { method = "GET", payload, headers = {}, timeoutMs = 15000 } = {}) {
  const ctrl = new AbortController();
  const t = setTimeout(() => ctrl.abort(), timeoutMs);
  try {
    const res = await fetch(url, {
      method,
      credentials: "same-origin",
      headers: {
        Accept: "application/json",
        ...(payload ? { "Content-Type": "application/json" } : {}),
        ...headers,
      },
      body: payload ? JSON.stringify(payload) : undefined,
      signal: ctrl.signal,
      redirect: "follow",
    });

    const ct = (res.headers.get("content-type") || "").toLowerCase();
    if (!ct.includes("application/json")) {
      if (!res.ok) throw new Error(`Request failed (${res.status}).`);
      throw new Error("Expected JSON but received HTML. Check endpoint routing/redirects.");
    }

    const data = await res.json().catch(() => null);
    if (!res.ok || data?.ok === false) {
      const msg = data?.error?.message || data?.message || `Request failed (${res.status})`;
      throw new Error(msg);
    }

    return data;
  } finally {
    clearTimeout(t);
  }
}

/* -------------------------
Focus trap (drawer + modals)
------------------------- */
const FOCUSABLE_SEL = [
  'a[href]',
  'button:not([disabled])',
  'input:not([disabled]):not([type="hidden"])',
  'select:not([disabled])',
  'textarea:not([disabled])',
  '[tabindex]:not([tabindex="-1"])'
].join(",");

const isVisible = (el) => {
  if (!el) return false;
  const style = window.getComputedStyle(el);
  if (style.visibility === "hidden" || style.display === "none") return false;
  return !!(el.offsetWidth || el.offsetHeight || el.getClientRects().length);
};
const getFocusable = (container) => $$(FOCUSABLE_SEL, container).filter((el) => isVisible(el));
const focusFirst = (container) => {
  const f = getFocusable(container);
  if (f.length) { f[0].focus(); return true; }
  container?.focus?.();
  return false;
};
const trapFocus = (container) => {
  const onKeyDown = (e) => {
    if (e.key !== "Tab") return;
    if (!container || container.hidden) return;

    const active = document.activeElement;
    if (!container.contains(active)) return;

    const items = getFocusable(container);
    if (!items.length) return;

    const first = items[0];
    const last = items[items.length - 1];

    if (e.shiftKey && active === first) { e.preventDefault(); last.focus(); }
    else if (!e.shiftKey && active === last) { e.preventDefault(); first.focus(); }
  };

  document.addEventListener("keydown", onKeyDown, true);
  return () => document.removeEventListener("keydown", onKeyDown, true);
};

/* -------------------------
Scroll lock (refcounted)
------------------------- */
let scrollLockCount = 0;
let savedBodyPadRight = "";

const lockScroll = (lock) => {
  const docEl = document.documentElement;
  const body = document.body;

  if (lock) {
    scrollLockCount += 1;
    if (scrollLockCount > 1) return;

    const scrollBarWidth = window.innerWidth - docEl.clientWidth;
    savedBodyPadRight = body.style.paddingRight || "";

    docEl.style.overflow = "hidden";
    body.style.overflow = "hidden";
    if (scrollBarWidth > 0) body.style.paddingRight = scrollBarWidth + "px";
    return;
  }

  scrollLockCount = Math.max(0, scrollLockCount - 1);
  if (scrollLockCount !== 0) return;

  docEl.style.overflow = "";
  body.style.overflow = "";
  body.style.paddingRight = savedBodyPadRight;
};

/* -------------------------
Default Config
------------------------- */
const DEFAULT_CONFIG = {
  brand: { markText: "FF", logoUrl: "", primary: "#C2410C", primaryStrong: "#9A3412", accent: "#F97316" },
  org: { shortName: "Connect ATX Elite", metaLine: "Youth Basketball • Austin, TX", seasonLabel: "2025–2026", sportLabel: "Youth basketball" },
  fundraiser: {
    currency: "USD",
    goal: 25000,
    raised: 0,
    donors: 0,
    deadlineISO: "2026-02-28T23:59:59-06:00",
    match: { active: false, copy: "Match active: gifts are doubled up to $2,500." },
  },
  events: [{ title: "Next tournament weekend", startISO: "2026-01-17T09:00:00-06:00" }],
  allocation: [
    { label: "Travel + tournament fees", pct: 35 },
    { label: "Gym time", pct: 30 },
    { label: "Uniforms + gear", pct: 20 },
    { label: "Hydration + snacks", pct: 10 },
    { label: "Scholarships", pct: 5 },
  ],
  impact: [
    { amount: 25, tag: "Foundation", title: "Hydration & snacks", desc: "Covers drinks and light snacks for a practice or weekend run." },
    { amount: 75, tag: "Game Day", title: "Game day fuel", desc: "Supports a full day of hydration + snacks for a roster." },
    { amount: 150, tag: "Operations", title: "Gym time covered", desc: "Offsets gym rentals so practices stay consistent." },
    { amount: 300, tag: "Travel", title: "Travel + tournament boost", desc: "Helps reduce weekend spikes: travel, fees, and essentials." },
    { amount: 500, tag: "Gear", title: "Uniforms & player gear", desc: "Helps cover jerseys and gear so athletes aren’t paying out-of-pocket." },
    { amount: 1000, tag: "Scholarship", title: "Program anchor", desc: "Protects scholarships + stabilizes travel, gear, and tournament costs.", badge: "Best value" },
  ],
  recentGifts: [
    { who: "Anonymous", amount: 75, minutesAgo: 18 },
    { who: "J. Carter", amount: 25, minutesAgo: 44 },
    { who: "Local Business", amount: 250, minutesAgo: 120 },
    { who: "Anonymous", amount: 50, minutesAgo: 240 },
  ],
  teams: [
    { key: "6g", name: "6th Grade Gold", blurb: "First AAU reps — learning sets, defense, and communication.", goal: 5000, raised: 3420, image: "/static/images/connect-atx-team.jpg", tag: "Featured" },
    { key: "7g", name: "7th Grade Gold", blurb: "Speed + spacing — film, fundamentals, and pressure reps.", goal: 6000, raised: 4680, image: "/static/images/7thGold.jpg" },
    { key: "7b", name: "7th Grade Black", blurb: "Defense travels — effort and stops into transition.", goal: 5000, raised: 2210, image: "/static/images/7thBlack.png" },
    { key: "8g", name: "8th Grade Gold", blurb: "Finish strong — high-intensity reps and leadership.", goal: 6000, raised: 4680, image: "/static/images/8thGold.jpg" },
    { key: "8b", name: "8th Grade Black", blurb: "Next gym ready — advanced reads and competitive weekends.", goal: 5000, raised: 2210, image: "/static/images/connect-atx-team_3.jpg" },
  ],
  sponsors: {
    wall: [
      { name: "River City Dental", meta: "Tournament Sponsor", amount: 1000 },
      { name: "ATX Alumni", meta: "Game Day Sponsor", amount: 500 },
      { name: "Carter Family", meta: "Community Sponsor", amount: 250 },
    ],
    tiers: [
      { name: "Community Sponsor", amount: 250, desc: "Great for families and small businesses.", badges: ["Receipt-ready", "Shareable"] },
      { name: "Game Day Sponsor", amount: 500, desc: "Visible support that families notice.", badges: ["Popular", "High visibility"] },
      { name: "Tournament Sponsor", amount: 1000, desc: "Top placement + sponsor spotlight.", badges: ["Top placement", "Best value"] },
    ],
    spotlight: {
      title: "Tournament Sponsor",
      copy: "Top sponsors get pride-of-place on the wall plus a shareable sponsor badge (easy marketing for local businesses).",
    },
  },
  supportEmail: "support@getfuturefunded.com",
  liveRefreshMs: 20000,
  payments: { stripe: true, paypal: false }
};

// PATCH: parse once
const jsonCfg = readJsonScript("ffConfig");
const CONFIG = deepMerge(
  safeClone(DEFAULT_CONFIG),
  (isPlainObject(window.FF_CONFIG) ? window.FF_CONFIG : {}),
  (isPlainObject(jsonCfg) ? jsonCfg : {})
);

const state = {
  goal: Number(CONFIG.fundraiser?.goal) || 0,
  raised: Number(CONFIG.fundraiser?.raised) || 0,
  donors: Number(CONFIG.fundraiser?.donors) || 0,
  teams: (CONFIG.teams || []).map((t) => ({ ...t })),
  teamFilter: "all",
  teamQuery: "",
  needsSet: new Set(),
  lastStatusOk: false,
  lastUpdatedAt: 0,
};

/* -------------------------
Formatting
------------------------- */
const currencyCode = () => String(CONFIG.fundraiser?.currency || "USD").toUpperCase();
const fmtMoney = (n, maxDigits = 0) => {
  const v = Number(n) || 0;
  try {
    return new Intl.NumberFormat(undefined, {
      style: "currency",
      currency: currencyCode(),
      minimumFractionDigits: 0,
      maximumFractionDigits: maxDigits,
    }).format(v);
  } catch {
    const nf = new Intl.NumberFormat(undefined, { maximumFractionDigits: maxDigits });
    return "$" + nf.format(v);
  }
};
const money0 = (n) => fmtMoney(n, 0);
const money2 = (n) => fmtMoney(n, 2);

const pct = (raised, goal) => {
  const g = Number(goal) || 0;
  if (!g) return 0;
  return clamp(Math.round((Number(raised) / g) * 100), 0, 999);
};
const daysLeft = (deadlineISO) => {
  const d = new Date(deadlineISO);
  if (Number.isNaN(d.getTime())) return null;
  const ms = d.getTime() - Date.now();
  if (ms <= 0) return 0;
  return Math.max(0, Math.ceil(ms / 86400000));
};
const formatAge = (ms) => {
  const s = Math.max(0, Math.floor(ms / 1000));
  if (s < 10) return "just now";
  if (s < 60) return `${s}s ago`;
  const m = Math.floor(s / 60);
  if (m < 60) return `${m}m ago`;
  const h = Math.floor(m / 60);
  if (h < 24) return `${h}h ago`;
  const d = Math.floor(h / 24);
  return `${d}d ago`;
};

/* -------------------------
DOM refs
------------------------- */
const E = {
  orgName: $("#orgName"),
  orgMeta: $("#orgMeta"),
  orgPill: $("#orgPill"),
  seasonPill: $("#seasonPill"),
  sportPill: $("#sportPill"),
  heroOrgLine: $("#heroOrgLine"),

  raisedBig: $("#raisedBig"),
  raisedRow: $("#raisedRow"),
  goalRow: $("#goalRow"),
  goalPill: $("#goalPill"),
  remainingText: $("#remainingText"),
  deadlineText: $("#deadlineText"),
  lastUpdatedText: $("#lastUpdatedText"),
  pctText: $("#pctText"),
  overallBar: $("#overallBar"),
  donorsText: $("#donorsText"),
  avgGiftText: $("#avgGiftText"),
  daysLeftText: $("#daysLeftText"),
  nextMilestoneText: $("#nextMilestoneText"),
  matchPill: $("#matchPill"),
  lastUpdatedPill: $("#lastUpdatedPill"),
  countdownPill: $("#countdownPill"),

  donateQr: $("#donateQr"),
  qrCopyLink: $("#qrCopyLink"),
  textDonateCard: $("#textDonateCard"),
  textDonatePhone: $("#textDonatePhone"),
  textDonateKeyword: $("#textDonateKeyword"),
  textDonateHint: $("#textDonateHint"),
  textDonateSmsLink: $("#textDonateSmsLink"),
  textDonateCopy: $("#textDonateCopy"),

  giftsList: $("#giftsList"),
  allocationBars: $("#allocationBars"),
  impactGrid: $("#impactGrid"),
  teamsGrid: $("#teamsGrid"),
  sponsorWall: $("#sponsorWall"),
  sponsorTiers: $("#sponsorTiers"),
  spotlightTitle: $("#spotlightTitle"),
  spotlightCopy: $("#spotlightCopy"),

  teamSearch: $("#teamSearch"),
  teamSelect: $("#teamSelect"),

  eventTitle: $("#eventTitle"),
  eventCountdown: $("#eventCountdown"),

  form: $("#donationForm"),
  amountInput: $("#amountInput"),
  nameInput: $("#nameInput"),
  emailInput: $("#emailInput"),
  noteInput: $("#noteInput"),
  coverFees: $("#coverFees"),
  roundUp: $("#roundUp"),
  updatesOptIn: $("#updatesOptIn"),
  submitBtn: $("#submitBtn"),
  frequencyHidden: $("#frequencyHidden"),
  summaryAmount: $("#summaryAmount"),
  summaryFreq: $("#summaryFreq"),
  summaryFeeLine: $("#summaryFeeLine"),
  receiptBase: $("#receiptBase"),
  receiptRoundRow: $("#receiptRoundRow"),
  receiptRound: $("#receiptRound"),
  receiptFeeRow: $("#receiptFeeRow"),
  receiptFee: $("#receiptFee"),
  receiptTotal: $("#receiptTotal"),
  ffTotalHidden: $("#ffTotalHidden"),
  ffIdemHidden: $("#ffIdemHidden"),
  formError: $("#formError"),

  checkoutModal: $("#checkoutModal"),
  checkoutClose: $("#checkoutClose"),
  checkoutClose2: $("#checkoutClose2"),
  checkoutHelp: $("#checkoutHelp"),
  checkoutLoading: $("#checkoutLoading"),
  checkoutModalError: $("#checkoutModalError"),
  paymentElement: $("#paymentElement"),
  payNowBtn: $("#payNowBtn"),

  successModal: $("#successModal"),
  successClose: $("#successClose"),
  successBack: $("#successBack"),
  successEmail: $("#successEmail"),
  successAmount: $("#successAmount"),
  successFrequency: $("#successFrequency"),
  successTeam: $("#successTeam"),
  successShare: $("#successShare"),
  successCopy: $("#successCopy"),

  sponsorKitModal: $("#sponsorKitModal"),
  openSponsorKit: $("#openSponsorKit"),
  sponsorKitClose: $("#sponsorKitClose"),
  sponsorKitClose2: $("#sponsorKitClose2"),
  sponsorKitMessagePreview: $("#sponsorKitMessagePreview"),
  sponsorKitBadgePreview: $("#sponsorKitBadgePreview"),
  sponsorKitCopyMessage: $("#sponsorKitCopyMessage"),
  sponsorKitCopyBadge: $("#sponsorKitCopyBadge"),
  sponsorKitCopyLink: $("#sponsorKitCopyLink"),
  copySponsorBadgeBtn: $("#copySponsorBadgeBtn"),

  shareOptionsModal: $("#shareOptionsModal"),
  shareOptionsBtn: $("#shareOptionsBtn"),
  shareOptionsClose: $("#shareOptionsClose"),
  shareOptionsClose2: $("#shareOptionsClose2"),
  shareVariant: $("#shareVariant"),
  utmSource: $("#utmSource"),
  utmMedium: $("#utmMedium"),
  utmCampaign: $("#utmCampaign"),
  shareLinkPreview: $("#shareLinkPreview"),
  shareTextPreview: $("#shareTextPreview"),
  shareOptionsCopyLink: $("#shareOptionsCopyLink"),
  shareOptionsShare: $("#shareOptionsShare"),

  year: $("#year"),
  sticky: $("#sticky"),
  stickyRaised: $("#stickyRaised"),
  stickyPct: $("#stickyPct"),
  stickyGoal: $("#stickyGoal"),
  backToTop: $("#backToTop"),
};

/* -------------------------
Toast
------------------------- */
const toastEls = { host: $("#toast"), text: $("#toastText"), close: $("#toastClose") };
let toastTimer = null;

const safeVibrate = (ms = 12) => { try { navigator.vibrate?.(ms); } catch {} };
const toast = (msg, { durationMs = 2600, haptic = false } = {}) => {
  if (!toastEls.host || !toastEls.text) return;
  toastEls.text.textContent = String(msg || "");
  setShown(toastEls.host, true);
  if (haptic) safeVibrate(12);
  if (toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(() => setShown(toastEls.host, false), durationMs);
};
toastEls.close?.addEventListener("click", () => setShown(toastEls.host, false));
// Expose for optional integrations
window.ffToast = (msg) => toast(msg);

/* -------------------------
Theme + Brand
------------------------- */
const THEME_KEY = "ff_flagship_theme_v43";

function applyBrand() {
  const r = document.documentElement;
  if (CONFIG.brand?.primary) r.style.setProperty("--primary", CONFIG.brand.primary);
  if (CONFIG.brand?.primaryStrong) r.style.setProperty("--primary-2", CONFIG.brand.primaryStrong);
  if (CONFIG.brand?.accent) r.style.setProperty("--accent", CONFIG.brand.accent);

  const mark = $("#brandMark");
  if (!mark) return;

  const logo = String(CONFIG.brand?.logoUrl || "").trim();
  if (logo) mark.innerHTML = `<img class="brand-logo" alt="" src="${escapeHtml(logo)}" decoding="async" loading="eager" />`;
  else mark.textContent = CONFIG.brand?.markText || "FF";
}

function applyTheme(theme) {
  const t = theme === "dark" ? "dark" : "light";
  document.documentElement.setAttribute("data-theme", t);
  const btn = $("#themeToggle");
  if (btn) {
    btn.setAttribute("aria-pressed", String(t === "dark"));
    btn.textContent = t === "dark" ? "☀" : "☾";
  }
}

function initTheme() {
  const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
  let theme = prefersDark ? "dark" : "light";
  try {
    const stored = localStorage.getItem(THEME_KEY);
    if (stored) theme = stored;
  } catch {}
  applyTheme(theme);

  $("#themeToggle")?.addEventListener("click", () => {
    const cur = document.documentElement.getAttribute("data-theme") || "light";
    const next = cur === "dark" ? "light" : "dark";
    applyTheme(next);
    try { localStorage.setItem(THEME_KEY, next); } catch {}
  });
}

/* -------------------------
Sticky offsets + header shadow + topbar dismiss
------------------------- */
const TOPBAR_KEY = "ff_topbar_dismissed_v1";

function measureStickyOffsets() {
  const topbar = $("#topbar");
  const header = $("#top");
  const topbarH = topbar && !topbar.hidden ? Math.ceil(topbar.getBoundingClientRect().height) : 0;
  const headerH = header ? Math.ceil(header.getBoundingClientRect().height) : 0;
  const offset = topbarH + headerH + 14;

  const r = document.documentElement;
  r.style.setProperty("--topbar-h", topbarH + "px");
  r.style.setProperty("--header-h", headerH + "px");
  r.style.setProperty("--scroll-offset", offset + "px");

  try { window.dispatchEvent(new Event("ff:offsets")); } catch {}
}

function initTopbarDismiss() {
  const topbar = $("#topbar");
  const btn = $("#topbarDismiss");
  if (!topbar || !btn) return;

  let dismissed = false;
  try { dismissed = localStorage.getItem(TOPBAR_KEY) === "1"; } catch {}
  if (dismissed) { topbar.hidden = true; measureStickyOffsets(); }

  btn.addEventListener("click", () => {
    topbar.hidden = true;
    try { localStorage.setItem(TOPBAR_KEY, "1"); } catch {}
    measureStickyOffsets();
  });
}

function initHeaderShadow() {
  const header = $("#top");
  if (!header) return;
  const onScroll = () => {
    const y = window.scrollY || 0;
    header.setAttribute("data-scrolled", y > 8 ? "true" : "false");
  };
  window.addEventListener("scroll", onScroll, { passive: true });
  onScroll();
}

/* -------------------------
Drawer (Esc close, focus trap, restore focus)
------------------------- */
const drawerApi = { isOpen: () => false, open: () => {}, close: () => {} };

function initDrawer() {
  const drawer = $("#mobileDrawer");
  const openBtn = $("#menuOpen");
  if (!drawer || !openBtn) return;

  let lastFocus = null;
  let trapCleanup = null;

  const isOpen = () => drawer.getAttribute("data-open") === "true";

  const open = () => {
    if (isOpen()) return;
    lastFocus = document.activeElement;

    drawer.setAttribute("data-open", "true");
    openBtn.setAttribute("aria-expanded", "true");
    setOpenHiddenA11y(drawer, true);

    lockScroll(true);

    if (trapCleanup) { trapCleanup(); trapCleanup = null; }
    trapCleanup = trapFocus(drawer);

    requestAnimationFrame(() => {
      focusFirst(drawer.querySelector(".drawer-panel") || drawer);
    });
  };

  const close = () => {
    if (!isOpen()) return;

    drawer.setAttribute("data-open", "false");
    openBtn.setAttribute("aria-expanded", "false");
    setOpenHiddenA11y(drawer, false);

    if (trapCleanup) { trapCleanup(); trapCleanup = null; }

    lockScroll(false);

    const target = lastFocus || openBtn;
    if (target && typeof target.focus === "function") requestAnimationFrame(() => target.focus());
    lastFocus = null;
  };

  openBtn.addEventListener("click", open);

  drawer.addEventListener("click", (e) => {
    const closeBtn = e.target?.closest?.('[data-close="true"]');
    const clickedBackdrop = e.target?.classList?.contains("drawer-backdrop");
    if (closeBtn || clickedBackdrop || e.target === drawer) close();
  });

  $$('a[href^="#"]', drawer).forEach((a) => a.addEventListener("click", close));

  drawerApi.isOpen = isOpen;
  drawerApi.open = open;
  drawerApi.close = close;

  if (!isOpen()) setOpenHiddenA11y(drawer, false);
}

/* -------------------------
Scroll spy
------------------------- */
function getScrollOffsetPx() {
  const v = getComputedStyle(document.documentElement).getPropertyValue("--scroll-offset").trim();
  const n = Number(String(v).replace("px", "").trim());
  return Number.isFinite(n) ? n : 0;
}

function initScrollSpy() {
  const nav = $("#navLinks");
  if (!nav || !("IntersectionObserver" in window)) return;

  const links = $$("a[data-spy]", nav);
  const map = new Map();
  links.forEach((a) => {
    const id = a.getAttribute("href")?.replace("#", "");
    if (id) map.set(id, a);
  });

  const sections = ["progress", "impact", "teams", "sponsors", "donate"]
    .map((id) => document.getElementById(id))
    .filter(Boolean);

  const setActive = (id) => {
    links.forEach((a) => a.setAttribute("data-active", "false"));
    const a = map.get(id);
    if (a) a.setAttribute("data-active", "true");
  };

  let io = null;

  const buildObserver = () => {
    if (io) io.disconnect();

    const offset = getScrollOffsetPx();
    io = new IntersectionObserver((entries) => {
      const visible = entries
        .filter((e) => e.isIntersecting)
        .sort((a, b) => Math.abs(a.boundingClientRect.top) - Math.abs(b.boundingClientRect.top))[0];

      if (visible?.target?.id) setActive(visible.target.id);
    }, {
      rootMargin: `-${offset + 8}px 0px -62% 0px`,
      threshold: [0.08, 0.18, 0.28, 0.38]
    });

    sections.forEach((s) => io.observe(s));
  };

  buildObserver();
  window.addEventListener("ff:offsets", debounce(buildObserver, 120));
  window.addEventListener("resize", debounce(buildObserver, 180), { passive: true });

  links.forEach((a) => {
    a.addEventListener("click", () => {
      const id = a.getAttribute("href")?.replace("#", "");
      if (id) setActive(id);
    });
  });

  setActive("progress");
}

/* -------------------------
Canonical + Social + JSON-LD (unchanged behavior)
------------------------- */
const canonicalUrl = () => {
  const u = new URL(window.location.href);
  u.hash = "";
  return u.toString();
};

function ensureCanonicalAndOgUrl() {
  const url = canonicalUrl();
  const canon = $("#ffCanonical");
  if (canon) canon.setAttribute("href", url);
  const ogUrl = document.querySelector('meta[property="og:url"]');
  if (ogUrl) ogUrl.setAttribute("content", url);
}

function svgOgPlaceholderDataUri(title, subtitle) {
  const t = String(title || "Fundraiser").slice(0, 64);
  const s = String(subtitle || "FutureFunded").slice(0, 64);
  const svg =
`<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="630">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#0b1020"/>
      <stop offset="1" stop-color="#c2410c"/>
    </linearGradient>
  </defs>
  <rect width="1200" height="630" fill="url(#g)"/>
  <circle cx="220" cy="160" r="140" fill="rgba(249,115,22,.22)"/>
  <circle cx="980" cy="520" r="220" fill="rgba(255,255,255,.08)"/>
  <rect x="84" y="92" width="1032" height="446" rx="42" fill="rgba(255,255,255,.06)" stroke="rgba(255,255,255,.12)"/>
  <text x="120" y="230" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="68" font-weight="900" fill="#ffffff">${escapeHtml(t)}</text>
  <text x="120" y="304" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="34" font-weight="650" fill="rgba(255,255,255,.86)">${escapeHtml(s)}</text>
  <text x="120" y="400" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="26" font-weight="650" fill="rgba(255,255,255,.76)">Secure checkout • Instant receipt</text>
  <text x="120" y="444" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="24" font-weight="650" fill="rgba(255,255,255,.70)">Powered by FutureFunded</text>
</svg>`;

  const encoded = encodeURIComponent(svg)
    .replace(/%0A/g, "")
    .replace(/%20/g, " ")
    .replace(/%3D/g, "=")
    .replace(/%3A/g, ":")
    .replace(/%2F/g, "/")
    .replace(/%22/g, "'");

  return `data:image/svg+xml;charset=utf-8,${encoded}`;
}

function ensureSocialMeta() {
  const org = String(CONFIG.org?.shortName || "Fundraiser");
  const title = `${org} • Fundraiser`;
  const desc = document.querySelector('meta[name="description"]')?.getAttribute("content")
    || "Donate securely in under a minute with instant email receipts and transparent impact.";

  document.querySelector('meta[property="og:title"]')?.setAttribute("content", title);
  document.querySelector('meta[property="og:description"]')?.setAttribute("content", desc);
  document.querySelector('meta[name="twitter:title"]')?.setAttribute("content", title);
  document.querySelector('meta[name="twitter:description"]')?.setAttribute("content", desc);

  const ogImg = document.querySelector('meta[property="og:image"]');
  const twImg = document.querySelector('meta[name="twitter:image"]');
  const existing = (ogImg?.getAttribute("content") || "").trim();
  if (!existing) {
    const img = svgOgPlaceholderDataUri(org, "FutureFunded • Secure checkout");
    ogImg?.setAttribute("content", img);
    twImg?.setAttribute("content", img);
  }
}

function injectJsonLd() {
  const el = document.getElementById("ffJsonLd");
  if (!el) return;

  const url = canonicalUrl();
  const org = String(CONFIG.org?.shortName || "Fundraiser");
  const goal = Number(state.goal || 0);
  const raised = Number(state.raised || 0);

  const json = {
    "@context": "https://schema.org",
    "@type": "DonateAction",
    "name": `${org} Fundraiser`,
    "target": url,
    "description": document.querySelector('meta[name="description"]')?.getAttribute("content") || "",
    "recipient": { "@type": "Organization", "name": org },
    "object": { "@type": "MonetaryAmount", "currency": currencyCode(), "value": raised },
    "potentialAction": { "@type": "DonateAction", "target": url },
    "additionalProperty": [
      { "@type": "PropertyValue", "name": "goal", "value": goal },
      { "@type": "PropertyValue", "name": "raised", "value": raised }
    ]
  };

  el.textContent = JSON.stringify(json);
}

/* -------------------------
Clipboard + Share
------------------------- */
async function copyToClipboard(text) {
  const v = String(text || "");
  try {
    await navigator.clipboard.writeText(v);
    return true;
  } catch {
    try {
      const ta = document.createElement("textarea");
      ta.value = v;
      ta.setAttribute("readonly", "true");
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      ta.style.top = "0";
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    } catch {
      return false;
    }
  }
}

function buildShareUrlWithUtm(baseUrl, utm) {
  try {
    const u = new URL(baseUrl);
    if (utm?.source) u.searchParams.set("utm_source", utm.source);
    if (utm?.medium) u.searchParams.set("utm_medium", utm.medium);
    if (utm?.campaign) u.searchParams.set("utm_campaign", utm.campaign);
    return u.toString();
  } catch { return baseUrl; }
}

function shareTextVariant(kind = "standard") {
  const org = String(CONFIG.org?.shortName || "our program");
  const dl = String(CONFIG.fundraiser?.deadlineISO || "");
  const d = dl ? new Date(dl) : null;
  const deadlinePretty = d && !Number.isNaN(d.getTime())
    ? d.toLocaleDateString(undefined, { month: "short", day: "numeric" })
    : "";

  if (kind === "urgent") {
    return `We’re fundraising for ${org}. If you can, donate today—every gift helps. ${deadlinePretty ? `Ends ${deadlinePretty}.` : ""}`;
  }
  if (kind === "sponsor") {
    return `Local businesses: sponsor ${org} and get recognition + a receipt for records. Want to help stabilize travel, gear, and scholarships?`;
  }
  return `Support ${org}—secure checkout + instant receipt. Every gift keeps the program accessible.`;
}

async function doShare({ url, title, text }) {
  const payload = { title, text, url };
  if (navigator.share) {
    try { await navigator.share(payload); return true; } catch {}
  }
  const ok = await copyToClipboard(url);
  toast(ok ? "Link copied." : "Couldn’t copy link.", { haptic: ok });
  return ok;
}

/* -------------------------
Modal utilities
------------------------- */
const modalState = new Map();
function isModalOpen(el) { return !!el && el.getAttribute("data-open") === "true"; }

function openModal(el) {
  if (!el || isModalOpen(el)) return;
  modalState.set(el, { lastFocus: document.activeElement, trapCleanup: null });

  el.setAttribute("data-open", "true");
  setOpenHiddenA11y(el, true);
  lockScroll(true);

  const panel = el.querySelector(".modal-panel") || el;
  const entry = modalState.get(el);
  if (entry?.trapCleanup) entry.trapCleanup();
  entry.trapCleanup = trapFocus(el);

  requestAnimationFrame(() => focusFirst(panel));
}

function closeModal(el) {
  if (!el || !isModalOpen(el)) return;
  el.setAttribute("data-open", "false");
  setOpenHiddenA11y(el, false);

  const entry = modalState.get(el);
  if (entry?.trapCleanup) entry.trapCleanup();
  modalState.delete(el);

  lockScroll(false);

  const target = entry?.lastFocus;
  if (target && typeof target.focus === "function") requestAnimationFrame(() => target.focus());
}

function closeTopmostModal() {
  const order = [E.shareOptionsModal, E.sponsorKitModal, E.successModal, E.checkoutModal].filter(Boolean);
  for (const m of order) {
    if (isModalOpen(m)) { closeModal(m); return true; }
  }
  return false;
}

/* -------------------------
UI text + basics
------------------------- */
function applyOrgText() {
  const org = CONFIG.org || {};
  if (E.orgName) E.orgName.textContent = org.shortName || "Fundraiser";
  if (E.orgMeta) E.orgMeta.textContent = org.metaLine || "";
  if (E.heroOrgLine) E.heroOrgLine.textContent = `${org.shortName || "Fundraiser"} • Fundraiser`;
  if (E.orgPill) E.orgPill.textContent = `${org.shortName || "Fundraiser"} Fundraiser`;
  if (E.seasonPill) E.seasonPill.textContent = org.seasonLabel || "Season Fund";
  if (E.sportPill) E.sportPill.textContent = org.sportLabel || "Youth program";
  if (E.year) E.year.textContent = String(new Date().getFullYear());

  if (E.donateQr) {
    const qrData = encodeURIComponent(canonicalUrl());
    E.donateQr.src = `https://api.qrserver.com/v1/create-qr-code/?size=220x220&margin=10&data=${qrData}`;
  }

  const phone = meta("ff-text-to-donate-phone").trim();
  const keyword = meta("ff-text-to-donate-keyword").trim();
  if (phone && keyword && E.textDonateCard) {
    E.textDonateCard.hidden = false;
    E.textDonatePhone.textContent = phone;
    E.textDonateKeyword.textContent = keyword;
    E.textDonateHint.textContent = "Standard messaging rates may apply.";
    const sms = `sms:${phone}?&body=${encodeURIComponent(keyword)}`;
    E.textDonateSmsLink?.setAttribute("href", sms);

    E.textDonateCopy?.addEventListener("click", async () => {
      const ok = await copyToClipboard(`Text ${keyword} to ${phone}`);
      toast(ok ? "Copied." : "Couldn’t copy.", { haptic: ok });
    });
  }
}

/* -------------------------
Progress
------------------------- */
function setLastUpdatedUi(now = Date.now()) {
  const age = state.lastUpdatedAt ? (now - state.lastUpdatedAt) : Infinity;

  const label = state.lastUpdatedAt ? `Updated ${formatAge(age)}` : "Updated —";

  if (E.lastUpdatedPill) {
    E.lastUpdatedPill.textContent = label;
    let status = "offline";
    if (state.lastStatusOk) status = age < (CONFIG.liveRefreshMs * 2.2) ? "ok" : "stale";
    E.lastUpdatedPill.setAttribute("data-status", status);
  }
  if (E.lastUpdatedText) E.lastUpdatedText.textContent = label;
}

function setDeadlineUi() {
  const iso = String(CONFIG.fundraiser?.deadlineISO || "");
  const d = new Date(iso);
  if (E.deadlineText) {
    if (!iso || Number.isNaN(d.getTime())) E.deadlineText.textContent = "—";
    else E.deadlineText.textContent = `Ends ${d.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" })}`;
  }

  const dl = daysLeft(iso);
  if (E.daysLeftText) E.daysLeftText.textContent = (dl == null) ? "—" : String(dl);

  if (E.countdownPill) {
    if (dl == null) E.countdownPill.textContent = "Ends soon";
    else if (dl === 0) E.countdownPill.textContent = "Last day";
    else if (dl === 1) E.countdownPill.textContent = "1 day left";
    else E.countdownPill.textContent = `${dl} days left`;
  }
}

function nextMilestone(goal, raised) {
  const g = Number(goal) || 0;
  if (!g) return null;
  const p = pct(raised, g);
  const steps = [25, 50, 75, 100];
  const next = steps.find((s) => s > p) || 100;
  const target = Math.round((next / 100) * g);
  return { nextPct: next, target, remaining: Math.max(0, target - (Number(raised) || 0)) };
}

function updateProgressUi() {
  const goal = Number(state.goal) || 0;
  const raised = Number(state.raised) || 0;
  const donors = Number(state.donors) || 0;

  const p = pct(raised, goal);
  const remain = Math.max(0, goal - raised);
  const avg = donors > 0 ? (raised / donors) : 0;

  E.raisedBig && (E.raisedBig.textContent = money0(raised));
  E.raisedRow && (E.raisedRow.textContent = money0(raised));
  E.goalRow && (E.goalRow.textContent = money0(goal));
  E.goalPill && (E.goalPill.textContent = money0(goal));
  E.remainingText && (E.remainingText.textContent = money0(remain));
  E.pctText && (E.pctText.textContent = String(p));
  E.donorsText && (E.donorsText.textContent = String(donors));
  E.avgGiftText && (E.avgGiftText.textContent = money0(avg));

  if (E.overallBar) E.overallBar.style.width = `${clamp(p, 0, 100)}%`;

  const meter = E.overallBar?.closest?.('[role="progressbar"]');
  if (meter) {
    meter.setAttribute("aria-valuenow", String(clamp(p, 0, 100)));
    meter.setAttribute("aria-valuetext", `${p}% funded`);
  }

  const ms = nextMilestone(goal, raised);
  if (E.nextMilestoneText) {
    if (!ms) E.nextMilestoneText.textContent = "—";
    else if (p >= 100) E.nextMilestoneText.textContent = "Goal reached";
    else E.nextMilestoneText.textContent = `${ms.nextPct}% (${money0(ms.remaining)} to go)`;
  }

  E.stickyRaised && (E.stickyRaised.textContent = money0(raised));
  E.stickyGoal && (E.stickyGoal.textContent = money0(goal));
  E.stickyPct && (E.stickyPct.textContent = String(p));

  const matchActive = !!CONFIG.fundraiser?.match?.active;
  if (E.matchPill) E.matchPill.hidden = !matchActive;
}

/* -------------------------
Render: Allocation / Impact / Gifts / Teams / Sponsors
(These are unchanged from your v45 behavior except sponsor tier button uses data attr)
------------------------- */
function renderAllocation() {
  if (!E.allocationBars) return;
  const rows = Array.isArray(CONFIG.allocation) ? CONFIG.allocation : [];
  if (!rows.length) {
    E.allocationBars.innerHTML = `<div class="notice"><strong>No allocation data yet.</strong><div class="help">Add CONFIG.allocation to show transparency bars.</div></div>`;
    return;
  }
  E.allocationBars.innerHTML = rows.map((r) => {
    const label = escapeHtml(r.label || "");
    const pctV = clamp(Number(r.pct) || 0, 0, 100);
    return `
      <div class="mini">
        <div class="progress-mini">
          <div style="min-width:0;">
            <div class="kicker">${label}</div>
          </div>
          <div class="progress-mini__right">
            <div class="badge num">${pctV}%</div>
          </div>
        </div>
        <div class="meter" aria-hidden="true"><span style="width:${pctV}%"></span></div>
      </div>
    `;
  }).join("");
}

function renderImpact() {
  if (!E.impactGrid) return;
  const items = Array.isArray(CONFIG.impact) ? CONFIG.impact : [];
  if (!items.length) {
    E.impactGrid.innerHTML = `<div class="notice"><strong>No impact options yet.</strong><div class="help">Add CONFIG.impact to show prefill cards.</div></div>`;
    return;
  }
  E.impactGrid.innerHTML = items.map((it) => {
    const amt = Number(it.amount) || 0;
    const tag = escapeHtml(it.tag || "Impact");
    const title = escapeHtml(it.title || "");
    const desc = escapeHtml(it.desc || "");
    const badge = it.badge ? `<span class="badge">${escapeHtml(it.badge)}</span>` : "";
    return `
      <button class="impact-card" type="button" data-prefill-amount="${amt}" role="listitem" aria-label="Prefill donation ${money0(amt)}">
        <div class="impact-top">
          <span class="tag">${tag}</span>
          ${badge}
        </div>
        <div class="impact-amt num">${money0(amt)}</div>
        <div class="impact-title">${title}</div>
        <div class="impact-desc">${desc}</div>
        <div class="impact-hint">Tap to prefill →</div>
      </button>
    `;
  }).join("");
}

function renderGifts(gifts) {
  if (!E.giftsList) return;
  const rows = Array.isArray(gifts) ? gifts : [];
  if (!rows.length) {
    E.giftsList.innerHTML = `<div class="notice"><strong>No gifts listed yet.</strong><div class="help">Once donations start coming in, this section shows momentum.</div></div>`;
    return;
  }
  E.giftsList.innerHTML = rows.slice(0, 8).map((g) => {
    const who = escapeHtml(g.who || "Anonymous");
    const amt = money0(Number(g.amount) || 0);
    const when = (g.minutesAgo != null) ? `${Number(g.minutesAgo)}m ago` : (g.when || "");
    return `
      <div class="gift">
        <div style="min-width:0;">
          <div class="who">${who}</div>
          <div class="when">${escapeHtml(when)}</div>
        </div>
        <div class="amt num">${amt}</div>
      </div>
    `;
  }).join("");
}

function computeNeedsSet() {
  state.needsSet = new Set();
  for (const t of state.teams) {
    const g = Number(t.goal) || 0;
    const r = Number(t.raised) || 0;
    if (g > 0 && (r / g) < 0.45) state.needsSet.add(String(t.key));
  }
}

function renderTeams() {
  if (!E.teamsGrid) return;
  const teams = state.teams || [];
  if (!teams.length) {
    E.teamsGrid.innerHTML = `<div class="notice"><strong>No teams configured.</strong><div class="help">Add CONFIG.teams to show team cards.</div></div>`;
    return;
  }

  E.teamsGrid.innerHTML = teams.map((t) => {
    const key = escapeHtml(t.key || "");
    const name = escapeHtml(t.name || "Team");
    const blurb = escapeHtml(t.blurb || "");
    const img = escapeHtml(t.image || "");
    const goal = Number(t.goal) || 0;
    const raised = Number(t.raised) || 0;
    const p = goal ? clamp(Math.round((raised / goal) * 100), 0, 100) : 0;
    const tag = t.tag ? `<span class="badge">${escapeHtml(t.tag)}</span>` : "";

    return `
      <article class="team-card" role="listitem"
        data-team-key="${key}"
        data-team-name="${escapeHtml(String(t.name || "").toLowerCase())}"
        data-team-tag="${escapeHtml(String(t.tag || "").toLowerCase())}"
        data-team-needs="${state.needsSet.has(String(t.key)) ? "1" : "0"}"
      >
        <div class="team-media">
          ${img ? `<img class="team-img" src="${img}" alt="" loading="lazy" decoding="async" />` : ``}
        </div>
        <div class="team-body">
          <div class="team-head">
            <div style="min-width:0;">
              <div class="kicker">Team</div>
              <div class="team-name">${name}</div>
              <div class="team-blurb">${blurb}</div>
              <div style="margin-top:.55rem; display:flex; gap:.45rem; flex-wrap:wrap;">
                ${tag}
                ${state.needsSet.has(String(t.key)) ? `<span class="badge">Needing support</span>` : ``}
              </div>
            </div>
            <div class="team-raise num">${money0(raised)}<div class="help" style="margin-top:.15rem;">of ${money0(goal)}</div></div>
          </div>

          <div class="meter" aria-hidden="true"><span style="width:${p}%"></span></div>

          <div style="display:flex; gap:.6rem; flex-wrap:wrap; margin-top:.35rem;">
            <button class="btn btn-primary btn-sm" type="button" data-prefill-amount="50" data-team-pick="${key}">Donate to team</button>
            <button class="btn btn-secondary btn-sm" type="button" data-team-select="${key}">Tag team</button>
          </div>
        </div>
      </article>
    `;
  }).join("");

  applyTeamFilter();
}

function applyTeamFilter() {
  const grid = E.teamsGrid;
  if (!grid) return;

  const filter = state.teamFilter || "all";
  const q = (state.teamQuery || "").trim().toLowerCase();

  const cards = $$("[data-team-key]", grid);
  let shown = 0;

  for (const c of cards) {
    const key = c.getAttribute("data-team-key") || "";
    const name = c.getAttribute("data-team-name") || "";
    const tag = c.getAttribute("data-team-tag") || "";
    const needs = c.getAttribute("data-team-needs") === "1";

    let ok = true;
    if (filter === "featured") ok = tag.includes("featured");
    if (filter === "needs") ok = needs;
    if (ok && q) ok = name.includes(q) || key.toLowerCase().includes(q);

    c.hidden = !ok;
    if (ok) shown++;
  }

  if (shown === 0) {
    grid.innerHTML = `<div class="notice"><strong>No teams match.</strong><div class="help">Try a different filter or clear the search.</div></div>`;
  }
}

function bindTeamTools() {
  $$('[data-team-filter]').forEach((btn) => {
    btn.addEventListener("click", () => {
      const v = btn.getAttribute("data-team-filter") || "all";
      state.teamFilter = v;
      $$('[data-team-filter]').forEach((b) => b.setAttribute("aria-pressed", String(b === btn)));
      renderTeams();
    });
  });

  E.teamSearch?.addEventListener("input", debounce(() => {
    state.teamQuery = E.teamSearch.value || "";
    renderTeams();
  }, 120));
}

function populateTeamSelect() {
  if (!E.teamSelect) return;
  const base = `<option value="all">All teams • Support the full program</option>`;
  const opts = (state.teams || []).map((t) => {
    const key = escapeHtml(t.key || "");
    const name = escapeHtml(t.name || "Team");
    return `<option value="${key}">${name}</option>`;
  }).join("");
  E.teamSelect.innerHTML = base + opts;
}

function renderSponsors() {
  if (E.sponsorWall) {
    const wall = Array.isArray(CONFIG.sponsors?.wall) ? CONFIG.sponsors.wall : [];
    if (!wall.length) {
      E.sponsorWall.innerHTML = `<div class="notice"><strong>No sponsors listed yet.</strong><div class="help">Early sponsors show up here for recognition.</div></div>`;
    } else {
      E.sponsorWall.innerHTML = wall.slice(0, 10).map((s, i) => {
        const rank = i + 1;
        const name = escapeHtml(s.name || "Sponsor");
        const metaLine = escapeHtml(s.meta || "");
        const amt = money0(Number(s.amount) || 0);
        return `
          <div class="leader">
            <div class="leader-left">
              <div class="rank num">${rank}</div>
              <div style="min-width:0;">
                <div class="leader-name">${name}</div>
                <div class="leader-meta">${metaLine}</div>
              </div>
            </div>
            <div class="leader-amt num">${amt}</div>
          </div>
        `;
      }).join("");
    }
  }

  if (E.sponsorTiers) {
    const tiers = Array.isArray(CONFIG.sponsors?.tiers) ? CONFIG.sponsors.tiers : [];
    if (!tiers.length) {
      E.sponsorTiers.innerHTML = `<div class="notice"><strong>No sponsor tiers configured.</strong><div class="help">Add CONFIG.sponsors.tiers for prefilled sponsor options.</div></div>`;
    } else {
      E.sponsorTiers.innerHTML = tiers.map((t) => {
        const name = escapeHtml(t.name || "Sponsor");
        const amt = Number(t.amount) || 0;
        const desc = escapeHtml(t.desc || "");
        const badges = Array.isArray(t.badges) ? t.badges.map((b) => `<span class="badge">${escapeHtml(b)}</span>`).join(" ") : "";
        return `
          <article class="tier lift">
            <div class="tier-row">
              <div style="min-width:0;">
                <div class="kicker">Tier</div>
                <h3 style="margin-top:.35rem;">${name}</h3>
                <div style="margin-top:.55rem; display:flex; gap:.45rem; flex-wrap:wrap;">
                  ${badges}
                </div>
              </div>
              <div class="tier-price num">${money0(amt)}</div>
            </div>
            <p class="tier-desc">${desc}</p>
            <div style="display:flex; gap:.6rem; flex-wrap:wrap; margin-top:.85rem;">
              <button class="btn btn-primary btn-sm" type="button" data-prefill-amount="${amt}">Choose ${money0(amt)}</button>
              <!-- PATCH: data attribute instead of duplicated id -->
              <button class="btn btn-secondary btn-sm" type="button" data-open-sponsor-kit="true" data-sponsor-tier="${escapeHtml(t.name || "")}">Sponsor Kit</button>
            </div>
          </article>
        `;
      }).join("");
    }
  }

  if (E.spotlightTitle) E.spotlightTitle.textContent = String(CONFIG.sponsors?.spotlight?.title || "Sponsor spotlight");
  if (E.spotlightCopy) E.spotlightCopy.textContent = String(CONFIG.sponsors?.spotlight?.copy || "");
}

/* -------------------------
Sponsor Kit
------------------------- */
function sponsorKitPayload() {
  const org = String(CONFIG.org?.shortName || "our program");
  const url = canonicalUrl();
  const spotlight = String(CONFIG.sponsors?.spotlight?.title || "Sponsor");
  const msg = `Proud to support ${org} as a ${spotlight}. Help keep the program accessible: ${url}`;
  const badge = `✅ Proud sponsor of ${org} • ${url}`;
  return { msg, badge, url };
}

function bindSponsorKit() {
  const open = () => {
    const { msg, badge } = sponsorKitPayload();
    if (E.sponsorKitMessagePreview) E.sponsorKitMessagePreview.textContent = msg;
    if (E.sponsorKitBadgePreview) E.sponsorKitBadgePreview.textContent = badge;
    openModal(E.sponsorKitModal);
  };

  E.openSponsorKit?.addEventListener("click", open);

  // PATCH: delegate sponsor kit open buttons (tiers)
  document.addEventListener("click", (e) => {
    const b = e.target?.closest?.('[data-open-sponsor-kit="true"]');
    if (b) open();
  });

  E.sponsorKitClose?.addEventListener("click", () => closeModal(E.sponsorKitModal));
  E.sponsorKitClose2?.addEventListener("click", () => closeModal(E.sponsorKitModal));

  E.sponsorKitCopyMessage?.addEventListener("click", async () => {
    const { msg } = sponsorKitPayload();
    const ok = await copyToClipboard(msg);
    toast(ok ? "Sponsor message copied." : "Couldn’t copy.", { haptic: ok });
  });

  E.sponsorKitCopyBadge?.addEventListener("click", async () => {
    const { badge } = sponsorKitPayload();
    const ok = await copyToClipboard(badge);
    toast(ok ? "Badge line copied." : "Couldn’t copy.", { haptic: ok });
  });

  E.sponsorKitCopyLink?.addEventListener("click", async () => {
    const ok = await copyToClipboard(canonicalUrl());
    toast(ok ? "Link copied." : "Couldn’t copy.", { haptic: ok });
  });

  E.copySponsorBadgeBtn?.addEventListener("click", async () => {
    const { badge } = sponsorKitPayload();
    const ok = await copyToClipboard(badge);
    toast(ok ? "Copied." : "Couldn’t copy.", { haptic: ok });
  });
}

/* -------------------------
Share Options + Copy links
------------------------- */
function readUtmInputs() {
  return {
    source: (E.utmSource?.value || "").trim(),
    medium: (E.utmMedium?.value || "").trim(),
    campaign: (E.utmCampaign?.value || "").trim(),
  };
}

function updateShareOptionsPreview() {
  const base = canonicalUrl();
  const utm = readUtmInputs();
  const url = buildShareUrlWithUtm(base, utm);
  const variant = E.shareVariant?.value || "standard";
  const text = shareTextVariant(variant);

  if (E.shareLinkPreview) E.shareLinkPreview.textContent = url;
  if (E.shareTextPreview) E.shareTextPreview.textContent = text;

  return { url, text, title: `${String(CONFIG.org?.shortName || "Fundraiser")} • Fundraiser` };
}

function bindShareOptions() {
  E.shareOptionsBtn?.addEventListener("click", () => {
    updateShareOptionsPreview();
    openModal(E.shareOptionsModal);
  });

  E.shareOptionsClose?.addEventListener("click", () => closeModal(E.shareOptionsModal));
  E.shareOptionsClose2?.addEventListener("click", () => closeModal(E.shareOptionsModal));

  [E.shareVariant, E.utmSource, E.utmMedium, E.utmCampaign].forEach((el) => {
    el?.addEventListener("input", debounce(updateShareOptionsPreview, 80));
    el?.addEventListener("change", debounce(updateShareOptionsPreview, 80));
  });

  E.shareOptionsCopyLink?.addEventListener("click", async () => {
    const { url } = updateShareOptionsPreview();
    const ok = await copyToClipboard(url);
    toast(ok ? "Share link copied." : "Couldn’t copy.", { haptic: ok });
  });

  E.shareOptionsShare?.addEventListener("click", async () => {
    const p = updateShareOptionsPreview();
    await doShare(p);
  });

  const shareButtons = ["#shareBtnTop", "#shareBtnDrawer", "#shareBtnGifts", "#shareBtn2", "#successShare"]
    .map((id) => $(id)).filter(Boolean);

  shareButtons.forEach((btn) => {
    btn.addEventListener("click", async () => {
      await doShare({
        url: canonicalUrl(),
        title: `${String(CONFIG.org?.shortName || "Fundraiser")} • Fundraiser`,
        text: shareTextVariant("standard"),
      });
    });
  });
}

function bindCopyLinks() {
  const ids = ["copyLinkBtn", "copyLinkBtn2", "copyLinkBtn3", "copyLinkBtn4", "qrCopyLink", "successCopy"];
  ids.forEach((id) => {
    const el = document.getElementById(id);
    el?.addEventListener("click", async () => {
      const ok = await copyToClipboard(canonicalUrl());
      toast(ok ? "Link copied." : "Couldn’t copy.", { haptic: ok });
    });
  });
}

/* -------------------------
Stripe / Donate form (kept from your v45 behavior)
------------------------- */
const FEE_RATE = 0.029;
const FEE_FIXED = 0.30;

function roundUpToNext5(amount) {
  const a = Math.max(0, Number(amount) || 0);
  const next = Math.ceil(a / 5) * 5;
  return clamp(next - a, 0, 5);
}

function coverFeeAmount(base) {
  const b = Math.max(0, Number(base) || 0);
  const total = (b + FEE_FIXED) / (1 - FEE_RATE);
  return Math.max(0, total - b);
}

function getDonationInputs() {
  const base = Math.max(0, Number(E.amountInput?.value) || 0);
  const addRound = E.roundUp?.checked ? roundUpToNext5(base) : 0;
  const basePlusRound = base + addRound;
  const addFee = E.coverFees?.checked ? coverFeeAmount(basePlusRound) : 0;
  const total = basePlusRound + addFee;

  return {
    base, addRound, addFee, total,
    frequency: E.frequencyHidden?.value || "once",
    team: E.teamSelect?.value || "all",
    name: (E.nameInput?.value || "").trim(),
    email: (E.emailInput?.value || "").trim(),
    note: (E.noteInput?.value || "").trim(),
    updatesOptIn: !!E.updatesOptIn?.checked,
  };
}

function renderReceiptPreview() {
  const v = getDonationInputs();
  if (E.summaryAmount) E.summaryAmount.textContent = money0(v.total);
  if (E.receiptBase) E.receiptBase.textContent = money0(v.base);

  if (E.receiptRoundRow) E.receiptRoundRow.hidden = !(v.addRound > 0);
  if (E.receiptRound) E.receiptRound.textContent = money0(v.addRound);

  if (E.receiptFeeRow) E.receiptFeeRow.hidden = !(v.addFee > 0);
  if (E.receiptFee) E.receiptFee.textContent = money2(v.addFee);

  if (E.receiptTotal) E.receiptTotal.textContent = money0(v.total);
  if (E.ffTotalHidden) E.ffTotalHidden.value = String(Math.round(v.total * 100) / 100);

  if (E.summaryFeeLine) {
    if (v.addFee > 0) {
      E.summaryFeeLine.style.display = "";
      E.summaryFeeLine.textContent = `Includes ${money2(v.addFee)} to help cover processing fees.`;
    } else {
      E.summaryFeeLine.style.display = "none";
      E.summaryFeeLine.textContent = "";
    }
  }
}

function setFormError(msg) {
  if (!E.formError) return;
  if (!msg) { E.formError.style.display = "none"; E.formError.textContent = ""; return; }
  E.formError.style.display = "";
  E.formError.textContent = String(msg);
}

function setCheckoutError(msg) {
  if (!E.checkoutModalError) return;
  if (!msg) { E.checkoutModalError.style.display = "none"; E.checkoutModalError.textContent = ""; return; }
  E.checkoutModalError.style.display = "";
  E.checkoutModalError.textContent = String(msg);
}

function validateFormInputs() {
  const v = getDonationInputs();
  if (v.base < 1) return { ok: false, message: "Enter an amount of at least $1." };
  if (!v.name) return { ok: false, message: "Enter your name." };
  if (!isEmail(v.email)) return { ok: false, message: "Enter a valid email for your receipt." };
  return { ok: true };
}

function setSubmitEnabled() {
  const res = validateFormInputs();
  if (!E.submitBtn) return;
  E.submitBtn.disabled = !res.ok;
  E.submitBtn.setAttribute("aria-disabled", String(!res.ok));
}

let stripe = null;
let elements = null;
let mountedClientSecret = "";
let confirming = false;

function ensureStripe() {
  if (stripe) return stripe;
  const pk = getStripePkFromMeta();
  if (!pk || !window.Stripe) throw new Error("Stripe is not configured (missing publishable key or Stripe.js).");
  stripe = window.Stripe(pk);
  return stripe;
}

function openCheckout() {
  setCheckoutError("");
  if (E.checkoutLoading) E.checkoutLoading.style.display = "";
  if (E.payNowBtn) { E.payNowBtn.disabled = true; E.payNowBtn.setAttribute("aria-disabled", "true"); }
  openModal(E.checkoutModal);
}

function closeCheckout() { closeModal(E.checkoutModal); }

async function createPaymentIntent(payload) {
  const endpoint = getCheckoutEndpoint();
  const csrf = getCsrfToken();
  const headers = csrf ? { "X-CSRF-TOKEN": csrf } : {};
  return fetchJson(endpoint, { method: "POST", payload, headers, timeoutMs: 20000 });
}

function extractClientSecret(data) {
  return data?.clientSecret
    || data?.client_secret
    || data?.payment_intent_client_secret
    || data?.data?.clientSecret
    || data?.data?.client_secret
    || "";
}

async function mountElements(clientSecret) {
  ensureStripe();
  if (!clientSecret) throw new Error("Missing client secret from checkout endpoint.");

  if (clientSecret === mountedClientSecret && elements) {
    if (E.checkoutLoading) E.checkoutLoading.style.display = "none";
    if (E.payNowBtn) { E.payNowBtn.disabled = false; E.payNowBtn.setAttribute("aria-disabled", "false"); }
    return;
  }

  mountedClientSecret = "";
  elements = stripe.elements({ clientSecret });

  if (E.paymentElement) E.paymentElement.innerHTML = "";

  const paymentElement = elements.create("payment", { layout: "tabs" });
  paymentElement.mount("#paymentElement");

  mountedClientSecret = clientSecret;

  if (E.checkoutLoading) E.checkoutLoading.style.display = "none";
  if (E.payNowBtn) { E.payNowBtn.disabled = false; E.payNowBtn.setAttribute("aria-disabled", "false"); }
}

async function confirmPaymentFlow() {
  if (confirming) return;
  confirming = true;
  setCheckoutError("");

  try {
    if (!stripe || !elements) throw new Error("Payment form not ready yet.");
    if (E.payNowBtn) { E.payNowBtn.disabled = true; E.payNowBtn.setAttribute("aria-disabled", "true"); }

    const returnUrl = canonicalUrl();
    const result = await stripe.confirmPayment({
      elements,
      confirmParams: { return_url: returnUrl },
      redirect: "if_required"
    });

    if (result?.error) throw new Error(result.error.message || "Payment failed.");
    showSuccessModal();
  } catch (err) {
    setCheckoutError(err?.message || "Payment failed.");
    if (E.payNowBtn) { E.payNowBtn.disabled = false; E.payNowBtn.setAttribute("aria-disabled", "false"); }
  } finally {
    confirming = false;
  }
}

function showSuccessModal() {
  const v = getDonationInputs();
  if (E.successEmail) E.successEmail.textContent = v.email || "your email";
  if (E.successAmount) E.successAmount.textContent = money0(v.total);
  if (E.successFrequency) E.successFrequency.textContent = (v.frequency === "monthly") ? "Monthly" : "One-time";
  if (E.successTeam) {
    const teamKey = v.team;
    const teamName = teamKey === "all"
      ? "All teams"
      : (state.teams.find((t) => String(t.key) === String(teamKey))?.name || "Selected team");
    E.successTeam.textContent = teamName;
  }
  closeCheckout();
  openModal(E.successModal);
}

function bindStripeUi() {
  E.checkoutClose?.addEventListener("click", closeCheckout);
  E.checkoutClose2?.addEventListener("click", closeCheckout);
  E.checkoutHelp?.addEventListener("click", () => {
    const email = CONFIG.supportEmail || "support@getfuturefunded.com";
    window.location.href = `mailto:${email}?subject=${encodeURIComponent("Donation help")}`;
  });

  E.payNowBtn?.addEventListener("click", confirmPaymentFlow);

  E.checkoutModal?.addEventListener("click", (e) => { if (e.target === E.checkoutModal) closeCheckout(); });

  E.successClose?.addEventListener("click", () => closeModal(E.successModal));
  E.successBack?.addEventListener("click", () => closeModal(E.successModal));
  E.successModal?.addEventListener("click", (e) => { if (e.target === E.successModal) closeModal(E.successModal); });

  E.successShare?.addEventListener("click", async () => {
    await doShare({ url: canonicalUrl(), title: `${String(CONFIG.org?.shortName || "Fundraiser")} • Fundraiser`, text: shareTextVariant("standard") });
  });

  E.successCopy?.addEventListener("click", async () => {
    const ok = await copyToClipboard(canonicalUrl());
    toast(ok ? "Link copied." : "Couldn’t copy.", { haptic: ok });
  });
}

function prefillDonation({ amount, team, scroll = true } = {}) {
  if (E.amountInput && Number(amount) > 0) E.amountInput.value = String(Math.round(Number(amount)));
  if (E.teamSelect && team) E.teamSelect.value = String(team);
  renderReceiptPreview();
  setSubmitEnabled();

  if (scroll) document.getElementById("donate")?.scrollIntoView({ behavior: "smooth", block: "start" });
  E.amountInput?.focus();
}

function bindDonateForm() {
  if (!E.form) return;

  $$("[data-form-amount]").forEach((b) => {
    b.addEventListener("click", () => {
      const amt = Number(b.getAttribute("data-form-amount")) || 0;
      E.amountInput.value = String(amt);
      $$("[data-form-amount]").forEach((x) => x.setAttribute("aria-pressed", String(x === b)));
      renderReceiptPreview();
      setSubmitEnabled();
      E.amountInput.focus();
    });
  });

  $$("[data-quick-amount]").forEach((b) => {
    b.addEventListener("click", () => {
      const amt = Number(b.getAttribute("data-quick-amount")) || 0;
      prefillDonation({ amount: amt, scroll: true });
    });
  });

  // Single delegated handler for all [data-prefill-amount] buttons
  document.addEventListener("click", (e) => {
    const btn = e.target?.closest?.("[data-prefill-amount]");
    if (!btn) return;
    const amt = Number(btn.getAttribute("data-prefill-amount")) || 0;
    prefillDonation({ amount: amt, scroll: true });
  });

  document.addEventListener("click", (e) => {
    const pick = e.target?.closest?.("[data-team-pick]");
    const sel = e.target?.closest?.("[data-team-select]");
    if (pick) {
      const teamKey = pick.getAttribute("data-team-pick") || "all";
      prefillDonation({ amount: Number(pick.getAttribute("data-prefill-amount")) || 50, team: teamKey, scroll: true });
    }
    if (sel) {
      const teamKey = sel.getAttribute("data-team-select") || "all";
      if (E.teamSelect) E.teamSelect.value = teamKey;
      toast("Team tagged.", { haptic: true });
    }
  });

  $$('[data-frequency]').forEach((b) => {
    b.addEventListener("click", () => {
      const v = b.getAttribute("data-frequency") || "once";
      if (b.getAttribute("aria-disabled") === "true") return;
      $$('[data-frequency]').forEach((x) => x.setAttribute("aria-pressed", String(x === b)));
      if (E.frequencyHidden) E.frequencyHidden.value = v;
      if (E.summaryFreq) E.summaryFreq.textContent = (v === "monthly") ? "Monthly" : "One-time";
    });
  });

  ["input", "change"].forEach((evt) => {
    E.amountInput?.addEventListener(evt, () => { renderReceiptPreview(); setSubmitEnabled(); });
    E.nameInput?.addEventListener(evt, setSubmitEnabled);
    E.emailInput?.addEventListener(evt, setSubmitEnabled);
    E.coverFees?.addEventListener(evt, () => { renderReceiptPreview(); setSubmitEnabled(); });
    E.roundUp?.addEventListener(evt, () => { renderReceiptPreview(); setSubmitEnabled(); });
  });

  E.form.addEventListener("submit", async (e) => {
    e.preventDefault();
    setFormError("");

    const check = validateFormInputs();
    if (!check.ok) { setFormError(check.message); return; }

    const v = getDonationInputs();
    const idem = uuid();
    if (E.ffIdemHidden) E.ffIdemHidden.value = idem;

    try {
      openCheckout();

      const payload = {
        amount: v.total,
        base_amount: v.base,
        currency: currencyCode(),
        name: v.name,
        email: v.email,
        note: v.note,
        team_focus: v.team,
        frequency: v.frequency,
        updates_opt_in: v.updatesOptIn,
        cover_fees: !!E.coverFees?.checked,
        round_up: !!E.roundUp?.checked,
        idempotency_key: idem,
      };

      const data = await createPaymentIntent(payload);
      const clientSecret = extractClientSecret(data);
      await mountElements(clientSecret);
    } catch (err) {
      closeCheckout();
      setFormError(err?.message || "Could not start checkout.");
    }
  });

  renderReceiptPreview();
  setSubmitEnabled();
}

/* -------------------------
Sticky + Back to top
------------------------- */
function initStickyAndTop() {
  const sticky = E.sticky;
  const back = E.backToTop;
  const donate = document.getElementById("donate");

  const onScroll = () => {
    const y = window.scrollY || 0;
    if (back) back.hidden = y < 800;

    if (sticky && donate) {
      const donateTop = donate.getBoundingClientRect().top + y;
      const show = y > 520 && y < (donateTop - 260);
      sticky.hidden = !show;
      sticky.setAttribute("data-show", show ? "true" : "false");
    }
  };

  window.addEventListener("scroll", onScroll, { passive: true });
  onScroll();

  back?.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));
}

/* -------------------------
Status refresh
------------------------- */
function applyStatusPayload(data) {
  const f = data?.fundraiser || data?.data?.fundraiser || data;
  if (f) {
    if (f.goal != null) state.goal = Number(f.goal) || state.goal;
    if (f.raised != null) state.raised = Number(f.raised) || state.raised;
    if (f.donors != null) state.donors = Number(f.donors) || state.donors;
    if (f.deadlineISO) CONFIG.fundraiser.deadlineISO = f.deadlineISO;
  }

  const gifts = data?.recentGifts || data?.data?.recentGifts;
  if (gifts) CONFIG.recentGifts = gifts;

  const teams = data?.teams || data?.data?.teams;
  if (Array.isArray(teams) && teams.length) state.teams = teams.map((t) => ({ ...t }));

  const sponsors = data?.sponsors || data?.data?.sponsors;
  if (sponsors && isPlainObject(sponsors)) CONFIG.sponsors = deepMerge(CONFIG.sponsors || {}, sponsors);

  const iso = data?.updatedAt || data?.updatedAtISO || data?.data?.updatedAt || data?.data?.updatedAtISO;
  const d = iso ? new Date(iso) : null;
  state.lastUpdatedAt = (d && !Number.isNaN(d.getTime())) ? d.getTime() : Date.now();
}

async function refreshStatusOnce() {
  const endpoint = getStatusEndpoint();
  try {
    const data = await fetchJson(endpoint, { method: "GET", timeoutMs: 12000 });
    applyStatusPayload(data);

    state.lastStatusOk = true;

    computeNeedsSet();
    updateProgressUi();
    setDeadlineUi();
    setLastUpdatedUi();
    renderGifts(CONFIG.recentGifts || []);
    populateTeamSelect();
    renderTeams();
    renderSponsors();
  } catch {
    state.lastStatusOk = state.lastStatusOk || false;
    setLastUpdatedUi();

    if (!state.lastStatusOk) {
      renderGifts(CONFIG.recentGifts || []);
      renderAllocation();
      renderImpact();
      computeNeedsSet();
      populateTeamSelect();
      renderTeams();
      renderSponsors();
      updateProgressUi();
    }
  }
}

function initLiveRefresh() {
  computeNeedsSet();
  updateProgressUi();
  setDeadlineUi();
  setLastUpdatedUi();
  renderAllocation();
  renderImpact();
  renderGifts(CONFIG.recentGifts || []);
  populateTeamSelect();
  renderTeams();
  renderSponsors();

  refreshStatusOnce();
  window.setInterval(refreshStatusOnce, clamp(Number(CONFIG.liveRefreshMs) || 20000, 8000, 120000));
}

/* -------------------------
Countdown tickers
------------------------- */
function renderEventCountdown() {
  const evt = (CONFIG.events || [])[0];
  if (!evt || !E.eventCountdown || !E.eventTitle) return;

  E.eventTitle.textContent = evt.title || "Upcoming event";
  const d = new Date(evt.startISO);
  if (Number.isNaN(d.getTime())) { E.eventCountdown.textContent = "Date TBD"; return; }

  const ms = d.getTime() - Date.now();
  if (ms <= 0) { E.eventCountdown.textContent = "Happening now / recently"; return; }

  const mins = Math.floor(ms / 60000);
  const hours = Math.floor(mins / 60);
  const days = Math.floor(hours / 24);
  const h = hours % 24;
  const m = mins % 60;

  if (days > 0) E.eventCountdown.textContent = `${days}d ${h}h`;
  else if (hours > 0) E.eventCountdown.textContent = `${hours}h ${m}m`;
  else E.eventCountdown.textContent = `${m}m`;
}

function initCountdownTickers() {
  const tick = () => { setDeadlineUi(); setLastUpdatedUi(); renderEventCountdown(); };
  tick();
  window.setInterval(tick, 1000 * 15);
}

/* -------------------------
Global Esc handling
------------------------- */
function initGlobalEscClose() {
  document.addEventListener("keydown", (e) => {
    if (e.key !== "Escape") return;
    if (closeTopmostModal()) return;
    if (drawerApi.isOpen && drawerApi.isOpen()) drawerApi.close();
  }, true);
}

/* -------------------------
PWA hook (safe)
------------------------- */
function initServiceWorker() {
  if (!("serviceWorker" in navigator)) return;
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/sw.js").catch(() => {});
  });
}

/* -------------------------
Boot
------------------------- */
function init() {
  applyBrand();
  initTheme();

  ensureCanonicalAndOgUrl();
  ensureSocialMeta();
  injectJsonLd();

  applyOrgText();
  measureStickyOffsets();
  initTopbarDismiss();
  initHeaderShadow();
  initDrawer();
  initScrollSpy();

  bindCopyLinks();
  bindShareOptions();
  bindSponsorKit();
  bindDonateForm();
  bindStripeUi();
  bindTeamTools();

  initStickyAndTop();
  initCountdownTickers();
  initLiveRefresh();
  initGlobalEscClose();
  initServiceWorker();

  window.addEventListener("load", debounce(measureStickyOffsets, 120));
  window.addEventListener("resize", debounce(measureStickyOffsets, 160), { passive: true });

  // Optional: expose a tiny safe API
  window.FutureFunded = {
    prefillDonation,
    refreshStatusOnce,
    share: (text) => doShare({ url: canonicalUrl(), title: document.title, text: text || shareTextVariant("standard") }),
  };
}

if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", init, { once: true });
} else {
  init();
}

})(); /* end IIFE */
</script>


</body>
</html>


