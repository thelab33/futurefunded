<!DOCTYPE html>
<html lang="en" data-theme="system">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- Hint to browsers that we support both; helps form controls + UA styling -->
  <meta name="color-scheme" content="light dark" />

  <!-- UX / privacy -->
  <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta name="robots" content="index,follow,max-image-preview:large" />

  <!-- CSRF (server-rendered apps) -->
  <meta name="csrf-token" content="{{ csrf_token() }}" />

  <!-- Primary SEO -->
  <title id="ffTitle">FutureFunded • Fundraiser</title>
  <meta
    name="description"
    id="ffDescription"
    content="Fuel the season. Fund the future. Donate securely in under a minute with instant email receipts and transparent impact."
  />

  <!-- Canonical (server-side; JS also normalizes to origin+path) -->
  <link rel="canonical" href="{{ request.base_url }}" id="ffCanonical" />

  <!-- OpenGraph -->
  {% set og_img = url_for('static', filename='images/og_connect_atx_elite.jpg', _external=True) %}
  {% set og_img_fallback = url_for('static', filename='images/connect-atx-team.jpg', _external=True) %}
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="FutureFunded" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:title" content="Fundraiser • FutureFunded" id="ffOgTitle" />
  <meta property="og:description" content="Support the season with secure checkout and instant receipts." id="ffOgDescription" />
  <meta property="og:url" content="{{ request.base_url }}" id="ffOgUrl" />

  <!-- Primary OG image (absolute URL recommended) -->
  <meta property="og:image" content="{{ og_img }}" id="ffOgImage" />
  <meta property="og:image:secure_url" content="{{ og_img }}" />
  <meta property="og:image:type" content="image/jpeg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="Support this fundraiser on FutureFunded" />

  <!-- Optional fallback OG image -->
  <meta property="og:image" content="{{ og_img_fallback }}" />
  <meta property="og:image:secure_url" content="{{ og_img_fallback }}" />
  <meta property="og:image:type" content="image/jpeg" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@FutureFunded" />
  <meta name="twitter:title" content="Fundraiser • FutureFunded" id="ffTwTitle" />
  <meta name="twitter:description" content="Support the season with secure checkout and instant receipts." id="ffTwDescription" />
  <meta name="twitter:image" content="{{ og_img }}" id="ffTwImage" />
  <meta name="twitter:image:alt" content="Support this fundraiser on FutureFunded" />

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="application-name" content="FutureFunded" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="FutureFunded" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Icons (wired to your real files) -->
  <link rel="icon" href="{{ url_for('static', filename='images/fundchamps-fc.svg') }}" type="image/svg+xml" />
  <link rel="icon" href="{{ url_for('static', filename='images/logo.webp') }}" type="image/webp" />
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/logo.webp') }}" />
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0B1020" />
  <link rel="shortcut icon" href="/favicon.ico" />

  <!-- Theme color per preference -->
  <meta name="theme-color" content="#EEF0F3" media="(prefers-color-scheme: light)" />
  <meta name="theme-color" content="#0B1020" media="(prefers-color-scheme: dark)" />

  <!-- Runtime endpoints / config (server can override via #ffConfig JSON) -->
  <meta name="ff-checkout-endpoint" content="/payments/stripe/intent" />
  <meta name="ff-status-endpoint" content="/api/status" />
  <meta name="ff-events-endpoint" content="/api/events" />
  <meta name="ff-track-endpoint" content="/api/track" />
  <meta name="ff-qr-endpoint" content="" />
  <meta name="ff-text-to-donate-phone" content="" />
  <meta name="ff-text-to-donate-keyword" content="" />
  <meta name="ff-stripe-pk" content="{{ STRIPE_PUBLISHABLE_KEY }}" />

  <!-- Privacy/analytics toggles -->
  <meta name="ff-analytics-enabled" content="true" />
  <meta name="ff-analytics-provider" content="first-party" />

  <!-- Performance: preload likely LCP image (update if your hero differs) -->
  <link
    rel="preload"
    as="image"
    href="{{ url_for('static', filename='images/TeamImage1.avif') }}"
    type="image/avif"
    fetchpriority="high"
  />

  <!-- Performance: preconnect -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://js.stripe.com" crossorigin />
  <link rel="dns-prefetch" href="//js.stripe.com" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- JSON-LD (populated by bootstrap if {} or missing) -->
  <script type="application/ld+json" id="ffJsonLd">{}</script>

  <!-- Server may inject full config JSON here -->
  <script type="application/json" id="ffConfig">{}</script>

  <!-- Optional: META CSP (better as a response header). Use Report-Only first in headers. -->
  <!--
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 base-uri 'self';
                 object-src 'none';
                 frame-ancestors 'none';
                 img-src 'self' data: https:;
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
                 font-src 'self' data: https://fonts.gstatic.com;
                 script-src 'self' https://js.stripe.com;
                 frame-src https://js.stripe.com https://hooks.stripe.com;
                 connect-src 'self' https://api.stripe.com https://m.stripe.com https://q.stripe.com;
                 upgrade-insecure-requests" />
  -->

  <!-- Stripe.js (defer is fine if your app waits for load) -->
  <script src="https://js.stripe.com/v3/" defer></script>

  <!-- Bootstrap: config parsing + meta hydration + JSON-LD generation -->
  <script>
    (function () {
      "use strict";

      function safeJsonParse(text) {
        try { return JSON.parse(text); } catch { return null; }
      }
      function getMeta(name) {
        return document.querySelector('meta[name="' + name + '"]')?.content || "";
      }
      function setMetaById(id, value) {
        var el = document.getElementById(id);
        if (!el || !value) return;
        if (el.tagName === "META") el.setAttribute("content", value);
        if (el.tagName === "LINK") el.setAttribute("href", value);
        if (el.tagName === "TITLE") el.textContent = value;
      }

      // Normalize canonical to origin+path (drops query/hash)
      var url = new URL(window.location.href);
      var pathname = url.pathname || "/";
      var cleanPath = pathname.replace(/\/+$/, "") + (pathname.endsWith("/") ? "/" : "");
      var cleanUrl = url.origin + cleanPath;

      // Pull config from script tag (server can fill), fallback to {}
      var cfgText = document.getElementById("ffConfig")?.textContent || "{}";
      var cfg = safeJsonParse(cfgText) || {};

      // Derive endpoints from meta if not present in config
      cfg.endpoints = cfg.endpoints || {};
      cfg.endpoints.checkoutIntent = cfg.endpoints.checkoutIntent || getMeta("ff-checkout-endpoint");
      cfg.endpoints.status = cfg.endpoints.status || getMeta("ff-status-endpoint");
      cfg.endpoints.events = cfg.endpoints.events || getMeta("ff-events-endpoint");
      cfg.endpoints.track = cfg.endpoints.track || getMeta("ff-track-endpoint");

      // Stripe PK from config or meta
      cfg.stripe = cfg.stripe || {};
      cfg.stripe.publishableKey = cfg.stripe.publishableKey || getMeta("ff-stripe-pk");

      // Basic page/brand defaults
      cfg.page = cfg.page || {};
      cfg.page.title = cfg.page.title || "FutureFunded • Fundraiser";
      cfg.page.description = cfg.page.description || document.getElementById("ffDescription")?.getAttribute("content") || "";
      cfg.page.ogImage = cfg.page.ogImage || document.getElementById("ffOgImage")?.getAttribute("content") || "";
      cfg.page.url = cfg.page.url || cleanUrl;

      // Theme: system | light | dark
      var theme = (cfg.theme || document.documentElement.getAttribute("data-theme") || "system").toLowerCase();
      if (!["system", "light", "dark"].includes(theme)) theme = "system";
      document.documentElement.setAttribute("data-theme", theme);

      // Hydrate canonical + social tags reliably
      setMetaById("ffCanonical", cleanUrl);
      setMetaById("ffOgUrl", cleanUrl);

      setMetaById("ffTitle", cfg.page.title);
      setMetaById("ffOgTitle", cfg.page.title);
      setMetaById("ffTwTitle", cfg.page.title);

      if (cfg.page.description) {
        setMetaById("ffDescription", cfg.page.description);
        setMetaById("ffOgDescription", cfg.page.description);
        setMetaById("ffTwDescription", cfg.page.description);
      }
      if (cfg.page.ogImage) {
        setMetaById("ffOgImage", cfg.page.ogImage);
        setMetaById("ffTwImage", cfg.page.ogImage);
      }

      // JSON-LD: Organization + DonateAction
      var orgName = (cfg.org && cfg.org.name) || "FutureFunded";
      var campaignName = (cfg.campaign && cfg.campaign.name) || "Fundraiser";
      var ld = {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": cfg.page.title,
        "description": cfg.page.description,
        "url": cleanUrl,
        "about": {
          "@type": "Organization",
          "name": orgName
        },
        "potentialAction": {
          "@type": "DonateAction",
          "name": "Donate to " + campaignName,
          "target": cleanUrl
        }
      };
      var ldEl = document.getElementById("ffJsonLd");
      if (ldEl) ldEl.textContent = JSON.stringify(ld);

      // Expose globally for app scripts
      window.__FF__ = cfg;
    })();
  </script>
  
<style>
*,
*::before,
*::after{box-sizing:border-box}
html{-webkit-text-size-adjust:100%;text-size-adjust:100%;scroll-behavior:smooth;height:100%}
body{
  margin:0;min-height:100%;overflow-x:hidden;
  font-family:ui-sans-serif,system-ui,-apple-system,"SF Pro Display","SF Pro Text","Segoe UI",Inter,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  color:var(--text);background:var(--bg);
  line-height:1.5;letter-spacing:-.01em;
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
}
img,svg,video{display:block;max-width:100%}
button,input,select,textarea{font:inherit;color:inherit}
a{color:inherit;text-decoration:none}
a:hover{text-decoration:underline;text-underline-offset:.18em}
:focus{outline:none}
:focus-visible{outline:2px solid var(--ring);outline-offset:3px;border-radius:14px}
::selection{background:color-mix(in oklab,var(--brand) 28%,transparent)}
@media (prefers-reduced-motion:reduce){
  html{scroll-behavior:auto}
  *,*::before,*::after{animation-duration:.001ms!important;animation-iteration-count:1!important;transition-duration:.001ms!important}
}

/* =========================================
   TOKENS (Light-first, Dark optional)
========================================= */
:root{
  --ff-font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;

  --t-xs:clamp(.74rem,.71rem + .12vw,.82rem);
  --t-sm:clamp(.88rem,.84rem + .16vw,.98rem);
  --t-md:clamp(1.0rem,.96rem + .2vw,1.1rem);
  --t-lg:clamp(1.14rem,1.06rem + .36vw,1.32rem);
  --t-xl:clamp(1.38rem,1.2rem + .72vw,1.82rem);
  --t-2xl:clamp(1.8rem,1.4rem + 1.55vw,2.85rem);

  --s-0:0;--s-1:.25rem;--s-2:.5rem;--s-3:.75rem;--s-4:1rem;--s-5:1.25rem;--s-6:1.6rem;--s-7:2rem;--s-8:2.6rem;--s-9:3.25rem;--s-10:4.2rem;
  --r-1:12px;--r-2:16px;--r-3:20px;--r-4:26px;--r-pill:999px;

  --container:1220px;
  --container-wide:1320px;
  --gutter:clamp(14px,3.5vw,24px);

  --brand:#f97316;
  --brand-2:#fb7185;
  --ok:#16a34a;--warn:#f59e0b;--bad:#ef4444;

  --dur-1:.14s;--dur-2:.18s;--dur-3:.26s;
  --ease: cubic-bezier(.2,.9,.2,1);
  --ease-soft:cubic-bezier(.2,.8,.2,1);

  /* LIGHT */
  color-scheme:light;
  --bg:#f6f7fb;
  --bg-2:#ffffff;
  --surface:#ffffff;
  --surface-2:#f2f4f8;
  --surface-3:#e9edf5;
  --border:rgba(15,23,42,.10);
  --border-2:rgba(15,23,42,.16);
  --text:rgba(15,23,42,.92);
  --muted:rgba(15,23,42,.66);
  --muted-2:rgba(15,23,42,.52);
  --faint:rgba(15,23,42,.38);

  --ring:color-mix(in oklab,var(--brand) 74%,white 8%);
  --shadow-1:0 10px 24px rgba(2,6,23,.08);
  --shadow-2:0 18px 44px rgba(2,6,23,.10);
  --shadow-3:0 34px 90px rgba(2,6,23,.14);

  --glass:linear-gradient(180deg,rgba(255,255,255,.92),rgba(255,255,255,.76));
  --glass-strong:linear-gradient(180deg,rgba(255,255,255,.96),rgba(255,255,255,.86));

  --topbar-h:44px;
  --header-h:72px;
  --sticky-offset:calc(var(--topbar-h) + var(--header-h) + 14px);
}

html[data-theme="light"]{color-scheme:light}
html[data-theme="dark"], @media (prefers-color-scheme:dark){
  html:not([data-theme="light"]){
    color-scheme:dark;
    --bg:#070810;
    --bg-2:#0a0c16;
    --surface:rgba(255,255,255,.06);
    --surface-2:rgba(255,255,255,.085);
    --surface-3:rgba(255,255,255,.11);
    --border:rgba(255,255,255,.10);
    --border-2:rgba(255,255,255,.16);
    --text:rgba(255,255,255,.92);
    --muted:rgba(255,255,255,.70);
    --muted-2:rgba(255,255,255,.56);
    --faint:rgba(255,255,255,.40);
    --shadow-1:0 12px 34px rgba(0,0,0,.22);
    --shadow-2:0 22px 58px rgba(0,0,0,.28);
    --shadow-3:0 34px 92px rgba(0,0,0,.34);
    --glass:linear-gradient(180deg,color-mix(in oklab,var(--surface-2) 92%,transparent) 0%,var(--surface) 100%);
    --glass-strong:linear-gradient(180deg,color-mix(in oklab,var(--surface-3) 92%,transparent) 0%,var(--surface-2) 100%);
  }
}
html[data-theme="dark"]{
  color-scheme:dark;
  --bg:#070810;
  --bg-2:#0a0c16;
  --surface:rgba(255,255,255,.06);
  --surface-2:rgba(255,255,255,.085);
  --surface-3:rgba(255,255,255,.11);
  --border:rgba(255,255,255,.10);
  --border-2:rgba(255,255,255,.16);
  --text:rgba(255,255,255,.92);
  --muted:rgba(255,255,255,.70);
  --muted-2:rgba(255,255,255,.56);
  --faint:rgba(255,255,255,.40);
  --shadow-1:0 12px 34px rgba(0,0,0,.22);
  --shadow-2:0 22px 58px rgba(0,0,0,.28);
  --shadow-3:0 34px 92px rgba(0,0,0,.34);
  --glass:linear-gradient(180deg,color-mix(in oklab,var(--surface-2) 92%,transparent) 0%,var(--surface) 100%);
  --glass-strong:linear-gradient(180deg,color-mix(in oklab,var(--surface-3) 92%,transparent) 0%,var(--surface-2) 100%);
}

.container{width:min(var(--container),calc(100% - var(--gutter) * 2));margin-inline:auto}
.container-wide{width:min(var(--container-wide),calc(100% - var(--gutter) * 2));margin-inline:auto}
.sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

.grid{display:grid;gap:var(--s-4)}
.grid-2{grid-template-columns:1fr}
.grid-3{grid-template-columns:1fr}
@media (min-width:860px){
  .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
}
.stack{display:grid;gap:var(--s-4)}
.stack-xs{gap:var(--s-2)}
.stack-sm{gap:var(--s-3)}
.stack-md{gap:var(--s-5)}
.cluster{display:flex;gap:var(--s-3);align-items:center;flex-wrap:wrap}
.cluster-between{justify-content:space-between}
.inline-actions{display:flex;gap:var(--s-2);flex-wrap:wrap;align-items:center}
.divider{height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin-block:var(--s-4);border:0}
.measure{max-width:66ch}
.kicker{font-size:var(--t-xs);letter-spacing:.14em;text-transform:uppercase;color:var(--muted-2)}
.help{font-size:var(--t-sm);color:var(--muted)}
.num{font-variant-numeric:tabular-nums;font-feature-settings:"tnum" 1,"ss01" 1}
@supports (text-wrap:balance){h1,h2,h3{ text-wrap:balance }}
h1,h2,h3{margin:0}
p{margin:0}

.section{padding:clamp(20px,5.2vw,66px) 0}
@supports (content-visibility:auto){
  .section{content-visibility:auto;contain-intrinsic-size:980px}
}

/* =========================================
   SURFACES
========================================= */
.ff-shell{
  min-height:100vh;
  background:
    radial-gradient(1200px 520px at 12% 0%, color-mix(in oklab,var(--brand) 10%,transparent), transparent 64%),
    radial-gradient(1200px 520px at 88% 6%, color-mix(in oklab,var(--brand-2) 7%,transparent), transparent 66%),
    linear-gradient(180deg,var(--bg),var(--bg-2));
}
.card{
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:var(--r-4);
  box-shadow:var(--shadow-1);
  position:relative;
}
@supports (backdrop-filter:blur(10px)){
  .card{backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px)}
}
.pad{padding:clamp(14px,2.2vw,22px)}
.lift{
  transform:translateZ(0);
  transition:
    transform var(--dur-2) var(--ease),
    border-color var(--dur-2) var(--ease),
    box-shadow var(--dur-2) var(--ease),
    background var(--dur-2) var(--ease);
}
.lift:hover{transform:translateY(-2px);box-shadow:var(--shadow-2);border-color:var(--border-2)}

.mini{
  border-radius:var(--r-3);
  border:1px solid var(--border);
  background:linear-gradient(180deg,var(--surface),color-mix(in oklab,var(--surface-2) 80%,transparent));
  padding:clamp(12px,1.6vw,16px);
}
.mini--soft{background:linear-gradient(180deg,color-mix(in oklab,var(--surface) 92%,transparent),var(--surface-2))}
.mini--compact{padding:12px;border-radius:var(--r-2)}
.mini--spotlight{
  background:
    radial-gradient(900px 240px at 10% 0%, color-mix(in oklab,var(--brand) 14%,transparent), transparent 60%),
    radial-gradient(900px 240px at 92% 0%, color-mix(in oklab,var(--brand-2) 10%,transparent), transparent 62%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  border-color:color-mix(in oklab,var(--brand) 26%,var(--border));
}
.mini--callout{
  background:
    radial-gradient(900px 240px at 12% 10%, color-mix(in oklab,var(--brand) 16%,transparent), transparent 62%),
    radial-gradient(900px 240px at 92% 0%, color-mix(in oklab,var(--brand-2) 10%,transparent), transparent 64%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  border-color:color-mix(in oklab,var(--brand) 26%,var(--border));
}

.card-head{display:flex;gap:var(--s-4);align-items:flex-start;justify-content:space-between}
.card-head__copy{min-width:0}
.card-title{margin:.35rem 0 0;font-size:var(--t-lg);letter-spacing:-.02em}
.card-head__actions{display:flex;gap:var(--s-2);flex-wrap:wrap}

/* =========================================
   BUTTONS
========================================= */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:.55rem;
  border-radius:var(--r-pill);
  padding:.68rem 1rem;
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface) 70%,transparent);
  color:var(--text);
  font-weight:750;
  font-size:var(--t-sm);
  letter-spacing:-.01em;
  cursor:pointer;user-select:none;
  transition:
    transform var(--dur-1) var(--ease),
    box-shadow var(--dur-2) var(--ease),
    border-color var(--dur-2) var(--ease),
    background var(--dur-2) var(--ease),
    opacity var(--dur-1) var(--ease);
  text-decoration:none;
}
.btn:hover{transform:translateY(-1px);border-color:var(--border-2);box-shadow:var(--shadow-1);text-decoration:none}
.btn:active{transform:translateY(0)}
.btn[disabled],.btn[aria-disabled="true"]{opacity:.55;cursor:not-allowed;box-shadow:none;transform:none}
.btn-sm{padding:.5rem .78rem;font-size:var(--t-xs)}
.btn-primary{
  background:
    radial-gradient(900px 180px at 20% 0%,rgba(255,255,255,.22),transparent 55%),
    linear-gradient(180deg,color-mix(in oklab,var(--brand) 90%,#000 10%),color-mix(in oklab,var(--brand) 72%,#000 28%));
  border-color:color-mix(in oklab,var(--brand) 44%,var(--border));
  box-shadow:0 14px 30px color-mix(in oklab,var(--brand) 18%,transparent);
  color:white;
}
.btn-primary:hover{
  border-color:color-mix(in oklab,var(--brand) 58%,white 6%);
  box-shadow:var(--shadow-2),0 0 0 1px color-mix(in oklab,white 18%,transparent),0 26px 70px color-mix(in oklab,var(--brand) 22%,transparent);
}
.btn-secondary{background:linear-gradient(180deg,var(--surface),var(--surface-2));border-color:var(--border-2)}
.btn-ghost{background:transparent;border-color:transparent}
.btn-ghost:hover{background:color-mix(in oklab,var(--surface-2) 70%,transparent);border-color:var(--border)}
.icon-btn{
  width:40px;height:40px;
  display:inline-flex;align-items:center;justify-content:center;
  border-radius:var(--r-pill);
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface) 70%,transparent);
  cursor:pointer;
  transition:transform var(--dur-1) var(--ease),border-color var(--dur-2) var(--ease),background var(--dur-2) var(--ease),box-shadow var(--dur-2) var(--ease);
}
.icon-btn:hover{transform:translateY(-1px);border-color:var(--border-2);box-shadow:var(--shadow-1)}
.icon-btn:active{transform:translateY(0)}

/* =========================================
   PILLS / CHIPS / TABS
========================================= */
.pill{
  display:inline-flex;align-items:center;gap:.5rem;
  padding:.38rem .62rem;
  border-radius:var(--r-pill);
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface) 70%,transparent);
  color:var(--muted);
  font-size:var(--t-xs);
  font-weight:850;
  letter-spacing:-.01em;
  white-space:nowrap;
}
.pill-accent{
  color:color-mix(in oklab,var(--brand) 84%,white 10%);
  border-color:color-mix(in oklab,var(--brand) 28%,var(--border));
  background:
    radial-gradient(700px 140px at 25% 0%, color-mix(in oklab,var(--brand) 18%,transparent), transparent 64%),
    color-mix(in oklab,var(--surface) 70%,transparent);
}
.pill-verified{
  color:color-mix(in oklab,var(--ok) 80%,white 10%);
  border-color:color-mix(in oklab,var(--ok) 26%,var(--border));
  background:
    radial-gradient(700px 140px at 25% 0%, color-mix(in oklab,var(--ok) 14%,transparent), transparent 64%),
    color-mix(in oklab,var(--surface) 70%,transparent);
}
.pill-muted{opacity:.9}
.pill-live{
  color:var(--text);
  border-color:color-mix(in oklab,var(--brand) 28%,var(--border));
  background:
    radial-gradient(700px 140px at 20% 0%, color-mix(in oklab,var(--brand) 20%,transparent), transparent 64%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
}
.pill-dot{
  width:8px;height:8px;border-radius:99px;background:var(--brand);
  box-shadow:0 0 0 4px color-mix(in oklab,var(--brand) 20%,transparent);
  animation:ff-pulse 1.35s ease-in-out infinite;
}
@keyframes ff-pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(.86);opacity:.72}}

.badge{
  display:inline-flex;align-items:center;justify-content:center;
  padding:.25rem .5rem;
  border-radius:var(--r-pill);
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface) 80%,transparent);
  font-weight:900;
  font-size:var(--t-xs);
}
.chip-row{display:flex;gap:var(--s-2);flex-wrap:wrap}
.chip{
  border-radius:var(--r-pill);
  border:1px solid var(--border);
  background:linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:.55rem .75rem;
  font-size:var(--t-xs);
  font-weight:900;
  cursor:pointer;
  transition:transform var(--dur-1) var(--ease),border-color var(--dur-2) var(--ease),box-shadow var(--dur-2) var(--ease),background var(--dur-2) var(--ease);
}
.chip:hover{transform:translateY(-1px);border-color:var(--border-2);box-shadow:var(--shadow-1)}
.chip[aria-pressed="true"]{
  border-color:color-mix(in oklab,var(--brand) 42%,var(--border));
  background:
    radial-gradient(700px 150px at 18% 0%, color-mix(in oklab,var(--brand) 16%,transparent), transparent 64%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
}

.segmented{
  display:inline-flex;
  border-radius:var(--r-pill);
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface-2) 75%,transparent);
  padding:4px;
  gap:4px;
}
.segmented>button{
  border:0;background:transparent;color:var(--muted);
  padding:.42rem .7rem;border-radius:var(--r-pill);
  cursor:pointer;font-weight:900;font-size:var(--t-xs);
  transition:background var(--dur-2) var(--ease),color var(--dur-2) var(--ease),transform var(--dur-1) var(--ease);
}
.segmented>button:hover{transform:translateY(-1px);background:color-mix(in oklab,var(--surface) 80%,transparent);color:var(--text)}
.segmented>button[aria-pressed="true"]{
  background:
    radial-gradient(700px 140px at 18% 0%, color-mix(in oklab,var(--brand) 14%,transparent), transparent 64%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  color:var(--text);
}

.tabs{
  display:flex;gap:6px;flex-wrap:wrap;
  padding:6px;border-radius:var(--r-pill);
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface-2) 75%,transparent);
}
.tabs>button{
  border:0;background:transparent;color:var(--muted);
  padding:.52rem .86rem;border-radius:var(--r-pill);
  cursor:pointer;font-weight:950;font-size:var(--t-xs);
  transition:background var(--dur-2) var(--ease),color var(--dur-2) var(--ease),transform var(--dur-1) var(--ease);
}
.tabs>button:hover{transform:translateY(-1px);background:color-mix(in oklab,var(--surface) 80%,transparent);color:var(--text)}
.tabs>button[aria-selected="true"]{
  background:
    radial-gradient(700px 140px at 18% 0%, color-mix(in oklab,var(--brand) 14%,transparent), transparent 64%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  color:var(--text);
}
.tabpanel[hidden]{display:none!important}

/* =========================================
   TOPBAR / HEADER
========================================= */
.topbar{
  position:sticky;top:0;z-index:60;
  border-bottom:1px solid var(--border);
  background:
    radial-gradient(1000px 260px at 10% 0%, color-mix(in oklab,var(--brand) 10%,transparent), transparent 64%),
    linear-gradient(180deg,color-mix(in oklab,var(--bg) 88%,transparent),color-mix(in oklab,var(--bg-2) 96%,transparent));
  backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);
}
.topbar-row{display:flex;gap:var(--s-3);align-items:center;justify-content:space-between;padding:.5rem 0;min-height:var(--topbar-h)}
.topbar-left{
  display:flex;gap:var(--s-2);align-items:center;flex-wrap:nowrap;min-width:0;
  list-style:none;padding:0;margin:0;
  overflow:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;
}
.topbar-left::-webkit-scrollbar{display:none}
.topbar-right{display:flex;gap:var(--s-2);align-items:center;flex-wrap:wrap}

.site-header{
  position:sticky;top:var(--topbar-h);z-index:55;
  border-bottom:1px solid var(--border);
  background:
    radial-gradient(1000px 260px at 10% 0%, color-mix(in oklab,var(--brand) 8%,transparent), transparent 64%),
    linear-gradient(180deg,color-mix(in oklab,var(--bg) 90%,transparent),color-mix(in oklab,var(--bg-2) 98%,transparent));
  backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
}
.site-header[data-scrolled="true"]{box-shadow:var(--shadow-1);border-bottom-color:var(--border-2)}
.header-row{display:flex;align-items:center;justify-content:space-between;gap:var(--s-4);padding:.75rem 0;min-height:var(--header-h)}

.brand{display:inline-flex;align-items:center;gap:.75rem;min-width:0}
.brand-mark{
  width:46px;height:46px;border-radius:16px;border:1px solid var(--border);
  background:
    radial-gradient(700px 160px at 18% 0%, color-mix(in oklab,var(--brand) 16%,transparent), transparent 64%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  display:grid;place-items:center;overflow:hidden;box-shadow:0 10px 24px rgba(2,6,23,.08);
  flex:0 0 auto;
}
.brand-logo{width:100%;height:100%;object-fit:cover}
.brand-mark-text{font-weight:950;letter-spacing:-.03em;font-size:1rem}
.brand-text{display:grid;gap:.12rem;min-width:0}
.brand-title{font-weight:950;letter-spacing:-.02em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.brand-sub{font-size:var(--t-sm);color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

.nav-links{display:none;gap:var(--s-4);align-items:center}
.nav-links a{font-size:var(--t-sm);color:var(--muted);font-weight:900;padding:.35rem .2rem;text-decoration:none}
.nav-links a:hover{color:var(--text);text-decoration:none}
.nav-links a[data-active="true"]{color:var(--text);position:relative}
.nav-links a[data-active="true"]::after{
  content:"";position:absolute;left:0;right:0;bottom:-10px;height:2px;border-radius:999px;
  background:linear-gradient(90deg,var(--brand),color-mix(in oklab,var(--brand) 45%,white 14%));
  box-shadow:0 0 16px color-mix(in oklab,var(--brand) 22%,transparent);
}
.nav-links .nav-cta{color:color-mix(in oklab,var(--brand) 82%,white 10%)}
@media (min-width:980px){.nav-links{display:inline-flex}}
.header-actions{display:inline-flex;gap:var(--s-2);align-items:center}
.hide-mobile{display:none}
@media (min-width:700px){.hide-mobile{display:inline-flex}}

.scroll-progress{height:3px;background:transparent}
#scrollProgressBar{
  display:block;height:3px;width:0%;
  background:linear-gradient(90deg,var(--brand),color-mix(in oklab,var(--brand) 45%,white 14%));
  border-radius:999px;box-shadow:0 0 16px color-mix(in oklab,var(--brand) 22%,transparent);
}

/* =========================================
   DRAWER
========================================= */
.drawer[hidden]{display:none!important}
.drawer{position:fixed;inset:0;z-index:90;display:grid;grid-template-columns:1fr;align-items:stretch}
.drawer-backdrop{position:absolute;inset:0;background:rgba(2,6,23,.55);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px)}
.drawer-panel{
  position:relative;margin-left:auto;
  width:min(420px,92vw);height:100%;
  padding:var(--s-5);
  background:
    radial-gradient(1100px 320px at 10% 0%, color-mix(in oklab,var(--brand) 12%,transparent), transparent 66%),
    linear-gradient(180deg,color-mix(in oklab,var(--bg-2) 94%,transparent),color-mix(in oklab,var(--bg-2) 98%,transparent));
  border-left:1px solid var(--border);
  box-shadow:var(--shadow-3);
  outline:none;
}
.drawer-list{display:grid;gap:var(--s-2)}
.drawer-link{
  padding:.9rem 1rem;border-radius:var(--r-3);
  border:1px solid var(--border);
  background:linear-gradient(180deg,var(--surface),var(--surface-2));
  font-weight:950;color:var(--text);
  display:flex;justify-content:space-between;align-items:center;
}
.drawer-link:hover{border-color:var(--border-2);box-shadow:var(--shadow-1);text-decoration:none}
.drawer-primary{
  border-color:color-mix(in oklab,var(--brand) 32%,var(--border));
  background:
    radial-gradient(900px 200px at 20% 0%, color-mix(in oklab,var(--brand) 14%,transparent), transparent 64%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
}

/* =========================================
   HERO
========================================= */
.hero{position:relative;padding:clamp(20px,4.6vw,44px) 0 clamp(26px,5.8vw,58px)}
.hero-bg{position:absolute;inset:0;overflow:hidden;pointer-events:none}
.hero-bg__glow{
  position:absolute;inset:-30% -20% auto -20%;height:720px;
  background:
    radial-gradient(closest-side at 20% 30%, color-mix(in oklab,var(--brand) 14%,transparent), transparent 64%),
    radial-gradient(closest-side at 70% 15%, color-mix(in oklab,var(--brand-2) 10%,transparent), transparent 66%),
    radial-gradient(closest-side at 55% 55%, rgba(255,255,255,.08), transparent 66%);
  filter:blur(12px);
}
.hero-bg__grid{
  position:absolute;inset:0;
  background:
    linear-gradient(to right, color-mix(in oklab,var(--text) 7%,transparent) 1px, transparent 1px),
    linear-gradient(to bottom, color-mix(in oklab,var(--text) 6%,transparent) 1px, transparent 1px);
  background-size:68px 68px;
  opacity:.18;
  mask-image:radial-gradient(55% 55% at 50% 0%,#000 55%,transparent 100%);
}
.hero-bg__noise{
  position:absolute;inset:0;opacity:.06;
  background:repeating-radial-gradient(circle at 10% 10%, color-mix(in oklab,var(--text) 10%,transparent) 0 1px, transparent 1px 7px);
  mix-blend-mode:overlay;
  mask-image:radial-gradient(70% 50% at 50% 0%,#000 55%,transparent 100%);
}

.hero-grid{display:grid;gap:var(--s-6);align-items:start;grid-template-columns:1fr}
@media (min-width:980px){.hero-grid{grid-template-columns:minmax(0,1.12fr) minmax(0,.88fr)}}
.hero-badges{display:flex;gap:var(--s-2);flex-wrap:wrap}
.hero-title{margin:.6rem 0 0;font-size:var(--t-2xl);line-height:1.05;letter-spacing:-.045em}
.hero-title .accent{color:color-mix(in oklab,var(--brand) 85%,white 8%)}
.hero-actions{display:flex;gap:var(--s-2);flex-wrap:wrap;margin-top:var(--s-4)}
.hero-trust{display:flex;align-items:center;gap:var(--s-2);flex-wrap:wrap;margin-top:var(--s-4);font-size:var(--t-sm);color:var(--muted)}
.hero-trust__dot{color:var(--faint)}
.hero-copy-grid{display:grid;gap:var(--s-3);margin-top:var(--s-4)}
.hero-points{list-style:none;padding:0;margin:0;display:grid;gap:.55rem}
.hero-point__icon{
  display:inline-grid;place-items:center;width:22px;height:22px;border-radius:999px;
  background:color-mix(in oklab,var(--ok) 14%,transparent);
  border:1px solid color-mix(in oklab,var(--ok) 22%,var(--border));
  margin-right:.55rem;font-weight:950;color:color-mix(in oklab,var(--ok) 76%,white 10%);
}
.hero-subgrid{display:grid;gap:var(--s-3);grid-template-columns:1fr;margin-top:var(--s-4)}
@media (min-width:680px){.hero-subgrid{grid-template-columns:repeat(3,minmax(0,1fr))}}
.hero-orgline{display:flex;gap:.75rem;align-items:center}
.hero-orgline__logo{
  width:42px;height:42px;border-radius:14px;border:1px solid var(--border);
  box-shadow:0 10px 22px rgba(2,6,23,.08);
  object-fit:cover;background:var(--surface);
}

.ff-glint::before{
  content:"";position:absolute;inset:-2px;border-radius:inherit;pointer-events:none;
  background:radial-gradient(520px 160px at 18% 0%, rgba(255,255,255,.18), transparent 60%);
  opacity:.7;
}

/* Right rail: sticky on desktop */
@media (min-width:980px){
  .hero-console{position:sticky;top:var(--sticky-offset)}
}

.hero-console{
  border-color:color-mix(in oklab,var(--brand) 16%,var(--border));
  background:
    radial-gradient(1100px 280px at 30% 0%, color-mix(in oklab,var(--brand) 12%,transparent), transparent 66%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
}
.progress-head{display:flex;justify-content:space-between;gap:var(--s-4);align-items:flex-start}
.progress-title{margin:.25rem 0 0;font-size:var(--t-lg);letter-spacing:-.02em}
.big-raise{margin-top:.55rem;font-size:clamp(1.7rem,1.35rem + 1.6vw,2.45rem);font-weight:950;letter-spacing:-.04em}

.quick-donate-grid{display:grid;gap:var(--s-3);margin-top:var(--s-4)}
.quick-donate-card{
  border-radius:var(--r-3);border:1px solid var(--border);
  background:linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:14px;
}
.quick-donate-card__inner{display:flex;gap:var(--s-3);align-items:center}
.qr-img{
  border-radius:16px;border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface-3) 40%,transparent);
  box-shadow:0 10px 22px rgba(2,6,23,.08);
}
.gifts{display:grid;gap:var(--s-2);margin-top:var(--s-3)}
.gift{
  border-radius:var(--r-2);
  border:1px solid var(--border);
  background:linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:12px;
  display:flex;justify-content:space-between;gap:var(--s-3);align-items:center;
}
.gift .who{font-weight:950;letter-spacing:-.02em}
.gift .when{font-size:var(--t-xs);color:var(--muted)}
.gift .amt{font-weight:950;letter-spacing:-.03em}

.meter{
  position:relative;height:12px;border-radius:999px;
  background:color-mix(in oklab,var(--surface-3) 70%,transparent);
  border:1px solid var(--border);
  overflow:hidden;
}
.meter>span{
  position:absolute;inset:0 auto 0 0;width:0%;
  background:linear-gradient(90deg,color-mix(in oklab,var(--brand) 78%,white 10%),var(--brand));
  box-shadow:0 0 22px color-mix(in oklab,var(--brand) 20%,transparent);
  border-radius:999px;
  transition:width .55s var(--ease);
}
.milestones{position:absolute;inset:0}
.milestones i{
  position:absolute;top:50%;
  width:2px;height:14px;
  transform:translate(-1px,-50%);
  background:color-mix(in oklab,var(--text) 12%,transparent);
  border-radius:99px;
}
.stat-row{display:flex;justify-content:space-between;gap:var(--s-3);flex-wrap:wrap;font-size:var(--t-sm);color:var(--muted)}
.progress-mini{display:flex;align-items:center;justify-content:space-between;gap:var(--s-3)}
.progress-metric{font-weight:950;letter-spacing:-.03em;font-size:var(--t-lg);color:var(--text)}

.notice{
  border-radius:var(--r-3);
  border:1px solid color-mix(in oklab,var(--brand) 18%,var(--border));
  background:
    radial-gradient(900px 180px at 20% 0%, color-mix(in oklab,var(--brand) 10%,transparent), transparent 66%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:14px;
}

/* =========================================
   FORMS
========================================= */
.field{display:grid;gap:.45rem}
.field label{font-size:var(--t-sm);color:var(--muted);font-weight:850}
.field input[type="search"],
.field input[type="text"],
.field input[type="email"],
.field input[type="number"],
.field select,
textarea.input,
input.input,
textarea{
  width:100%;
  border-radius:var(--r-3);
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface) 78%,transparent);
  padding:.78rem .9rem;
  color:var(--text);
  outline:none;
  box-shadow:inset 0 0 0 1px color-mix(in oklab,white 8%,transparent);
  transition:border-color var(--dur-2) var(--ease),box-shadow var(--dur-2) var(--ease),background var(--dur-2) var(--ease),transform var(--dur-1) var(--ease);
}
.field select{padding-right:2.2rem}
.field input:focus-visible,
.field select:focus-visible,
textarea:focus-visible{
  border-color:color-mix(in oklab,var(--brand) 40%,var(--border));
  box-shadow:0 0 0 4px color-mix(in oklab,var(--brand) 18%,transparent);
  background:color-mix(in oklab,var(--surface) 86%,transparent);
}
.input-row{
  display:flex;align-items:center;
  border-radius:var(--r-3);
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface) 78%,transparent);
  overflow:hidden;
}
.input-prefix{padding:.78rem .85rem;color:var(--muted);border-right:1px solid var(--border)}
.input-row input{border:0!important;background:transparent!important;padding:.78rem .9rem!important;width:100%}
.check{display:inline-flex;align-items:center;gap:.55rem;font-size:var(--t-sm);color:var(--muted);font-weight:800}
.check input{width:18px;height:18px;accent-color:var(--brand)}

details.faq{
  border-radius:var(--r-3);
  border:1px solid var(--border);
  background:linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:12px 14px;
}
details.faq+details.faq{margin-top:var(--s-2)}
details.faq summary{cursor:pointer;font-weight:950;color:var(--text);list-style:none}
details.faq summary::-webkit-details-marker{display:none}
details.faq p{margin:.55rem 0 0}

/* =========================================
   IMPACT / TEAMS / SPONSORS / UPDATES
========================================= */
.impact-body{display:grid;gap:var(--s-4);margin-top:var(--s-4)}
@media (min-width:980px){.impact-body{grid-template-columns:minmax(0,.95fr) minmax(0,1.05fr);align-items:start}}
.allocation{display:grid;gap:var(--s-2)}

.impact-card{
  text-align:left;
  border-radius:var(--r-4);
  border:1px solid var(--border);
  background:
    radial-gradient(1000px 260px at 10% 0%, color-mix(in oklab,var(--brand) 10%,transparent), transparent 66%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:16px;
  cursor:pointer;
  transition:transform var(--dur-2) var(--ease),border-color var(--dur-2) var(--ease),box-shadow var(--dur-2) var(--ease),background var(--dur-2) var(--ease);
}
.impact-card:hover{transform:translateY(-2px);border-color:var(--border-2);box-shadow:var(--shadow-2)}
.impact-top{display:flex;justify-content:space-between;gap:var(--s-2);align-items:center;flex-wrap:wrap}
.impact-top .tag{
  display:inline-flex;align-items:center;
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface) 70%,transparent);
  border-radius:999px;
  padding:.28rem .52rem;
  font-size:var(--t-xs);font-weight:950;color:var(--muted);
}
.impact-amt{margin-top:.8rem;font-size:clamp(1.15rem,1.0rem + .7vw,1.55rem);font-weight:950;letter-spacing:-.03em}
.impact-title{margin-top:.2rem;font-weight:950;letter-spacing:-.03em}
.impact-desc{margin-top:.35rem;font-size:var(--t-sm);color:var(--muted)}
.impact-hint{margin-top:.9rem;font-size:var(--t-xs);color:color-mix(in oklab,var(--brand) 64%,var(--muted));font-weight:950}

.team-card{
  border-radius:var(--r-4);
  border:1px solid var(--border);
  background:
    radial-gradient(1000px 260px at 10% 0%, color-mix(in oklab,var(--brand) 8%,transparent), transparent 66%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  overflow:hidden;
  box-shadow:var(--shadow-1);
}
.team-media{height:150px;background:color-mix(in oklab,var(--surface-3) 55%,transparent)}
.team-img{width:100%;height:100%;object-fit:cover}
.team-body{padding:16px}
.team-head{display:flex;justify-content:space-between;gap:var(--s-3);align-items:flex-start}
.team-name{font-weight:950;letter-spacing:-.03em;margin-top:.15rem}
.team-blurb{margin-top:.35rem;font-size:var(--t-sm);color:var(--muted)}
.team-raise{font-weight:950;letter-spacing:-.03em;text-align:right}

.leaderboard{display:grid;gap:var(--s-2);margin-top:var(--s-3)}
.leader{
  border-radius:var(--r-3);
  border:1px solid var(--border);
  background:linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:14px;
  display:flex;justify-content:space-between;gap:var(--s-3);align-items:center;
}
.leader-left{display:flex;gap:var(--s-3);align-items:center;min-width:0}
.rank{
  width:34px;height:34px;border-radius:999px;display:grid;place-items:center;border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface) 70%,transparent);
  font-weight:950;
}
.leader-name{font-weight:950;letter-spacing:-.03em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.leader-meta{font-size:var(--t-xs);color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.leader-amt{font-weight:950;letter-spacing:-.03em}

.tier{
  border-radius:var(--r-4);
  border:1px solid var(--border);
  background:
    radial-gradient(1000px 260px at 10% 0%, color-mix(in oklab,var(--brand) 8%,transparent), transparent 66%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:16px;
}
.tier-row{display:flex;justify-content:space-between;gap:var(--s-3);align-items:flex-start}
.tier-price{font-weight:950;letter-spacing:-.03em;font-size:var(--t-lg)}
.tier-desc{margin-top:.55rem;font-size:var(--t-sm);color:var(--muted)}

.timeline{display:grid;gap:var(--s-2);margin-top:var(--s-3)}
.update{
  border-radius:var(--r-3);
  border:1px solid var(--border);
  background:linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:12px 14px;
}
.update-top{display:flex;justify-content:space-between;gap:var(--s-3);align-items:flex-start}
.update-title{font-weight:950;letter-spacing:-.02em}
.update-meta{font-size:var(--t-xs);color:var(--muted);white-space:nowrap}
.update p{margin:.5rem 0 0;color:var(--muted);font-size:var(--t-sm)}
.update-actions{margin-top:.75rem;display:flex;gap:var(--s-2);flex-wrap:wrap}

/* =========================================
   MODALS
========================================= */
.modal[hidden]{display:none!important}
.modal{position:fixed;inset:0;z-index:120;display:grid;place-items:center;padding:var(--gutter)}
.modal-backdrop{
  position:absolute;inset:0;border:0;
  background:rgba(2,6,23,.58);
  backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
  cursor:pointer;
}
.modal-panel{
  position:relative;
  width:min(860px,calc(100vw - var(--gutter) * 2));
  border-radius:var(--r-4);
  border:1px solid var(--border-2);
  background:
    radial-gradient(1200px 340px at 20% 0%, color-mix(in oklab,var(--brand) 14%,transparent), transparent 66%),
    linear-gradient(180deg,var(--bg-2),color-mix(in oklab,var(--bg-2) 88%,transparent));
  box-shadow:var(--shadow-3);
  overflow:hidden;
  outline:none;
}
.modal-panel--narrow{width:min(580px,calc(100vw - var(--gutter) * 2))}
.modal-body{padding:clamp(14px,2.2vw,22px)}
.modal-title{margin:.35rem 0 0;font-size:var(--t-lg);letter-spacing:-.03em}

.alert{
  border-radius:var(--r-3);
  border:1px solid color-mix(in oklab,var(--bad) 26%,var(--border));
  background:
    radial-gradient(900px 180px at 20% 0%, color-mix(in oklab,var(--bad) 14%,transparent), transparent 66%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:12px 14px;
  color:color-mix(in oklab,var(--bad) 76%,white 10%);
}
.payment-element-wrap{
  border-radius:var(--r-4);
  border:1px solid var(--border);
  background:linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:14px;
}
.payment-subtle{margin-top:.35rem;font-size:var(--t-xs);color:var(--muted)}
kbd{
  font-family:var(--ff-font-mono);
  font-size:.86em;
  border:1px solid var(--border);
  border-bottom-color:var(--border-2);
  background:color-mix(in oklab,var(--surface) 80%,transparent);
  border-radius:10px;
  padding:.1rem .45rem;
}

/* =========================================
   TOASTS
========================================= */
.toast-region{
  position:fixed;
  right:var(--gutter);
  top:calc(var(--gutter) + 70px);
  z-index:140;
  display:grid;gap:var(--s-2);
  max-width:min(380px,calc(100vw - var(--gutter) * 2));
  pointer-events:none;
}
.toast{
  pointer-events:auto;
  border-radius:var(--r-3);
  border:1px solid var(--border);
  background:
    radial-gradient(900px 180px at 20% 0%, color-mix(in oklab,var(--brand) 10%,transparent), transparent 66%),
    linear-gradient(180deg,var(--surface),var(--surface-2));
  padding:12px 14px;
  box-shadow:var(--shadow-2);
  animation:ff-toast-in .22s var(--ease-soft) both;
}
.toast strong{display:block;font-weight:950;letter-spacing:-.02em}
.toast p{margin:.25rem 0 0;font-size:var(--t-sm);color:var(--muted)}
@keyframes ff-toast-in{from{transform:translateY(-8px);opacity:0}to{transform:translateY(0);opacity:1}}

/* =========================================
   STICKY DONATE + MOBILE TABS
========================================= */
.sticky-donate[hidden]{display:none!important}
.sticky-donate{
  position:fixed;left:0;right:0;bottom:64px;z-index:110;
  display:grid;place-items:center;
  padding:0 var(--gutter);
}
.sticky-donate__inner{
  width:min(980px,100%);
  display:flex;justify-content:space-between;align-items:center;
  gap:var(--s-3);
  padding:10px 12px;
  border-radius:var(--r-4);
  border:1px solid var(--border-2);
  background:
    radial-gradient(1100px 260px at 20% 0%, color-mix(in oklab,var(--brand) 12%,transparent), transparent 66%),
    linear-gradient(180deg,color-mix(in oklab,var(--bg-2) 92%,transparent),color-mix(in oklab,var(--bg-2) 98%,transparent));
  box-shadow:var(--shadow-2);
  backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);
}
.sticky-mini{display:grid;gap:2px;min-width:0}
.sticky-top,.sticky-bot{display:flex;gap:.5rem;align-items:baseline;flex-wrap:wrap}
.sticky-org{font-weight:950;letter-spacing:-.02em}
.dot{color:var(--faint)}
.sticky-actions{display:flex;gap:var(--s-2);flex-wrap:wrap}

.ff-mobile-tabs{
  position:fixed;left:0;right:0;bottom:0;z-index:115;
  display:grid;grid-template-columns:repeat(3,1fr);
  border-top:1px solid var(--border);
  background:
    radial-gradient(900px 240px at 15% 0%, color-mix(in oklab,var(--brand) 8%,transparent), transparent 66%),
    linear-gradient(180deg,color-mix(in oklab,var(--bg-2) 92%,transparent),color-mix(in oklab,var(--bg-2) 98%,transparent));
  backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);
}
.ff-mobile-tab{
  padding:14px 12px;text-align:center;
  font-weight:950;letter-spacing:-.02em;
  color:var(--muted);text-decoration:none;
}
.ff-mobile-tab:hover{color:var(--text);text-decoration:none}
@media (min-width:980px){
  .ff-mobile-tabs{display:none}
  .sticky-donate{bottom:var(--gutter)}
}

/* =========================================
   BACK TO TOP
========================================= */
.back-to-top{
  position:fixed;right:var(--gutter);bottom:92px;z-index:116;
  width:44px;height:44px;border-radius:var(--r-pill);
  border:1px solid var(--border);
  background:color-mix(in oklab,var(--surface) 70%,transparent);
  box-shadow:var(--shadow-1);
  cursor:pointer;display:grid;place-items:center;
  transition:transform var(--dur-2) var(--ease),border-color var(--dur-2) var(--ease),box-shadow var(--dur-2) var(--ease),opacity var(--dur-2) var(--ease);
}
.back-to-top:hover{transform:translateY(-2px);border-color:var(--border-2);box-shadow:var(--shadow-2)}
.back-to-top[hidden]{display:none!important}

/* =========================================
   FOOTER
========================================= */
.site-footer{
  border-top:1px solid var(--border);
  padding:clamp(22px,5vw,56px) 0;
  background:
    radial-gradient(1100px 280px at 10% 0%, color-mix(in oklab,var(--brand) 8%,transparent), transparent 66%),
    linear-gradient(180deg,var(--bg-2),color-mix(in oklab,var(--bg-2) 88%,transparent));
}
.site-footer__top{display:grid;gap:var(--s-6);grid-template-columns:1fr}
@media (min-width:980px){.site-footer__top{grid-template-columns:1.25fr .75fr 1fr;align-items:start}}
.footer-links{list-style:none;padding:0;margin:0;display:grid;gap:.55rem}
.footer-links a{color:var(--muted);font-weight:900}
.footer-links a:hover{color:var(--text)}
.site-footer__legal{
  margin-top:var(--s-7);
  padding-top:var(--s-4);
  border-top:1px solid var(--border);
  color:var(--muted);
  font-size:var(--t-sm);
}
.footer-legal-row{display:flex;justify-content:space-between;gap:var(--s-3);flex-wrap:wrap}
.footer-legal{color:var(--muted);font-weight:900}
.footer-legal:hover{color:var(--text)}

/* =========================================
   SKELETON / CONFETTI
========================================= */
.skeleton{
  border-radius:var(--r-3);
  border:1px solid var(--border);
  background:
    linear-gradient(90deg,
      color-mix(in oklab,var(--surface-3) 65%,transparent) 0%,
      color-mix(in oklab,var(--surface-3) 40%,transparent) 30%,
      color-mix(in oklab,var(--surface-3) 65%,transparent) 60%);
  background-size:220% 100%;
  animation:ff-shimmer 1.1s ease-in-out infinite;
}
@keyframes ff-shimmer{0%{background-position:0% 0}100%{background-position:-120% 0}}

.ff-confetti[hidden]{display:none!important}
.ff-confetti{position:fixed;inset:0;pointer-events:none;z-index:160;overflow:hidden}
.ff-confetti i{
  position:absolute;top:-10vh;
  width:10px;height:16px;border-radius:4px;
  background:rgba(249,115,22,.9);
  box-shadow:0 0 0 1px rgba(255,255,255,.12);
  animation:ff-confetti-fall 1.35s linear forwards;
}
@keyframes ff-confetti-fall{to{transform:translateY(115vh) rotate(540deg);opacity:.85}}

/* =========================================
   UTILS
========================================= */
:target{scroll-margin-top:calc(var(--sticky-offset) + 10px)}
@media (min-width:980px){:target{scroll-margin-top:calc(var(--sticky-offset) + 18px)}}
.hide{display:none!important}
.ff-fineprint{font-size:var(--t-xs);color:var(--muted-2)}
.ff-divider-strong{
  height:1px;
  background:linear-gradient(90deg,transparent,color-mix(in oklab,var(--brand) 22%,var(--border)),transparent);
  margin-block:var(--s-4);
  border:0;
}
</style>

</head>

<body class="ff-body" data-ff-theme="auto">
  <a class="sr-only" href="#content">Skip to main content</a>
  <a class="sr-only" href="#donate">Skip to donate</a>

  <noscript>
    <div class="notice" role="status" aria-live="polite" style="margin:12px;">
      <div class="kicker">JavaScript required</div>
      <p class="help">
        This fundraiser uses secure on-page checkout and live updates that require JavaScript. Please enable it to donate.
      </p>
    </div>
  </noscript>

  <div class="ff-shell" data-ff-page="fundraiser" data-ff-shell>
    <!-- Network / status (non-blocking; toggled via JS if you wire it) -->
    <div class="netbar" id="netbar" role="status" aria-live="polite" aria-atomic="true" hidden>
      <div class="container-wide">
        <div class="cluster cluster-between" style="align-items:center;">
          <div class="help"><strong>Connection issue:</strong> You appear offline. Donations may not complete until you reconnect.</div>
          <button class="btn btn-ghost btn-sm" type="button" id="netbarDismiss" aria-label="Dismiss connection notice">Dismiss</button>
        </div>
      </div>
    </div>

    <!-- Topbar -->
    <div class="topbar" role="region" aria-label="Fundraiser announcement" id="topbar">
      <div class="container-wide">
        <div class="topbar-row">
          <ul class="topbar-left" aria-label="Trust signals">
            <li>
              <span class="pill pill-live" aria-label="Live fundraiser">
                <span class="pill-dot" aria-hidden="true"></span><span>LIVE</span>
              </span>
            </li>
            <li><span class="pill pill-accent" id="orgPill">Fundraiser</span></li>
            <li><span class="pill pill-muted" id="matchPill" hidden>Match active</span></li>
            <li><span class="pill pill-muted">Secure checkout</span></li>
            <li><span class="pill pill-muted">Instant receipt</span></li>
            <li><span class="pill pill-muted">No login</span></li>
            <li><span class="pill pill-accent" id="countdownPill" aria-live="polite" aria-atomic="true">Ends soon</span></li>
            <li><span class="pill pill-muted" id="lastUpdatedPill" aria-live="polite" aria-atomic="true">Updated —</span></li>
            <li>
              <span class="pill pill-muted" id="refPill" hidden>
                Ref: <span class="num" id="refCodeText">—</span>
              </span>
            </li>
          </ul>

          <div class="topbar-right" role="group" aria-label="Announcement actions">
            <button class="btn btn-secondary btn-sm" type="button" data-ff-share-open>Share</button>
            <button class="btn btn-ghost btn-sm" type="button" data-open-trust="true">Trust</button>
            <a class="btn btn-primary btn-sm" href="#donate" aria-label="Jump to donation form">Donate</a>
            <button class="icon-btn" type="button" id="topbarDismiss" aria-label="Dismiss announcement" title="Dismiss">✕</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header class="site-header" id="top" role="banner">
      <div class="container-wide">
        <div class="header-row">
          <a class="brand" href="#top" aria-label="Fundraiser home">
            <span class="brand-mark" id="brandMark" aria-hidden="true">
              <img
                class="brand-logo"
                id="brandLogo"
                src="/static/images/logo.webp"
                alt="Organization logo"
                width="46"
                height="46"
                decoding="async"
                loading="eager"
                fetchpriority="high"
              />
              <span class="brand-mark-text" id="brandMarkText" hidden>FF</span>
            </span>

            <span class="brand-text">
              <span class="brand-title" id="orgName">Organization</span>
              <span class="brand-sub" id="orgMeta">City • State</span>
            </span>
          </a>

          <nav class="nav-links" aria-label="Primary navigation" id="navLinks">
            <a href="#progress" data-spy="progress">Progress</a>
            <a href="#impact" data-spy="impact">Impact</a>
            <a href="#updates" data-spy="updates">Updates</a>
            <a href="#teams" data-spy="teams">Teams</a>
            <a href="#sponsors" data-spy="sponsors">Sponsors</a>
            <a href="#memberships" data-spy="memberships">Memberships</a>
            <a href="#donate" data-spy="donate" class="nav-cta" aria-label="Jump to donate">Donate</a>
          </nav>

          <div class="header-actions" aria-label="Header actions">
            <span class="pill pill-verified" aria-label="Verified fundraiser">Verified</span>
            <button class="icon-btn" type="button" id="themeToggle" aria-label="Toggle theme" aria-pressed="false" title="Toggle theme">☾</button>
            <button class="icon-btn" type="button" data-open-command="true" aria-label="Open quick actions" title="Quick actions">⌘</button>
            <button class="icon-btn" type="button" data-open-trust="true" aria-label="Open trust center" title="Trust">✓</button>
            <button class="icon-btn" type="button" id="menuOpen" aria-label="Open menu" aria-expanded="false" aria-controls="mobileDrawer" title="Menu">≡</button>
            <a class="btn btn-primary btn-sm hide-mobile" href="#donate" aria-label="Jump to donation form">Donate</a>
          </div>
        </div>

        <div class="scroll-progress" aria-hidden="true"><span id="scrollProgressBar"></span></div>
      </div>
    </header>

    <!-- Mobile drawer -->
    <div class="drawer" id="mobileDrawer" data-open="false" role="dialog" aria-modal="true" aria-labelledby="drawerTitle" aria-hidden="true" hidden>
      <div class="drawer-backdrop" data-close="true" aria-hidden="true"></div>
      <div class="drawer-panel" role="document" tabindex="-1">
        <div class="cluster cluster-between" style="align-items:center;">
          <div>
            <div class="kicker" id="drawerTitle">Navigate</div>
            <div class="help">Quick links and sharing tools.</div>
          </div>
          <button class="icon-btn" type="button" aria-label="Close menu" title="Close" data-close="true">✕</button>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <div class="drawer-list" aria-label="Drawer links">
          <a class="drawer-link" href="#progress" data-close="true">Progress <span aria-hidden="true">→</span></a>
          <a class="drawer-link" href="#impact" data-close="true">Impact <span aria-hidden="true">→</span></a>
          <a class="drawer-link" href="#updates" data-close="true">Updates <span aria-hidden="true">→</span></a>
          <a class="drawer-link" href="#teams" data-close="true">Teams <span aria-hidden="true">→</span></a>
          <a class="drawer-link" href="#sponsors" data-close="true">Sponsors <span aria-hidden="true">→</span></a>
          <a class="drawer-link" href="#memberships" data-close="true">Memberships <span aria-hidden="true">→</span></a>
          <a class="drawer-link drawer-primary" href="#donate" data-close="true">Donate <span aria-hidden="true">→</span></a>
        </div>

        <div class="divider" aria-hidden="true"></div>

        <div class="inline-actions" role="group" aria-label="Drawer actions">
          <button class="btn btn-secondary" type="button" data-ff-share-open>Share</button>
          <button class="btn btn-ghost" type="button" data-ff-copy-link>Copy link</button>
          <button class="btn btn-ghost" type="button" data-open-command="true">Quick actions</button>
          <button class="btn btn-ghost" type="button" data-open-trust="true">Trust center</button>
        </div>

        <div class="mini mini--soft" style="margin-top:var(--s-4);">
          <div class="kicker">Sponsor kit</div>
          <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">Make sponsoring effortless</h3>
          <p class="help">One-click sponsor message + link for local businesses.</p>
          <div class="inline-actions" style="margin-top:.7rem;">
            <button class="btn btn-primary btn-sm" type="button" data-open-sponsor-kit="true">Open kit</button>
            <button class="btn btn-ghost btn-sm" type="button" data-close="true">Later</button>
          </div>
        </div>

        <div class="mini mini--soft" style="margin-top:var(--s-3);">
          <div class="kicker">Power user</div>
          <p class="help">Press <kbd>Ctrl</kbd> <kbd>K</kbd> (or <kbd>⌘</kbd> <kbd>K</kbd>) for quick actions.</p>
        </div>
      </div>
    </div>

    <!-- Main -->
    <main id="content" role="main" tabindex="-1">
      <!-- Hero -->
      <section class="hero" aria-labelledby="heroTitle" aria-describedby="heroDesc">
        <div class="hero-bg" aria-hidden="true">
          <div class="hero-bg__glow"></div>
          <div class="hero-bg__grid"></div>
          <div class="hero-bg__noise"></div>
        </div>

        <div class="container-wide hero-grid">
          <div class="hero-left">
            <div class="hero-badges" aria-label="Fundraiser context">
              <span class="pill" id="seasonPill">Season Fund</span>
              <span class="pill">Live progress</span>
              <span class="pill" id="sportPill">Youth program</span>
              <span class="pill pill-muted" id="heroMatchPill" hidden>Match active</span>
            </div>

            <header class="card pad lift ff-glint">
              <div class="hero-orgline">
                <img
                  id="heroLogo"
                  class="hero-orgline__logo"
                  src="/static/images/logo.webp"
                  alt="Organization logo"
                  width="42"
                  height="42"
                  decoding="async"
                  loading="eager"
                  fetchpriority="high"
                />
                <p class="kicker" id="heroOrgLine">Organization • Fundraiser</p>
              </div>

              <h1 id="heroTitle" class="hero-title">
                Fund the season. Build the future.<br />
                <span class="accent" id="heroAccentLine">Keep kids playing—keep families supported.</span>
              </h1>

              <p class="sr-only" id="heroDesc">Use Donate to jump to the secure donation form. Checkout opens securely on this page.</p>

              <div class="hero-actions" role="group" aria-label="Primary actions">
                <a class="btn btn-primary" href="#donate" aria-label="Donate now">Donate</a>
                <a class="btn btn-secondary" href="#sponsors" aria-label="View sponsor leaderboard">Sponsor leaderboard</a>
                <button class="btn btn-ghost" type="button" data-open-sponsor-kit="true">Sponsor kit</button>
                <button class="btn btn-ghost" type="button" data-ff-copy-link>Copy link</button>
              </div>

              <div class="hero-trust" aria-label="Checkout explanation">
                <span><strong>Secure</strong> checkout</span>
                <span class="hero-trust__dot" aria-hidden="true">•</span>
                <span><strong>Instant</strong> email receipt</span>
                <span class="hero-trust__dot" aria-hidden="true">•</span>
                <span><strong>No</strong> account required</span>
                <span class="hero-trust__dot" aria-hidden="true">•</span>
                <button class="btn btn-ghost btn-sm" type="button" data-open-trust="true" aria-label="Open trust center">Trust center</button>
              </div>

              <div class="divider" aria-hidden="true"></div>

              <details class="faq" style="background:var(--glass-strong);" id="storyFold">
                <summary>Read the mission in 20 seconds</summary>
                <p class="help measure" id="heroStory">
                  We’re funding real season costs—gym time, travel, and gear—so families aren’t carrying the full load.
                  Every gift protects scholarships, stabilizes schedules, and keeps more kids consistently on the floor.
                </p>
              </details>

              <div class="ff-fineprint" style="margin-top:.6rem;">Mobile-first donors. Built for fast share + fast checkout.</div>
            </header>

            <div class="hero-copy-grid">
              <div class="mini mini--spotlight">
                <p class="measure" id="heroCopy">
                  Your gift covers real season costs—gym time, travel, and gear—so families aren’t carrying everything alone.
                  Sponsors get premium recognition that’s effortless to share.
                </p>
              </div>

              <div class="mini mini--soft">
                <ul class="hero-points measure" aria-label="What your gift funds">
                  <li><span class="hero-point__icon" aria-hidden="true">✓</span><span><strong>Uniforms + gear</strong> every athlete needs.</span></li>
                  <li><span class="hero-point__icon" aria-hidden="true">✓</span><span><strong>Gym time + coaching</strong> for consistent practice.</span></li>
                  <li><span class="hero-point__icon" aria-hidden="true">✓</span><span><strong>Tournament travel</strong> that keeps weekends doable.</span></li>
                </ul>
              </div>

              <div class="mini mini--soft">
                <p class="measure" id="heroCopy2">
                  Every donation reduces the burden on families and helps kids stay on one schedule all season.
                  <strong>Secure checkout</strong> stays on this page and receipts are emailed instantly.
                </p>
              </div>
            </div>

            <div class="hero-subgrid" aria-label="Highlights">
              <article class="mini mini--soft" aria-label="Upcoming event">
                <div class="kicker">Next up</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;" id="eventTitle">Upcoming event</h3>
                <p class="help" id="eventCountdown">
                  <span class="skeleton" style="display:inline-block; width:14ch; height:1em; vertical-align:-0.15em;"></span>
                </p>
              </article>

              <article class="mini mini--soft" aria-label="Transparency promise">
                <div class="kicker">Trust</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">Receipts + transparent impact.</h3>
                <p class="help">Donor info is used for receipts and optional updates—never sold.</p>
              </article>

              <article class="mini mini--soft" aria-label="Sponsor friendly">
                <div class="kicker">Sponsors</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">Logo-ready recognition.</h3>
                <p class="help">Leaderboard + sponsor kit help businesses say “yes” faster.</p>
              </article>
            </div>
          </div>

          <aside class="hero-right" aria-label="Progress and quick donate">
            <article class="card pad lift hero-console ff-glint" id="progress" aria-labelledby="progressTitle">
              <div class="progress-head">
                <div>
                  <div class="kicker">Progress</div>
                  <h2 id="progressTitle" class="progress-title">Fundraising progress</h2>

                  <div class="big-raise num" id="raisedBig" aria-live="polite" aria-atomic="true">$0</div>

                  <div class="help">
                    <span class="num" id="remainingText">$0</span> to go •
                    <span class="num" id="deadlineText">—</span>
                    <span aria-hidden="true"> • </span>
                    <span class="num" id="lastUpdatedText">Updated —</span>
                  </div>
                </div>

                <span class="pill" aria-label="Goal amount">Goal <span class="num" id="goalPill">$0</span></span>
              </div>

              <div class="quick-donate-grid" aria-label="Donate options">
                <section class="quick-donate-card" aria-label="Scan to donate">
                  <div class="quick-donate-card__inner">
                    <img id="donateQr" class="qr-img" width="112" height="112" alt="QR code to donate" loading="lazy" decoding="async" referrerpolicy="no-referrer" src="" />
                    <div style="min-width:0;">
                      <div class="kicker">Scan to donate</div>
                      <p class="help">Open camera → scan → donate.</p>
                      <div class="inline-actions">
                        <button class="btn btn-secondary btn-sm" type="button" data-ff-copy-link>Copy link</button>
                        <button class="btn btn-ghost btn-sm" type="button" data-ff-share-open>Share</button>
                      </div>
                      <div class="payment-subtle">Apple Pay / Google Pay supported when available.</div>
                    </div>
                  </div>
                </section>

                <section class="quick-donate-card" id="textDonateCard" aria-label="Text to donate" hidden>
                  <div class="kicker">Text to donate</div>
                  <div class="help" style="margin-top:.35rem;">
                    Text <span class="badge" id="textDonateKeyword">—</span> to <span class="num" id="textDonatePhone">—</span>
                  </div>
                  <p class="help" id="textDonateHint">Standard messaging rates may apply.</p>
                  <div class="inline-actions">
                    <a class="btn btn-secondary btn-sm" href="#" id="textDonateSmsLink">Open texting</a>
                    <button class="btn btn-ghost btn-sm" type="button" id="textDonateCopy">Copy</button>
                  </div>
                </section>

                <section class="quick-donate-card" aria-label="Activity">
                  <div class="cluster cluster-between">
                    <div>
                      <div class="kicker">Activity</div>
                      <p class="help">Live signals build trust quickly.</p>
                    </div>
                    <div class="segmented" role="group" aria-label="Activity view" id="activitySeg">
                      <button type="button" data-activity="gifts" aria-pressed="true">Gifts</button>
                      <button type="button" data-activity="top" aria-pressed="false">Top</button>
                      <button type="button" data-activity="refs" aria-pressed="false">Ref</button>
                    </div>
                  </div>

                  <div class="gifts" id="giftsList" aria-label="Recent donor gifts list">
                    <div class="gift skeleton" aria-hidden="true" style="height:56px;"></div>
                    <div class="gift skeleton" aria-hidden="true" style="height:56px;"></div>
                    <div class="gift skeleton" aria-hidden="true" style="height:56px;"></div>
                  </div>

                  <div class="inline-actions" style="margin-top:.65rem;">
                    <button class="btn btn-secondary btn-sm" type="button" data-ff-share-open>Share</button>
                    <button class="btn btn-ghost btn-sm" type="button" data-ff-copy-link>Copy link</button>
                  </div>
                </section>
              </div>

              <div class="ff-divider-strong" aria-hidden="true"></div>

              <div class="meter" role="progressbar" aria-label="Overall fundraising progress" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-valuetext="0% funded">
                <div class="milestones" aria-hidden="true">
                  <i style="left:25%"></i><i style="left:50%"></i><i style="left:75%"></i><i style="left:100%"></i>
                </div>
                <span id="overallBar"></span>
              </div>

              <div class="stat-row" aria-label="Raised and goal numbers">
                <span>Raised: <span class="num" id="raisedRow">$0</span></span>
                <span>Goal: <span class="num" id="goalRow">$0</span></span>
                <span><strong class="num" id="pctText">0</strong>%</span>
              </div>

              <div class="divider" aria-hidden="true"></div>

              <div class="grid grid-2" style="gap:var(--s-3);">
                <div class="mini mini--soft progress-mini">
                  <div>
                    <div class="kicker">Donors</div>
                    <div class="progress-metric num" id="donorsText">0</div>
                  </div>
                  <div style="text-align:right;">
                    <div class="kicker">Avg gift</div>
                    <div class="progress-metric num" id="avgGiftText">$0</div>
                  </div>
                </div>

                <div class="mini mini--soft progress-mini">
                  <div>
                    <div class="kicker">Days left</div>
                    <div class="progress-metric num" id="daysLeftText">—</div>
                  </div>
                  <div style="text-align:right;">
                    <div class="kicker">Next milestone</div>
                    <div class="progress-metric num" id="nextMilestoneText">—</div>
                  </div>
                </div>
              </div>

              <div class="divider" aria-hidden="true"></div>

              <div class="cluster cluster-between" id="recurringRow" hidden aria-label="Recurring gift option">
                <div>
                  <div class="kicker">Recurring</div>
                  <div class="help">Make this a monthly gift at checkout.</div>
                </div>
                <div class="segmented" role="group" aria-label="Gift frequency" data-ff-frequency-top>
                  <button type="button" data-frequency="once" aria-pressed="true">Once</button>
                  <button type="button" data-frequency="monthly" aria-pressed="false">Monthly</button>
                </div>
              </div>

              <div class="kicker" style="margin-top:var(--s-3);">Quick gifts</div>
              <p class="help">One tap prefills checkout.</p>

              <div class="chip-row" role="group" aria-label="Quick gift buttons">
                <button class="chip" type="button" data-quick-amount="25" aria-pressed="false">$25</button>
                <button class="chip" type="button" data-quick-amount="75" aria-pressed="false">$75</button>
                <button class="chip" type="button" data-quick-amount="150" aria-pressed="false">$150</button>
                <button class="chip" type="button" data-quick-amount="500" aria-pressed="false">$500</button>
                <button class="chip" type="button" data-quick-amount="1000" aria-pressed="false">Sponsor $1,000</button>
              </div>

              <div class="divider" aria-hidden="true"></div>

              <div class="inline-actions" role="group" aria-label="Progress actions">
                <button class="btn btn-secondary btn-sm" type="button" data-ff-share-open>Share</button>
                <button class="btn btn-ghost btn-sm" type="button" data-ff-copy-link>Copy link</button>
                <button class="btn btn-ghost btn-sm" type="button" data-open-command="true">Quick actions</button>
                <a class="btn btn-primary btn-sm" href="#donate" aria-label="Jump to donation form">Donate</a>
              </div>

              <p class="help" style="margin-top:.7rem;">Secure payment stays on this page. Receipt arrives by email after payment.</p>
            </article>
          </aside>
        </div>
      </section>

      <!-- Impact -->
      <section id="impact" class="section" aria-labelledby="impactTitle">
        <div class="container-wide">
          <div class="grid grid-2" style="gap:var(--s-4); align-items:start;">
            <header class="card pad lift ff-glint" aria-label="Impact overview">
              <div class="kicker">Impact</div>
              <h2 id="impactTitle" style="margin:.35rem 0 0; font-size:var(--t-xl); letter-spacing:-.03em;">Every dollar has a job.</h2>
              <p class="measure">
                Transparent use of funds across <strong>gear</strong>, <strong>gym time</strong>, <strong>travel</strong>,
                <strong>snacks</strong>, and <strong>scholarships</strong>. Tap an option below to prefill a secure donation.
              </p>
              <div class="inline-actions" style="margin-top:.85rem;">
                <a class="btn btn-primary btn-sm" href="#donate">Donate now</a>
                <a class="btn btn-secondary btn-sm" href="#sponsors">Sponsor tiers</a>
                <button class="btn btn-ghost btn-sm" type="button" data-open-trust="true">How funds are handled</button>
              </div>

              <div class="divider" aria-hidden="true"></div>

              <div class="grid grid-3" aria-label="Impact KPIs" style="gap:var(--s-3);">
                <div class="mini mini--soft">
                  <div class="kicker">Clarity</div>
                  <div style="font-weight:950; letter-spacing:-.02em;">Visible allocation</div>
                  <div class="help">Donors see where gifts typically go.</div>
                </div>
                <div class="mini mini--soft">
                  <div class="kicker">Speed</div>
                  <div style="font-weight:950; letter-spacing:-.02em;">Prefill checkout</div>
                  <div class="help">Tap impact → amount auto-fills.</div>
                </div>
                <div class="mini mini--soft">
                  <div class="kicker">Trust</div>
                  <div style="font-weight:950; letter-spacing:-.02em;">Receipts</div>
                  <div class="help">Email receipt immediately after payment.</div>
                </div>
              </div>
            </header>

            <aside aria-label="Impact helper card">
              <article class="mini mini--callout lift ff-glint" aria-label="Impact note">
                <div class="kicker">Fast checkout</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">Tap impact → prefilled gift</h3>
                <p class="help">Choose an impact card to prefill the amount—then confirm securely. No redirect. No account.</p>
                <div class="inline-actions" style="margin-top:.75rem;">
                  <button class="btn btn-secondary btn-sm" type="button" data-ff-share-open>Share impact</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-ff-copy-link>Copy link</button>
                </div>

                <div class="mini mini--soft" style="margin-top:var(--s-3);">
                  <div class="kicker">Sponsor-ready</div>
                  <p class="help" style="margin:.45rem 0 0;">Businesses get a shareable message + VIP recognition automatically.</p>
                  <div class="inline-actions" style="margin-top:.6rem;">
                    <button class="btn btn-primary btn-sm" type="button" data-open-sponsor-kit="true">Open sponsor kit</button>
                    <a class="btn btn-ghost btn-sm" href="#sponsors">View leaderboard</a>
                  </div>
                </div>
              </article>
            </aside>
          </div>

          <div class="impact-body">
            <article class="card pad lift ff-glint" aria-label="Typical allocation">
              <div class="card-head">
                <div class="card-head__copy">
                  <div class="kicker">Transparency</div>
                  <h3 class="card-title">Where funds typically go</h3>
                  <p class="help measure">Categories reflect real season costs. Exact allocations can shift based on tournaments and gym availability.</p>
                </div>
                <div class="card-head__actions"><a class="btn btn-secondary btn-sm" href="#donate">Support the season</a></div>
              </div>

              <div class="allocation" id="allocationBars" aria-label="Typical fund allocation bars">
                <div class="skeleton" aria-hidden="true" style="height:14px;"></div>
                <div class="skeleton" aria-hidden="true" style="height:14px;"></div>
                <div class="skeleton" aria-hidden="true" style="height:14px;"></div>
              </div>

              <div class="divider" aria-hidden="true"></div>
              <div class="help">Designed for conversion: transparency + recognition increases cold-traffic trust.</div>
            </article>

            <article class="card pad lift ff-glint" aria-label="Pick an impact">
              <div class="cluster cluster-between" style="align-items:flex-start;">
                <div>
                  <div class="kicker">Pick an impact</div>
                  <h3 style="margin-top:.35rem;">Choose what you want to fund</h3>
                  <p class="help measure" style="margin-top:.35rem;">Each option prefills a secure donation amount and highlights where it helps most.</p>
                </div>
                <div class="inline-actions"><a class="btn btn-secondary btn-sm" href="#donate">Donate</a></div>
              </div>

              <div aria-hidden="true" style="height:var(--s-3);"></div>

              <div class="grid grid-3" id="impactGrid" role="list" aria-label="Impact options">
                <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
                <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
                <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
              </div>

              <div class="inline-actions" style="margin-top:var(--s-4);">
                <a class="btn btn-primary" href="#donate">Make a donation</a>
                <a class="btn btn-secondary" href="#sponsors">Explore sponsorships</a>
              </div>

              <div class="notice" id="refNotice" style="margin-top:var(--s-4);" hidden>
                <div class="kicker">Sharing credit</div>
                <p class="help">This link supports attribution for your share: <strong class="num" id="refNoticeCode">—</strong></p>
              </div>
            </article>
          </div>
        </div>
      </section>

      <!-- Updates -->
      <section id="updates" class="section" aria-labelledby="updatesTitle">
        <div class="container-wide">
          <div class="grid grid-2" style="gap:var(--s-4); align-items:start;">
            <header class="card pad lift ff-glint" aria-label="Updates overview">
              <div class="kicker">Updates</div>
              <h2 id="updatesTitle" style="margin:.35rem 0 0; font-size:var(--t-xl); letter-spacing:-.03em;">Momentum you can see.</h2>
              <p class="measure">Short, frequent updates build trust and increase repeat gifts. This feed is designed to be share-friendly.</p>
              <div class="inline-actions" style="margin-top:.85rem;">
                <button class="btn btn-secondary btn-sm" type="button" data-ff-share-open>Share an update</button>
                <button class="btn btn-ghost btn-sm" type="button" data-open-trust="true">Receipts & privacy</button>
              </div>
            </header>

            <aside aria-label="Updates helper card">
              <article class="mini mini--callout lift ff-glint" aria-label="Update template">
                <div class="kicker">Template</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">Copy-paste update</h3>
                <p class="help" id="updateTemplateText">“Practice was strong this week. Next tournament is coming up—every gift helps with travel + gym time.”</p>
                <div class="inline-actions" style="margin-top:.75rem;">
                  <button class="btn btn-secondary btn-sm" type="button" id="copyUpdateTemplate">Copy template</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-ff-copy-link>Copy fundraiser link</button>
                </div>
                <div class="ff-fineprint" style="margin-top:.6rem;">Best share rate: 1 photo + 2 sentences.</div>
              </article>
            </aside>
          </div>

          <article class="card pad lift ff-glint" aria-label="Updates feed" style="margin-top:var(--s-4);">
            <div class="card-head">
              <div class="card-head__copy">
                <div class="kicker">Live feed</div>
                <h3 class="card-title">Latest program updates</h3>
                <p class="help measure">Designed for quick scanning. Filter by category.</p>
              </div>
              <div class="card-head__actions">
                <div class="tabs" role="tablist" aria-label="Updates filter" id="updatesTabs">
                  <button type="button" role="tab" aria-selected="true" aria-controls="updatesAll" id="tabUpdatesAll" data-tab="all">All</button>
                  <button type="button" role="tab" aria-selected="false" aria-controls="updatesGames" id="tabUpdatesGames" data-tab="games">Games</button>
                  <button type="button" role="tab" aria-selected="false" aria-controls="updatesTravel" id="tabUpdatesTravel" data-tab="travel">Travel</button>
                  <button type="button" role="tab" aria-selected="false" aria-controls="updatesGear" id="tabUpdatesGear" data-tab="gear">Gear</button>
                </div>
              </div>
            </div>

            <div class="divider" aria-hidden="true"></div>

            <div id="updatesAll" class="tabpanel" role="tabpanel" aria-labelledby="tabUpdatesAll">
              <div class="timeline" id="updatesList">
                <div class="update skeleton" aria-hidden="true" style="height:86px;"></div>
                <div class="update skeleton" aria-hidden="true" style="height:86px;"></div>
                <div class="update skeleton" aria-hidden="true" style="height:86px;"></div>
              </div>
            </div>
            <div id="updatesGames" class="tabpanel" role="tabpanel" aria-labelledby="tabUpdatesGames" hidden></div>
            <div id="updatesTravel" class="tabpanel" role="tabpanel" aria-labelledby="tabUpdatesTravel" hidden></div>
            <div id="updatesGear" class="tabpanel" role="tabpanel" aria-labelledby="tabUpdatesGear" hidden></div>

            <div class="divider" aria-hidden="true"></div>

            <div class="inline-actions">
              <a class="btn btn-primary btn-sm" href="#donate">Support the next milestone</a>
              <button class="btn btn-secondary btn-sm" type="button" data-ff-share-open>Share fundraiser</button>
            </div>
          </article>
        </div>
      </section>

      <!-- Teams -->
      <section id="teams" class="section" aria-labelledby="teamsTitle">
        <div class="container-wide">
          <div class="grid grid-2" style="gap:var(--s-4); align-items:start;">
            <header class="card pad lift ff-glint" aria-label="Teams overview">
              <div class="kicker">Teams</div>
              <h2 id="teamsTitle" style="margin:.35rem 0 0; font-size:var(--t-xl); letter-spacing:-.03em;">Support a team—or the whole program.</h2>
              <p class="measure">Team tags help reporting and recognition. Funds still support the full program unless your organization restricts allocations.</p>
              <div class="cluster" aria-label="Team stats" style="margin-top:var(--s-3);">
                <span class="pill pill-muted">Teams: <span class="num" id="teamsCount">—</span></span>
                <span class="pill pill-muted">Featured: <span class="num" id="teamsFeaturedCount">—</span></span>
                <span class="pill pill-muted">Needing support: <span class="num" id="teamsNeedsCount">—</span></span>
                <span class="pill pill-accent" id="teamsFilterPill" aria-live="polite" aria-atomic="true">All teams</span>
              </div>
            </header>

            <aside aria-label="Teams helper card">
              <article class="mini mini--callout lift ff-glint" aria-label="Sharing tip">
                <div class="kicker">Conversion tip</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">Short updates drive more gifts</h3>
                <p class="help">Post a quick story (photo + 2–3 sentences). Momentum increases cold traffic trust and shares.</p>
                <div class="inline-actions" style="margin-top:.75rem;">
                  <button class="btn btn-secondary btn-sm" type="button" data-ff-share-open>Share teams</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-ff-copy-link>Copy link</button>
                </div>
              </article>
            </aside>
          </div>

          <article class="card pad lift ff-glint" aria-label="Team selection tools">
            <div class="cluster cluster-between" style="align-items:flex-start; gap:var(--s-4);">
              <div>
                <h3 style="margin:0;">Find a team <span class="help">(optional)</span></h3>
                <p class="help measure" style="margin-top:.4rem;">Choose a team to tag your gift, or keep <strong>All teams</strong> for maximum flexibility.</p>
              </div>

              <div class="inline-actions" aria-label="Team filter">
                <div class="segmented" role="tablist" aria-label="Team filter" id="teamFilter">
                  <button type="button" data-team-filter="all" aria-pressed="true">All teams</button>
                  <button type="button" data-team-filter="featured" aria-pressed="false">Featured</button>
                  <button type="button" data-team-filter="needs" aria-pressed="false">Needing support</button>
                </div>

                <div class="field" style="margin:0; min-width:220px;">
                  <label class="sr-only" for="teamSearch">Search teams</label>
                  <input id="teamSearch" type="search" placeholder="Search team name…" autocomplete="off" />
                </div>
              </div>
            </div>

            <div class="notice" id="teamsEmpty" hidden aria-live="polite" aria-atomic="true" style="margin-top:var(--s-4);">
              <div class="kicker">No matches</div>
              <p class="help">Try a different name, or switch back to <strong>All teams</strong>.</p>
            </div>
          </article>

          <div aria-hidden="true" style="height:var(--s-4);"></div>

          <div id="teamsGrid" class="grid grid-3" role="list" aria-label="Team cards">
            <div class="skeleton" aria-hidden="true" style="height:360px;"></div>
            <div class="skeleton" aria-hidden="true" style="height:360px;"></div>
            <div class="skeleton" aria-hidden="true" style="height:360px;"></div>
          </div>

          <div class="inline-actions" role="group" aria-label="Team actions" style="margin-top:var(--s-5);">
            <a class="btn btn-secondary" href="#donate">Donate to all teams</a>
            <button class="btn btn-ghost" type="button" data-ff-share-open>Share</button>
          </div>
        </div>
      </section>

      <!-- Sponsors -->
      <section id="sponsors" class="section" aria-labelledby="sponsorsTitle">
        <div class="container-wide">
          <div class="grid grid-2" style="gap:var(--s-4); align-items:start;">
            <header class="card pad lift ff-glint" aria-label="Sponsors overview">
              <div class="kicker">Sponsors</div>
              <h2 id="sponsorsTitle" style="margin:.35rem 0 0; font-size:var(--t-xl); letter-spacing:-.03em;">VIP sponsor leaderboard</h2>
              <p class="measure">Sponsors get premium placement, recognition, and an easy-to-share sponsor kit. Choose a tier below or contribute a custom amount.</p>

              <div class="inline-actions" style="margin-top:var(--s-3);" aria-label="Sponsor actions">
                <a class="btn btn-primary" href="#donate" aria-label="Jump to sponsor checkout">Become a sponsor</a>
                <button class="btn btn-secondary" type="button" data-open-sponsor-kit="true" aria-label="Open sponsor kit">Sponsor kit</button>
                <button class="btn btn-ghost" type="button" data-ff-share-open>Share</button>
              </div>

              <div class="cluster" style="margin-top:var(--s-3);" aria-label="Sponsor trust signals">
                <span class="pill pill-muted">Receipt-ready</span>
                <span class="pill pill-muted">Instant confirmation</span>
                <span class="pill pill-muted">Shareable message</span>
                <span class="pill pill-accent" id="sponsorSpotlightPill" hidden>Spotlight active</span>
              </div>
            </header>

            <aside aria-label="Sponsor helper card">
              <article class="mini mini--callout lift ff-glint" aria-label="Sponsor benefits">
                <div class="kicker">Recognition</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">More than a donation</h3>
                <p class="help">Sponsors appear on the leaderboard and can share a sponsor message instantly. Tiers can be customized per organization.</p>
                <div class="inline-actions" style="margin-top:.75rem;">
                  <button class="btn btn-secondary btn-sm" type="button" data-open-sponsor-kit="true">Open sponsor kit</button>
                  <a class="btn btn-ghost btn-sm" href="#donate">Sponsor now</a>
                </div>

                <div class="mini mini--soft" style="margin-top:var(--s-3);">
                  <div class="kicker">Sponsor proof</div>
                  <p class="help" style="margin:.45rem 0 0;">Leaderboard updates live and is share-friendly for businesses.</p>
                </div>
              </article>
            </aside>
          </div>

          <div class="grid grid-2" style="gap:var(--s-4); align-items:start; margin-top:var(--s-4);">
            <article class="card pad lift ff-glint" aria-label="Sponsor leaderboard">
              <div class="card-head">
                <div class="card-head__copy">
                  <div class="kicker">Leaderboard</div>
                  <h3 class="card-title">Top sponsors</h3>
                  <p class="help measure">Updated live as sponsors join.</p>

                  <div class="mini mini--soft" style="margin-top:.85rem;">
                    <div class="kicker">Spotlight</div>
                    <div class="help"><strong id="spotlightTitle">—</strong></div>
                    <div class="help" id="spotlightCopy">—</div>
                  </div>
                </div>
                <div class="card-head__actions">
                  <button class="btn btn-ghost btn-sm" type="button" data-ff-share-open>Share sponsors</button>
                </div>
              </div>

              <div class="leaderboard" id="sponsorWall" aria-label="Sponsor leaderboard list">
                <div class="leader skeleton" aria-hidden="true" style="height:68px;"></div>
                <div class="leader skeleton" aria-hidden="true" style="height:68px;"></div>
                <div class="leader skeleton" aria-hidden="true" style="height:68px;"></div>
                <div class="leader skeleton" aria-hidden="true" style="height:68px;"></div>
              </div>

              <div class="divider" aria-hidden="true"></div>

              <div class="inline-actions" aria-label="Leaderboard actions">
                <a class="btn btn-primary btn-sm" href="#donate">Sponsor a tier</a>
                <button class="btn btn-secondary btn-sm" type="button" data-open-sponsor-kit="true">Get sponsor kit</button>
              </div>

              <p class="help" style="margin-top:.7rem;">VIP ordering / featured placement is configurable in admin.</p>
            </article>

            <article class="card pad lift ff-glint" aria-label="Sponsorship tiers">
              <div class="card-head">
                <div class="card-head__copy">
                  <div class="kicker">Tiers</div>
                  <h3 class="card-title">Pick a sponsor tier</h3>
                  <p class="help measure">Selecting a tier prefills checkout and applies recognition automatically.</p>
                </div>
              </div>

              <div id="sponsorTiers" class="grid grid-2" role="list" aria-label="Sponsor tier cards">
                <div class="skeleton" aria-hidden="true" style="height:180px;"></div>
                <div class="skeleton" aria-hidden="true" style="height:180px;"></div>
              </div>

              <div class="divider" aria-hidden="true"></div>

              <div class="inline-actions">
                <a class="btn btn-primary" href="#donate">Donate / sponsor now</a>
                <button class="btn btn-ghost" type="button" data-open-sponsor-kit="true">Sponsor kit</button>
              </div>
            </article>
          </div>

          <div class="inline-actions" role="group" aria-label="Sponsor section actions" style="margin-top:var(--s-5);">
            <a class="btn btn-primary" href="#donate">Donate / sponsor now</a>
            <button class="btn btn-secondary" type="button" data-ff-share-open>Share this fundraiser</button>
            <button class="btn btn-ghost" type="button" data-ff-copy-link>Copy link</button>
          </div>
        </div>
      </section>

      <!-- Memberships -->
      <section id="memberships" class="section" aria-labelledby="membershipsTitle">
        <div class="container-wide">
          <div class="grid grid-2" style="gap:var(--s-4); align-items:start;">
            <header class="card pad lift ff-glint" aria-label="Memberships overview">
              <div class="kicker">Memberships</div>
              <h2 id="membershipsTitle" style="margin:.35rem 0 0; font-size:var(--t-xl); letter-spacing:-.03em;">Sustain the program monthly.</h2>
              <p class="measure">Memberships stabilize costs and unlock VIP recognition. Choose monthly or annual support—checkout stays on-page.</p>
              <div class="inline-actions" style="margin-top:var(--s-3);">
                <button class="btn btn-primary btn-sm" type="button" data-open-memberships="true">Pick a membership</button>
                <a class="btn btn-secondary btn-sm" href="#donate">Or donate once</a>
              </div>
              <div class="ff-fineprint" style="margin-top:.6rem;">Membership perks are configurable (badges, sponsor placement, benefits).</div>
            </header>

            <aside aria-label="Memberships helper card">
              <article class="mini mini--callout lift ff-glint" aria-label="Membership note">
                <div class="kicker">High ROI</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">Recurring gifts win seasons</h3>
                <p class="help">Monthly support reduces last-minute fundraising, protects scholarships, and keeps travel predictable.</p>
                <div class="inline-actions" style="margin-top:.75rem;">
                  <button class="btn btn-secondary btn-sm" type="button" data-open-memberships="true">View plans</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-ff-share-open>Share memberships</button>
                </div>
              </article>
            </aside>
          </div>

          <article class="card pad lift ff-glint" style="margin-top:var(--s-4);" aria-label="Membership plans">
            <div class="card-head">
              <div class="card-head__copy">
                <div class="kicker">Plans</div>
                <h3 class="card-title">Choose a plan</h3>
                <p class="help measure">Selecting a plan prefills checkout and sets frequency automatically.</p>
              </div>
              <div class="card-head__actions">
                <div class="segmented" role="group" aria-label="Membership billing" id="membershipBilling">
                  <button type="button" data-membership-billing="monthly" aria-pressed="true">Monthly</button>
                  <button type="button" data-membership-billing="annual" aria-pressed="false">Annual</button>
                </div>
              </div>
            </div>

            <div class="divider" aria-hidden="true"></div>

            <div id="membershipGrid" class="grid grid-3" role="list" aria-label="Membership cards">
              <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
              <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
              <div class="skeleton" aria-hidden="true" style="height:220px;"></div>
            </div>

            <div class="divider" aria-hidden="true"></div>

            <div class="inline-actions">
              <a class="btn btn-primary" href="#donate">Checkout now</a>
              <button class="btn btn-secondary" type="button" data-open-trust="true">Receipts & policies</button>
            </div>
          </article>
        </div>
      </section>

      <!-- Donate -->
      <section id="donate" class="section" aria-labelledby="donateTitle">
        <div class="container-wide">
          <div class="grid grid-2" style="gap:var(--s-4); align-items:start;">
            <header class="card pad lift ff-glint" aria-label="Donate overview">
              <div class="kicker">Donate</div>
              <h2 id="donateTitle" style="margin:.35rem 0 0; font-size:var(--t-xl); letter-spacing:-.03em;">Make a secure gift in under a minute.</h2>
              <p class="measure">Choose an amount, optionally tag a team, and complete checkout on-page. Stripe supports card + Apple Pay/Google Pay when available.</p>

              <div class="cluster" style="margin-top:var(--s-3);" aria-label="Donation helper pills">
                <span class="pill pill-muted">Secure</span>
                <span class="pill pill-muted">Instant receipt</span>
                <span class="pill pill-muted">No login</span>
                <span class="pill pill-accent" id="donatePrefillPill" hidden>Prefilled</span>
              </div>

              <div class="divider" aria-hidden="true"></div>

              <details class="faq">
                <summary>What happens after I donate?</summary>
                <p class="help">You’ll see a confirmation and get an email receipt instantly. If you opt in, you’ll also receive occasional program updates.</p>
              </details>
              <details class="faq">
                <summary>Can businesses sponsor and get recognition?</summary>
                <p class="help">Yes. Sponsor tiers add VIP leaderboard recognition automatically, and the sponsor kit gives a ready-to-send message.</p>
              </details>
              <details class="faq">
                <summary>Can I make this monthly?</summary>
                <p class="help">If monthly is enabled, you can switch to recurring and keep supporting all season.</p>
              </details>
            </header>

            <aside aria-label="Donate helper card">
              <article class="mini mini--callout lift ff-glint" aria-label="Donate note">
                <div class="kicker">Fastest path</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">Tap a quick amount</h3>
                <p class="help">Quick amounts prefill checkout. Add a note if you’d like, then confirm securely.</p>
                <div class="inline-actions" style="margin-top:.75rem;">
                  <button class="btn btn-secondary btn-sm" type="button" data-quick-amount="75">Donate $75</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-ff-copy-link>Copy link</button>
                </div>
              </article>

              <article class="card pad lift ff-glint" aria-label="Trust snapshot" style="margin-top:var(--s-4);">
                <div class="kicker">Trust snapshot</div>
                <div class="help" style="margin-top:.35rem;">
                  Payments are encrypted and processed by Stripe. Card details never touch our servers.
                </div>
                <div class="inline-actions" style="margin-top:.75rem;">
                  <button class="btn btn-secondary btn-sm" type="button" data-open-trust="true">Open trust center</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-ff-share-open>Share</button>
                </div>
              </article>
            </aside>
          </div>

          <div class="grid grid-2" style="gap:var(--s-4); align-items:start; margin-top:var(--s-4);">
            <article class="card pad lift ff-glint" aria-label="Donation form">
              <div class="card-head">
                <div class="card-head__copy">
                  <div class="kicker">Your gift</div>
                  <h3 class="card-title">Select amount</h3>
                  <p class="help measure">Amounts can be edited. Checkout happens securely on this page.</p>
                </div>
              </div>

              <form id="donationForm" autocomplete="on" novalidate>
                <input type="hidden" id="frequencyHidden" name="frequency" value="once" />
                <input type="hidden" id="purposeHidden" name="purpose" value="donation" />
                <input type="hidden" id="membershipPlanHidden" name="membershipPlan" value="" />
                <input type="hidden" id="ffTotalHidden" name="ff_total" value="" />
                <input type="hidden" id="ffIdemHidden" name="ff_idem" value="" />
                <input type="hidden" id="selectedTeamId" name="teamId" value="" />
                <input type="hidden" id="selectedTierId" name="tierId" value="" />
                <input type="hidden" id="refCodeInput" name="ref" value="" />

                <div class="field">
                  <label for="amountInput">Amount</label>
                  <div class="input-row">
                    <span class="input-prefix" aria-hidden="true">$</span>
                    <input id="amountInput" name="amount" type="number" inputmode="decimal" min="1" step="1" placeholder="75" />
                  </div>
                  <div class="help" id="amountHint">Tip: Sponsors often choose $250 / $500 / $1,000.</div>
                </div>

                <div class="chip-row" role="group" aria-label="Quick donation amounts" style="margin-top:.75rem;">
                  <button class="chip" type="button" data-quick-amount="25" aria-pressed="false">$25</button>
                  <button class="chip" type="button" data-quick-amount="75" aria-pressed="false">$75</button>
                  <button class="chip" type="button" data-quick-amount="150" aria-pressed="false">$150</button>
                  <button class="chip" type="button" data-quick-amount="250" aria-pressed="false">$250</button>
                  <button class="chip" type="button" data-quick-amount="500" aria-pressed="false">$500</button>
                  <button class="chip" type="button" data-quick-amount="1000" aria-pressed="false">$1,000</button>
                </div>

                <div class="divider" aria-hidden="true"></div>

                <div class="field">
                  <label for="teamSelect">Team tag <span class="help">(optional)</span></label>
                  <select id="teamSelect" aria-label="Select a team to tag your gift">
                    <option value="all">All teams • Support the full program</option>
                  </select>
                  <div class="help">Optional: helps recognition and reporting.</div>
                </div>

                <div class="divider" aria-hidden="true"></div>

                <div class="cluster cluster-between" aria-label="Gift frequency" id="donateFrequencyRow">
                  <div>
                    <div class="kicker">Frequency</div>
                    <div class="help">One-time or monthly (if enabled).</div>
                  </div>
                  <div class="segmented" role="group" aria-label="Donation frequency selector" data-ff-frequency>
                    <button type="button" data-frequency="once" aria-pressed="true">Once</button>
                    <button type="button" data-frequency="monthly" aria-pressed="false">Monthly</button>
                  </div>
                </div>

                <div class="divider" aria-hidden="true"></div>

                <div class="cluster" aria-label="Optional add-ons" id="addonsRow">
                  <label class="check"><input id="roundUp" type="checkbox" /><span>Round up to the next $5</span></label>
                  <label class="check"><input id="coverFees" type="checkbox" /><span>Help cover processing fees</span></label>
                </div>

                <div class="divider" aria-hidden="true"></div>

                <div class="grid grid-2" style="gap:var(--s-3);">
                  <div class="field">
                    <label for="nameInput">Name <span class="help">(optional)</span></label>
                    <input id="nameInput" name="name" type="text" autocomplete="name" placeholder="Your name" />
                  </div>
                  <div class="field">
                    <label for="emailInput">Email <span class="help">(receipt)</span></label>
                    <input id="emailInput" name="email" type="email" autocomplete="email" placeholder="you@email.com" inputmode="email" required />
                    <div class="help">Receipt is delivered instantly after payment.</div>
                  </div>
                </div>

                <div class="field" style="margin-top:var(--s-3);">
                  <label for="noteInput">Message <span class="help">(optional)</span></label>
                  <textarea id="noteInput" name="message" rows="3" placeholder="Short note to the team…"></textarea>
                </div>

                <div class="cluster" style="margin-top:var(--s-3);" aria-label="Privacy options">
                  <label class="check"><input id="donorAnonymous" type="checkbox" name="anonymous" value="1" /><span>Donate anonymously</span></label>
                  <label class="check"><input id="updatesOptIn" type="checkbox" /><span>Send me fundraiser updates</span></label>
                </div>

                <div class="divider" aria-hidden="true"></div>

                <div class="inline-actions" role="group" aria-label="Checkout actions">
                  <button class="btn btn-primary" type="submit" id="submitBtn" aria-label="Continue to secure checkout">Continue to secure checkout</button>
                  <button class="btn btn-ghost" type="button" data-ff-share-open>Share</button>
                  <button class="btn btn-ghost" type="button" data-open-trust="true">Trust</button>
                </div>

                <p class="help" style="margin-top:.7rem;">By donating, you agree to receive a receipt email. Optional updates can be toggled above.</p>

                <div class="notice" id="formError" style="display:none; margin-top:var(--s-3);" aria-live="polite" aria-atomic="true"></div>
              </form>
            </article>

            <aside class="stack stack-md" aria-label="Donation summary">
              <article class="card pad lift ff-glint" aria-label="Summary">
                <div class="kicker">Summary</div>
                <h3 style="margin-top:.35rem;">Your impact</h3>

                <div class="mini mini--soft" style="margin-top:var(--s-3);">
                  <div class="cluster cluster-between"><span class="help">Type</span><strong class="num" id="summaryPurpose">Donation</strong></div>
                  <div class="cluster cluster-between" style="margin-top:.4rem;"><span class="help">Amount</span><strong class="num" id="summaryAmount">$0</strong></div>
                  <div class="cluster cluster-between" style="margin-top:.4rem;"><span class="help">Frequency</span><strong class="num" id="summaryFreq">Once</strong></div>
                  <div class="cluster cluster-between" style="margin-top:.4rem;"><span class="help">Team tag</span><strong class="num" id="summaryTeam">All teams</strong></div>

                  <div class="divider" aria-hidden="true"></div>

                  <div class="cluster cluster-between"><span class="help">Estimated total</span><strong class="num" id="summaryTotal">$0</strong></div>
                  <div class="help" id="summaryAddOns" style="margin-top:.35rem;"></div>
                  <div class="help" id="summaryImpactHint" style="margin-top:.55rem;"></div>
                </div>

                <div class="help" style="margin-top:var(--s-3);">Checkout is encrypted and processed securely. Card details never touch our servers.</div>

                <div class="inline-actions" style="margin-top:var(--s-3);" aria-label="Summary actions">
                  <button class="btn btn-secondary btn-sm" type="button" data-ff-copy-link>Copy link</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-ff-share-open>Share</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-open-command="true">Quick actions</button>
                  <button class="btn btn-ghost btn-sm" type="button" data-open-trust="true">Trust center</button>
                </div>
              </article>

              <article class="card pad lift ff-glint" aria-label="Donation FAQ">
                <div class="kicker">FAQ</div>
                <details class="faq" open>
                  <summary>Will I get a receipt?</summary>
                  <p class="help">Yes—receipts are emailed instantly after payment.</p>
                </details>
                <details class="faq">
                  <summary>Can I donate anonymously?</summary>
                  <p class="help">Yes—toggle “Donate anonymously” in the form.</p>
                </details>
                <details class="faq">
                  <summary>Is this secure?</summary>
                  <p class="help">Yes—payments are encrypted and processed by Stripe.</p>
                </details>
                <details class="faq">
                  <summary>Where does my donation go?</summary>
                  <p class="help">Funds support the program’s season costs (travel, gym time, gear). Allocation bars are shown in the Impact section.</p>
                </details>
              </article>

              <article class="mini mini--spotlight lift ff-glint" aria-label="Powered by FutureFunded">
                <div class="kicker">FutureFunded</div>
                <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;">Turnkey fundraising pages</h3>
                <p class="help">Custom branding, sponsor leaderboards, memberships, and instant receipts—built for teams and nonprofits.</p>
              </article>
            </aside>
          </div>
        </div>
      </section>

      <!-- Modals -->
      <div class="modal" id="checkoutModal" data-open="false" role="dialog" aria-modal="true" aria-hidden="true" hidden>
        <button class="modal-backdrop" type="button" aria-label="Close secure checkout" data-modal-close="checkoutModal"></button>
        <div class="modal-panel" role="document" tabindex="-1">
          <div class="modal-body stack stack-md">
            <div class="cluster cluster-between" style="align-items:flex-start;">
              <div class="stack stack-xs">
                <p class="kicker">Secure checkout</p>
                <h3 class="modal-title">Complete your payment</h3>
                <p class="help measure">Encrypted and processed securely by Stripe. You’ll stay on this page.</p>
              </div>
              <button class="icon-btn" type="button" aria-label="Close secure checkout" title="Close" data-modal-close="checkoutModal">✕</button>
            </div>

            <div id="checkoutModalError" class="alert" role="alert" style="display:none;"></div>

            <div id="checkoutLoading" class="mini" role="status" aria-live="polite" aria-atomic="true" style="display:none;">
              <strong>Loading secure payment form…</strong><br /><span class="help">This usually takes a moment.</span>
            </div>

            <div class="payment-element-wrap" aria-label="Secure payment form">
              <div id="paymentElement"></div>
              <div class="payment-subtle">Apple Pay / Google Pay appear automatically when supported.</div>
            </div>

            <div class="inline-actions" aria-label="Checkout actions">
              <button class="btn btn-primary" id="payNowBtn" type="button" disabled aria-disabled="true">Pay now</button>
              <button class="btn btn-secondary" type="button" data-modal-close="checkoutModal">Cancel</button>
              <button class="btn btn-ghost" type="button" data-open-trust="true">Security</button>
            </div>

            <p class="help">Receipts are emailed after successful payment. <strong>Card details never touch our servers.</strong></p>
          </div>
        </div>
      </div>

      <div class="modal" id="successModal" data-open="false" role="dialog" aria-modal="true" aria-hidden="true" hidden>
        <button class="modal-backdrop" type="button" aria-label="Close success" data-modal-close="successModal"></button>
        <div class="modal-panel modal-panel--narrow" role="document" tabindex="-1">
          <div class="modal-body stack stack-md">
            <div class="cluster cluster-between" style="align-items:flex-start;">
              <div class="stack stack-xs">
                <p class="kicker">Success</p>
                <h3 class="modal-title">Payment complete</h3>
                <p class="help">Receipt sent to <span class="num" id="successEmail">—</span></p>
              </div>
              <button class="icon-btn" type="button" aria-label="Close success modal" data-modal-close="successModal">✕</button>
            </div>

            <div class="notice stack stack-sm">
              <div>Type: <span class="num" id="successPurpose">—</span></div>
              <div>Amount: <span class="num" id="successAmount">—</span></div>
              <div>Frequency: <span class="num" id="successFrequency">—</span></div>
              <div>Team: <span class="num" id="successTeam">—</span></div>
            </div>

            <div class="inline-actions">
              <button class="btn btn-secondary" type="button" data-ff-share-open>Share</button>
              <button class="btn btn-ghost" type="button" data-ff-copy-link>Copy link</button>
              <button class="btn btn-primary" type="button" data-modal-close="successModal">Done</button>
            </div>

            <div class="ff-fineprint">Thank you. Your support directly helps kids stay in the program.</div>
          </div>
        </div>
      </div>

      <div class="modal" id="sponsorKitModal" data-open="false" role="dialog" aria-modal="true" hidden aria-labelledby="sponsorKitTitle" aria-describedby="sponsorKitDesc">
        <button class="modal-backdrop" type="button" aria-label="Close sponsor kit" data-modal-close="sponsorKitModal"></button>
        <div class="modal-panel" role="document" tabindex="-1">
          <div class="modal-body stack stack-md">
            <div class="cluster cluster-between" style="align-items:flex-start;">
              <div class="stack stack-xs">
                <p class="kicker">Sponsor kit</p>
                <h3 class="modal-title" id="sponsorKitTitle">Everything a sponsor needs</h3>
                <p class="help measure" id="sponsorKitDesc">Copy the link, then share the ready-to-post message with local businesses.</p>
              </div>
              <button class="icon-btn" type="button" aria-label="Close sponsor kit" data-modal-close="sponsorKitModal">✕</button>
            </div>

            <div class="card pad">
              <div class="kicker">Fundraiser link</div>
              <label class="sr-only" for="sponsorKitLink">Fundraiser link</label>
              <div class="inline-actions" style="margin-top:.6rem;">
                <input class="input" id="sponsorKitLink" type="text" inputmode="url" readonly spellcheck="false" value="" />
                <button class="btn btn-secondary btn-sm" type="button" id="sponsorKitCopyLink">Copy link</button>
              </div>
              <p class="help" style="margin-top:.6rem;">Tip: Send this to business owners with the message below.</p>
            </div>

            <div class="card pad">
              <div class="kicker">Ready-to-post message</div>
              <label class="sr-only" for="sponsorKitCaption">Sponsor message</label>
              <textarea class="input" id="sponsorKitCaption" rows="6" readonly spellcheck="false"></textarea>
              <div class="inline-actions" style="margin-top:.65rem;">
                <button class="btn btn-secondary btn-sm" type="button" id="sponsorKitCopyCaption">Copy message</button>
                <button class="btn btn-ghost btn-sm" type="button" data-ff-share-open>Open share</button>
              </div>
              <div class="ff-fineprint" style="margin-top:.6rem;">Optional: add your ref code to track attribution automatically.</div>
            </div>

            <div class="inline-actions">
              <button class="btn btn-ghost" type="button" data-ff-copy-link>Copy fundraiser link</button>
              <button class="btn btn-secondary" type="button" data-modal-close="sponsorKitModal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal" id="shareModal" data-open="false" role="dialog" aria-modal="true" hidden aria-labelledby="shareTitle" aria-describedby="shareDesc">
        <button class="modal-backdrop" type="button" aria-label="Close share dialog" data-modal-close="shareModal"></button>
        <div class="modal-panel modal-panel--narrow" role="document" tabindex="-1">
          <div class="modal-body stack stack-md">
            <div class="cluster cluster-between" style="align-items:flex-start;">
              <div class="stack stack-xs">
                <p class="kicker">Share</p>
                <h3 class="modal-title" id="shareTitle">Spread the word</h3>
                <p class="help measure" id="shareDesc">Copy the link or share a short message to boost the next milestone.</p>
              </div>
              <button class="icon-btn" type="button" aria-label="Close share" data-modal-close="shareModal">✕</button>
            </div>

            <section class="card pad" aria-label="Share actions">
              <div class="field">
                <label for="shareVariant">Message style</label>
                <select id="shareVariant">
                  <option value="standard">Standard</option>
                  <option value="urgent">Urgent</option>
                  <option value="sponsor">Sponsor outreach</option>
                  <option value="membership">Membership invite</option>
                </select>
                <div class="help">Choose a tone, then share.</div>
              </div>

              <div class="divider" aria-hidden="true"></div>

              <div class="inline-actions" style="gap:.6rem;">
                <button class="btn btn-secondary btn-sm" type="button" id="shareCopyBtn">Copy link</button>
                <button class="btn btn-ghost btn-sm" type="button" id="shareNativeBtn">Share</button>
                <a class="btn btn-ghost btn-sm" id="shareX" href="#" target="_blank" rel="noopener">Post to X</a>
                <a class="btn btn-ghost btn-sm" id="shareFb" href="#" target="_blank" rel="noopener">Post to Facebook</a>
                <a class="btn btn-ghost btn-sm" id="shareEmail" href="#" target="_blank" rel="noopener">Share by email</a>
              </div>

              <div class="notice" style="margin-top:var(--s-3);">
                <div class="kicker">Message preview</div>
                <p class="help" id="sharePreviewText" style="margin-top:.35rem;"></p>
              </div>

              <div class="mini mini--soft" style="margin-top:var(--s-3);">
                <div class="kicker">Pro share</div>
                <p class="help" style="margin:.45rem 0 0;">Best conversion: 1 sentence + ask + link. Post as a story and pin it for 24 hours.</p>
              </div>
            </section>
          </div>
        </div>
      </div>

      <div class="modal" id="trustModal" data-open="false" role="dialog" aria-modal="true" hidden aria-labelledby="trustTitle" aria-describedby="trustDesc">
        <button class="modal-backdrop" type="button" aria-label="Close trust center" data-modal-close="trustModal"></button>
        <div class="modal-panel" role="document" tabindex="-1">
          <div class="modal-body stack stack-md">
            <div class="cluster cluster-between" style="align-items:flex-start;">
              <div class="stack stack-xs">
                <p class="kicker">Trust center</p>
                <h3 class="modal-title" id="trustTitle">Security, receipts, privacy</h3>
                <p class="help measure" id="trustDesc">Enterprise-grade payments with clear policies. Designed for families and sponsors.</p>
              </div>
              <button class="icon-btn" type="button" aria-label="Close trust center" data-modal-close="trustModal">✕</button>
            </div>

            <div class="grid grid-2" style="gap:var(--s-3);">
              <div class="mini mini--soft">
                <div class="kicker">Payments</div>
                <p class="help" style="margin:.45rem 0 0;"><strong>Stripe</strong> handles encrypted checkout. Card details never touch our servers.</p>
                <ul class="help" style="margin:.6rem 0 0; padding-left:1.1rem;">
                  <li>Apple Pay / Google Pay supported when available</li>
                  <li>3D Secure handled by Stripe</li>
                  <li>Idempotent checkout requests (prevents double-charges)</li>
                </ul>
              </div>
              <div class="mini mini--soft">
                <div class="kicker">Receipts</div>
                <p class="help" style="margin:.45rem 0 0;">Receipts are emailed immediately after successful payment.</p>
                <ul class="help" style="margin:.6rem 0 0; padding-left:1.1rem;">
                  <li>Includes amount, date, and reference</li>
                  <li>Supports sponsor recordkeeping</li>
                  <li>Optional updates are opt-in only</li>
                </ul>
              </div>
              <div class="mini mini--soft">
                <div class="kicker">Privacy</div>
                <p class="help" style="margin:.45rem 0 0;">Donor info is used for receipts and optional updates—never sold.</p>
                <ul class="help" style="margin:.6rem 0 0; padding-left:1.1rem;">
                  <li>Anonymous toggle supported</li>
                  <li>Minimal data collection by default</li>
                  <li>Strict-origin referrer policy</li>
                </ul>
              </div>
              <div class="mini mini--soft">
                <div class="kicker">Policies</div>
                <p class="help" style="margin:.45rem 0 0;">Terms and privacy are available below. Refund handling follows organizational policy.</p>
                <div class="inline-actions" style="margin-top:.75rem;">
                  <a class="btn btn-secondary btn-sm" href="/terms" rel="nofollow">Terms</a>
                  <a class="btn btn-secondary btn-sm" href="/privacy" rel="nofollow">Privacy</a>
                </div>
              </div>
            </div>

            <div class="inline-actions">
              <button class="btn btn-primary" type="button" data-modal-close="trustModal">Done</button>
              <button class="btn btn-ghost" type="button" data-ff-copy-link>Copy link</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal" id="membershipsModal" data-open="false" role="dialog" aria-modal="true" hidden aria-labelledby="membershipsModalTitle">
        <button class="modal-backdrop" type="button" aria-label="Close memberships" data-modal-close="membershipsModal"></button>
        <div class="modal-panel" role="document" tabindex="-1">
          <div class="modal-body stack stack-md">
            <div class="cluster cluster-between" style="align-items:flex-start;">
              <div class="stack stack-xs">
                <p class="kicker">Memberships</p>
                <h3 class="modal-title" id="membershipsModalTitle">Pick a plan</h3>
                <p class="help measure">Choose a plan to prefill checkout and activate VIP recognition if configured.</p>
              </div>
              <button class="icon-btn" type="button" aria-label="Close memberships" data-modal-close="membershipsModal">✕</button>
            </div>

            <div class="card pad">
              <div class="cluster cluster-between">
                <div>
                  <div class="kicker">Billing</div>
                  <div class="help">Switch monthly / annual.</div>
                </div>
                <div class="segmented" role="group" aria-label="Membership billing" id="membershipsModalBilling">
                  <button type="button" data-membership-billing="monthly" aria-pressed="true">Monthly</button>
                  <button type="button" data-membership-billing="annual" aria-pressed="false">Annual</button>
                </div>
              </div>
            </div>

            <div id="membershipsModalGrid" class="grid grid-3" role="list" aria-label="Membership options">
              <div class="skeleton" aria-hidden="true" style="height:200px;"></div>
              <div class="skeleton" aria-hidden="true" style="height:200px;"></div>
              <div class="skeleton" aria-hidden="true" style="height:200px;"></div>
            </div>

            <div class="inline-actions">
              <a class="btn btn-primary" href="#donate" data-modal-close="membershipsModal">Go to checkout</a>
              <button class="btn btn-secondary" type="button" data-modal-close="membershipsModal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal" id="commandModal" data-open="false" role="dialog" aria-modal="true" hidden aria-labelledby="commandTitle">
        <button class="modal-backdrop" type="button" aria-label="Close quick actions" data-modal-close="commandModal"></button>
        <div class="modal-panel modal-panel--narrow" role="document" tabindex="-1">
          <div class="modal-body stack stack-md">
            <div class="cluster cluster-between" style="align-items:flex-start;">
              <div class="stack stack-xs">
                <p class="kicker">Quick actions</p>
                <h3 class="modal-title" id="commandTitle">Search actions</h3>
                <p class="help measure">Type to filter. Press Enter to run. Esc to close.</p>
              </div>
              <button class="icon-btn" type="button" aria-label="Close quick actions" data-modal-close="commandModal">✕</button>
            </div>

            <div class="card pad">
              <div class="field" style="margin:0;">
                <label for="commandSearch">Search</label>
                <input id="commandSearch" class="input" type="search" placeholder="Donate, Copy link, Sponsor kit…" autocomplete="off" />
              </div>
            </div>

            <div class="card pad">
              <div id="commandList" class="stack stack-sm" role="listbox" aria-label="Quick actions list"></div>
            </div>

            <div class="ff-fineprint">Shortcut: <kbd>Ctrl</kbd> <kbd>K</kbd> / <kbd>⌘</kbd> <kbd>K</kbd></div>
          </div>
        </div>
      </div>
    </main>

    <!-- Toasts -->
    <div class="toast-region" id="toastRegion" role="status" aria-live="polite" aria-atomic="true"></div>

    <!-- Sticky donate -->
    <div class="sticky-donate" id="stickyDonate" role="region" aria-label="Quick donate bar" hidden data-show="false">
      <div class="sticky-donate__inner">
        <div class="sticky-mini">
          <div class="sticky-top">
            <strong class="sticky-org" id="stickyOrg">Organization</strong>
            <span class="dot" aria-hidden="true">•</span>
            <span class="num" id="stickyRaised">$0</span>
            <span class="help">raised</span>
          </div>
          <div class="sticky-bot">
            <span class="num" id="stickyPct">0%</span> of <span class="num" id="stickyGoal">$0</span>
          </div>
        </div>
        <div class="sticky-actions">
          <a class="btn btn-primary btn-sm" href="#donate" aria-label="Jump to donate from sticky bar">Donate</a>
          <a class="btn btn-ghost btn-sm" href="#sponsors" aria-label="Jump to sponsors from sticky bar">Sponsors</a>
          <a class="btn btn-ghost btn-sm" href="#memberships" aria-label="Jump to memberships from sticky bar">Memberships</a>
        </div>
      </div>
    </div>

    <!-- Mobile tabs -->
    <nav class="ff-mobile-tabs" aria-label="Quick links">
      <a class="ff-mobile-tab" href="#donate">Donate</a>
      <a class="ff-mobile-tab" href="#sponsors">Sponsors</a>
      <a class="ff-mobile-tab" href="#memberships">Memberships</a>
    </nav>

    <!-- FX / utilities -->
    <div id="ffConfetti" class="ff-confetti" aria-hidden="true" hidden></div>
    <button id="backToTop" class="back-to-top" type="button" aria-label="Back to top" title="Back to top" hidden>↑</button>

    <!-- Footer -->
    <footer class="site-footer" role="contentinfo">
      <div class="container-wide">
        <div class="site-footer__top">
          <section aria-label="Fundraiser brand and contact">
            <div class="brand cluster" style="gap:.75rem;">
              <span class="brand-mark" aria-hidden="true">
                <img class="brand-logo" id="footerBrandLogo" alt="" width="46" height="46" hidden />
              </span>
              <div>
                <div class="brand-title" id="footerOrgName">FutureFunded</div>
                <div class="brand-sub" id="footerTagline">Fund the season. Build the future.</div>
              </div>
            </div>

            <div class="cluster" style="margin-top:12px;" aria-label="Trust signals">
              <span class="pill">Verified</span>
              <span class="pill">Secure checkout</span>
              <span class="pill">Instant receipts</span>
              <button class="btn btn-ghost btn-sm" type="button" data-open-trust="true">Trust center</button>
            </div>

            <div style="margin-top:12px;">
              <span class="help">Support: <a href="mailto:support@getfuturefunded.com" id="supportEmailLink">support@getfuturefunded.com</a></span>
            </div>
          </section>

          <nav aria-label="Footer navigation">
            <ul class="footer-links">
              <li><a href="#progress">Progress</a></li>
              <li><a href="#impact">Impact</a></li>
              <li><a href="#updates">Updates</a></li>
              <li><a href="#teams">Teams</a></li>
              <li><a href="#sponsors">Sponsors</a></li>
              <li><a href="#memberships">Memberships</a></li>
              <li><a href="#donate">Donate</a></li>
            </ul>
          </nav>

          <section aria-label="Footer calls to action">
            <div class="chip-row">
              <a class="btn btn-primary btn-sm" href="#donate">Donate now</a>
              <a class="btn btn-secondary btn-sm" href="#sponsors">Sponsor a tier</a>
              <a class="btn btn-secondary btn-sm" href="#memberships">Join memberships</a>
            </div>

            <div class="mini mini--soft" style="margin-top:14px;">
              <ul class="help" style="margin:0; padding-left:1.1rem;">
                <li>Card details never touch our servers.</li>
                <li>Receipts are emailed instantly after payment.</li>
              </ul>
              <div class="inline-actions" style="margin-top:.75rem;">
                <button class="btn btn-secondary btn-sm" type="button" data-ff-share-open>Share</button>
                <button class="btn btn-ghost btn-sm" type="button" data-ff-copy-link>Copy link</button>
                <button class="btn btn-ghost btn-sm" type="button" data-open-command="true">Quick actions</button>
                <button class="btn btn-ghost btn-sm" type="button" data-open-trust="true">Trust</button>
              </div>
            </div>
          </section>
        </div>

        <div class="site-footer__legal">
          <div class="footer-legal-row">
            <p>&copy; <span id="footerYear"></span> FutureFunded</p>
            <div class="cluster">
              <a class="footer-legal" href="/terms" rel="nofollow">Terms</a>
              <a class="footer-legal" href="/privacy" rel="nofollow">Privacy</a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Optional templates (safe if unused) -->
    <template id="tplGift">
      <div class="gift" role="listitem">
        <div class="gift-left">
          <div class="avatar" aria-hidden="true"></div>
        </div>
        <div class="gift-mid" style="min-width:0;">
          <div class="gift-name"></div>
          <div class="gift-meta help"></div>
        </div>
        <div class="gift-right num"></div>
      </div>
    </template>

    <template id="tplLeader">
      <div class="leader" role="listitem">
        <div class="leader-left">
          <div class="avatar" aria-hidden="true"></div>
        </div>
        <div class="leader-mid" style="min-width:0;">
          <div class="leader-name"></div>
          <div class="leader-meta help"></div>
        </div>
        <div class="leader-right num"></div>
      </div>
    </template>

    <template id="tplUpdate">
      <article class="update" role="article">
        <div class="update-head cluster cluster-between" style="align-items:flex-start;">
          <div>
            <div class="kicker update-kicker"></div>
            <h4 class="update-title" style="margin:.35rem 0 0;"></h4>
            <div class="help update-meta" style="margin-top:.35rem;"></div>
          </div>
          <span class="pill pill-muted update-tag" hidden></span>
        </div>
        <p class="help update-body" style="margin-top:.65rem;"></p>
      </article>
    </template>

    <template id="tplCard">
      <article class="mini mini--soft" role="listitem">
        <div class="kicker"></div>
        <h3 style="margin:.35rem 0 0; font-size:var(--t-md); font-weight:950; letter-spacing:-.02em;"></h3>
        <p class="help" style="margin-top:.45rem;"></p>
        <div class="inline-actions" style="margin-top:.75rem;"></div>
      </article>
    </template>
  </div>

<script>
(() => {
  "use strict";

  // Prevent double-init
  if (window.__ff_flagship_v4_initialized) return;
  window.__ff_flagship_v4_initialized = true;

  /* =========================
    DOM + safety utilities
  ========================= */

  const qs = (sel, root = document) => {
    try { return root && root.querySelector ? root.querySelector(sel) : null; } catch { return null; }
  };
  const qsa = (sel, root = document) => {
    try { return root && root.querySelectorAll ? Array.from(root.querySelectorAll(sel)) : []; } catch { return []; }
  };
  const byId = (id) => {
    try { return document.getElementById(id); } catch { return null; }
  };

  const safeText = (el, text) => { if (el) el.textContent = String(text ?? ""); };
  const safeHtml = (el, html) => { if (el) el.innerHTML = String(html ?? ""); };
  const safeValue = (el, val) => { if (el) el.value = String(val ?? ""); };
  const safeAttr = (el, name, val) => { if (!el) return; try { el.setAttribute(name, String(val)); } catch {} };
  const safeRemoveAttr = (el, name) => { if (!el) return; try { el.removeAttribute(name); } catch {} };
  const safeStyle = (el, prop, val) => { if (!el || !el.style) return; try { el.style[prop] = String(val); } catch {} };

  const isPlainObject = (v) =>
    !!v && typeof v === "object" && Object.prototype.toString.call(v) === "[object Object]";

  const safeClone = (obj) => {
    try { return structuredClone(obj); } catch {}
    try { return JSON.parse(JSON.stringify(obj)); } catch { return null; }
  };

  const deepMerge = (target, ...sources) => {
    for (const src of sources) {
      if (!isPlainObject(src)) continue;
      for (const [k, v] of Object.entries(src)) {
        if (isPlainObject(v) && isPlainObject(target[k])) target[k] = deepMerge(target[k], v);
        else target[k] = v;
      }
    }
    return target;
  };

  const debounce = (fn, wait = 180) => {
    let t = null;
    return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), wait); };
  };

  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

  const cssEscape = (v) => {
    const s = String(v ?? "");
    if (window.CSS && typeof window.CSS.escape === "function") return window.CSS.escape(s);
    // minimal escape fallback: quotes + backslash
    return s.replace(/\\/g, "\\\\").replace(/"/g, '\\"');
  };

  const meta = (name) =>
    qs(`meta[name="${cssEscape(name)}"]`)?.getAttribute("content") || "";

  const getCsrfToken = () => meta("csrf-token") || meta("csrf") || meta("x-csrf-token") || "";
  const getCheckoutEndpoint = () => meta("ff-checkout-endpoint") || "/payments/stripe/intent";
  const getStatusEndpoint = () => meta("ff-status-endpoint") || "/api/status";
  const getEventsEndpoint = () => meta("ff-events-endpoint") || "/api/events";
  const getTrackEndpoint = () => meta("ff-track-endpoint") || "/api/track";
  const getStripePk = () => meta("ff-stripe-pk") || meta("stripe-pk") || "";
  const getQrEndpoint = () => meta("ff-qr-endpoint") || "";

  const getTeamsEndpoint = () => meta("ff-teams-endpoint") || "";

  const nonEmptyArray = (v) => Array.isArray(v) && v.length > 0;


  const isEmail = (v) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(v || "").trim());

  const escapeHtml = (s) =>
    String(s ?? "")
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#39;");

  const uuid = () => {
    try {
      if (window.crypto?.randomUUID) return crypto.randomUUID();
    } catch {}
    return `ff_${Date.now().toString(16)}_${Math.random().toString(16).slice(2)}`;
  };

  const nowIso = () => new Date().toISOString();

  const boundKeys = new WeakMap(); // el -> Set(keys)
  const on = (el, type, handler, options, key) => {
    if (!el || !el.addEventListener) return;
    const k = key || `${type}:${handler?.name || "anon"}`;
    let set = boundKeys.get(el);
    if (!set) { set = new Set(); boundKeys.set(el, set); }
    if (set.has(k)) return;
    el.addEventListener(type, handler, options);
    set.add(k);
  };

  /* =========================
    Network helpers + tracking
  ========================= */

  async function fetchJson(url, { method = "GET", payload, headers = {}, timeoutMs = 15000 } = {}) {
    if (!url) throw new Error("Missing URL.");
    const ctrl = new AbortController();
    const t = setTimeout(() => ctrl.abort(), timeoutMs);

    try {
      const res = await fetch(url, {
        method,
        credentials: "same-origin",
        headers: {
          Accept: "application/json",
          ...(payload ? { "Content-Type": "application/json" } : {}),
          ...(getCsrfToken() ? { "X-CSRF-TOKEN": getCsrfToken() } : {}),
          ...headers,
        },
        body: payload ? JSON.stringify(payload) : undefined,
        signal: ctrl.signal,
      });

      const ct = (res.headers.get("content-type") || "").toLowerCase();
      const hasJson = ct.includes("application/json");

      let data = null;
      if (hasJson) {
        try { data = await res.json(); } catch { data = null; }
      } else {
        // Accept empty/204 without throwing a JSON parsing error
        data = null;
      }

      if (!res.ok || (data && data.ok === false)) {
        const msg = data?.error?.message || data?.message || `Request failed (${res.status})`;
        throw new Error(msg);
      }

      if (!hasJson && res.ok) {
        // If caller expects JSON, treat non-JSON as error. (Keeps behavior deterministic.)
        throw new Error("Expected JSON but received non-JSON response.");
      }

      return data;
    } finally {
      clearTimeout(t);
    }
  }

  function track(event, props = {}) {
    try {
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({ event, ...props });
    } catch {}

    const endpoint = getTrackEndpoint();
    if (!endpoint) return;

    const ref = (() => {
      try { return new URL(location.href).searchParams.get("ref") || ""; } catch { return ""; }
    })();

    const payload = { event, props, at: nowIso(), path: location.pathname, ref };

    try {
      const body = JSON.stringify(payload);
      if (navigator.sendBeacon) {
        const blob = new Blob([body], { type: "application/json" });
        navigator.sendBeacon(endpoint, blob);
        return;
      }
    } catch {}

    try {
      fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json", Accept: "application/json" },
        body: JSON.stringify(payload),
        keepalive: true,
        credentials: "same-origin",
      }).catch(() => {});
    } catch {}
  }

  /* =========================
    Toasts
  ========================= */

  const toastHost = byId("toastRegion");
  function toast(title, body = "", { ttl = 2600 } = {}) {
    if (!toastHost) return;
    const el = document.createElement("div");
    el.className = "toast";
    el.innerHTML = `<strong>${escapeHtml(title)}</strong>${body ? `<p>${escapeHtml(body)}</p>` : ""}`;
    toastHost.appendChild(el);

    const fadeAt = Math.max(1200, ttl - 400);
    setTimeout(() => { safeStyle(el, "opacity", "0"); safeStyle(el, "transform", "translateY(-6px)"); }, fadeAt);
    setTimeout(() => { try { el.remove(); } catch {} }, ttl);
  }

  /* =========================
    Focus trap + scroll lock
  ========================= */

  const FOCUSABLE = [
    'a[href]',
    'button:not([disabled])',
    'input:not([disabled]):not([type="hidden"])',
    'select:not([disabled])',
    'textarea:not([disabled])',
    '[tabindex]:not([tabindex="-1"])',
  ].join(",");

  const isVisible = (el) => {
    if (!el) return false;
    let s;
    try { s = getComputedStyle(el); } catch { return false; }
    if (!s || s.display === "none" || s.visibility === "hidden") return false;
    try { return !!(el.offsetWidth || el.offsetHeight || el.getClientRects().length); } catch { return false; }
  };

  const focusables = (root) => qsa(FOCUSABLE, root).filter(isVisible);

  let scrollLockCount = 0;
  let savedPadRight = "";

  function lockScroll(lock) {
    const docEl = document.documentElement;
    const body = document.body;
    if (!docEl || !body) return;

    if (lock) {
      scrollLockCount += 1;
      if (scrollLockCount > 1) return;

      const sbw = (window.innerWidth || 0) - (docEl.clientWidth || 0);
      savedPadRight = body.style.paddingRight || "";

      docEl.style.overflow = "hidden";
      body.style.overflow = "hidden";

      if (sbw > 0) body.style.paddingRight = `${sbw}px`;
      return;
    }

    scrollLockCount = Math.max(0, scrollLockCount - 1);
    if (scrollLockCount !== 0) return;

    docEl.style.overflow = "";
    body.style.overflow = "";
    body.style.paddingRight = savedPadRight;
  }

  function trapFocus(rootEl, e) {
    if (!rootEl || !e || e.key !== "Tab") return;
    const list = focusables(rootEl);
    if (!list.length) return;

    const first = list[0];
    const last = list[list.length - 1];
    const active = document.activeElement;

    if (e.shiftKey && active === first) { e.preventDefault(); last.focus?.(); return; }
    if (!e.shiftKey && active === last) { e.preventDefault(); first.focus?.(); return; }
  }

  /* =========================
    Modals (ARIA-safe, null-safe)
  ========================= */

  const modalState = new Map(); // id -> { lastFocus }
  function isModalOpen(id) {
    const el = byId(id);
    if (!el) return false;
    return el.getAttribute("data-open") === "true" && el.hidden === false;
  }

  function openModal(id) {
    const el = byId(id);
    if (!el || isModalOpen(id)) return;

    modalState.set(id, { lastFocus: document.activeElement });

    el.hidden = false;
    safeAttr(el, "data-open", "true");
    safeAttr(el, "aria-hidden", "false");

    lockScroll(true);

    requestAnimationFrame(() => {
      const panel = qs(".modal-panel", el) || el;
      const f = focusables(panel);
      (f[0] || panel).focus?.();
    });
  }

  function closeModal(id) {
    const el = byId(id);
    if (!el || !isModalOpen(id)) return;

    safeAttr(el, "data-open", "false");
    safeAttr(el, "aria-hidden", "true");
    el.hidden = true;

    lockScroll(false);

    const st = modalState.get(id);
    modalState.delete(id);
    const target = st?.lastFocus;
    if (target?.focus) requestAnimationFrame(() => target.focus());
  }

  // Unified click delegation: no missing-node throws, handles dynamic elements
  function handleDocClick(e) {
    const t = e.target;

    const closeBtn = t?.closest?.("[data-modal-close]");
    if (closeBtn) {
      const id = closeBtn.getAttribute("data-modal-close");
      if (id) closeModal(id);
      return;
    }

    if (t?.closest?.('[data-open-trust="true"]')) { openModal("trustModal"); return; }
    if (t?.closest?.('[data-open-sponsor-kit="true"]')) { openSponsorKit(); return; }
    if (t?.closest?.('[data-open-memberships="true"]')) { openMemberships(); return; }
    if (t?.closest?.('[data-open-command="true"]')) { openCommandPalette(); return; }

    if (t?.closest?.("[data-ff-share-open]")) {
      openModal("shareModal");
      updateSharePreview();
      track("share_open", {});
      return;
    }

    if (t?.closest?.("[data-ff-copy-link]")) {
      copyLink().then(() => toast("Copied", "Link copied.")).catch(() => toast("Copy failed", "Please copy manually."));
      track("copy_link", {});
      return;
    }

    const quick = t?.closest?.("[data-quick-amount]");
    if (quick) {
      const amt = Number(quick.getAttribute("data-quick-amount") || 0);
      prefillDonation({ amount: amt, purpose: amt >= 1000 ? "sponsor" : "donation", from: "quick" });
      byId("donate")?.scrollIntoView?.({ behavior: "smooth", block: "start" });
      return;
    }

    const freqBtn = t?.closest?.("button[data-frequency]");
    if (freqBtn) {
      const freq = freqBtn.dataset.frequency || "once";
      setFrequencyUI(freq);
      track("frequency_select", { frequency: freq });
      return;
    }
  }

  on(document, "click", handleDocClick, false, "ff_doc_click");

  function handleDocKeydown(e) {
    const order = ["commandModal", "shareModal", "trustModal", "sponsorKitModal", "membershipsModal", "successModal", "checkoutModal"];
    for (const id of order) {
      if (isModalOpen(id)) {
        const panel = byId(id)?.querySelector?.(".modal-panel");
        trapFocus(panel, e);
      }
    }

    if (e.key === "Escape") {
      for (const id of order) {
        if (isModalOpen(id)) { closeModal(id); return; }
      }
    }

    const isK = String(e.key || "").toLowerCase() === "k";
    if ((e.ctrlKey || e.metaKey) && isK) {
      e.preventDefault();
      openCommandPalette();
    }
  }

  on(document, "keydown", handleDocKeydown, false, "ff_doc_keydown");

  /* =========================
    Theme
  ========================= */

  const THEME_KEY = "ff_theme_v4";

  function resolveTheme(input) {
    const t = String(input || "system");
    if (t === "dark" || t === "light") return t;
    const prefersDark = !!(window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches);
    return prefersDark ? "dark" : "light";
  }

  function applyTheme(theme) {
    const t = resolveTheme(theme);
    safeAttr(document.documentElement, "data-theme", t);

    const btn = byId("themeToggle");
    if (btn) {
      safeAttr(btn, "aria-pressed", String(t === "dark"));
      btn.textContent = t === "dark" ? "☀" : "☾";
    }
  }

  (function initTheme() {
    let theme = "system";
    try { const stored = localStorage.getItem(THEME_KEY); if (stored) theme = stored; } catch {}
    applyTheme(theme);

    const btn = byId("themeToggle");
    on(btn, "click", () => {
      const cur = document.documentElement?.getAttribute?.("data-theme") || "light";
      const next = cur === "dark" ? "light" : "dark";
      applyTheme(next);
      try { localStorage.setItem(THEME_KEY, next); } catch {}
      track("theme_toggle", { next });
    }, false, "themeToggleClick");
  })();

  /* =========================
    Topbar dismiss
  ========================= */

  const TOPBAR_KEY = "ff_topbar_dismissed_v4";

  (function initTopbarDismiss() {
    const topbar = byId("topbar");
    const btn = byId("topbarDismiss");
    if (!topbar || !btn) return;

    let dismissed = false;
    try { dismissed = localStorage.getItem(TOPBAR_KEY) === "1"; } catch {}
    if (dismissed) topbar.hidden = true;

    on(btn, "click", () => {
      topbar.hidden = true;
      try { localStorage.setItem(TOPBAR_KEY, "1"); } catch {}
    }, false, "topbarDismissClick");
  })();

  /* =========================
    Drawer (mobile menu)
  ========================= */

  (function initDrawer() {
    const drawer = byId("mobileDrawer");
    const openBtn = byId("menuOpen");
    if (!drawer || !openBtn) return;

    const panel = qs(".drawer-panel", drawer) || drawer;

    const setOpen = (open) => {
      drawer.hidden = !open;
      safeAttr(drawer, "data-open", open ? "true" : "false");
      safeAttr(drawer, "aria-hidden", open ? "false" : "true");
      safeAttr(openBtn, "aria-expanded", open ? "true" : "false");
      lockScroll(open);

      if (open) {
        requestAnimationFrame(() => {
          const f = focusables(panel);
          (f[0] || panel).focus?.();
        });
      }
    };

    on(openBtn, "click", () => setOpen(true), false, "drawerOpenClick");

    on(drawer, "click", (e) => {
      const shouldClose =
        e.target?.closest?.('[data-close="true"]') ||
        e.target?.classList?.contains?.("drawer-backdrop");
      if (shouldClose) setOpen(false);
    }, false, "drawerClick");

    on(drawer, "keydown", (e) => {
      if (drawer.hidden) return;
      trapFocus(panel, e);
      if (e.key === "Escape") setOpen(false);
    }, false, "drawerKeydown");

    // Close on internal hash link click
    qsa('a[href^="#"]', drawer).forEach((a) => {
      on(a, "click", () => setOpen(false), false, `drawerLink:${a.getAttribute("href") || ""}`);
    });
  })();

  /* =========================
    Scroll UX (header shadow, progress bar, back-to-top, sticky donate)
  ========================= */

  (function initScrollUx() {
    const header = byId("top");
    const bar = byId("scrollProgressBar");
    const back = byId("backToTop");
    const sticky = byId("stickyDonate");

    const prefersReducedMotion = !!(window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches);

    const onScroll = () => {
      const y = window.scrollY || 0;
      if (header) safeAttr(header, "data-scrolled", y > 8 ? "true" : "false");

      if (bar) {
        const h = (document.documentElement?.scrollHeight || 0) - (window.innerHeight || 0);
        const p = h > 0 ? clamp((y / h) * 100, 0, 100) : 0;
        safeStyle(bar, "width", `${p.toFixed(2)}%`);
      }

      if (back) back.hidden = y < 900;
      if (sticky) {
        sticky.hidden = y < 900;
        safeAttr(sticky, "data-show", y >= 900 ? "true" : "false");
      }
    };

    on(window, "scroll", onScroll, { passive: true }, "scrollUxScroll");
    on(window, "resize", debounce(onScroll, 120), { passive: true }, "scrollUxResize");
    onScroll();

    on(back, "click", () => {
      if (prefersReducedMotion) { window.scrollTo(0, 0); return; }
      try { window.scrollTo({ top: 0, behavior: "smooth" }); } catch { window.scrollTo(0, 0); }
    }, false, "backToTopClick");
  })();

  /* =========================
    Canonical meta helpers
  ========================= */

  const canonicalUrl = () => {
    try {
      const u = new URL(window.location.href);
      u.hash = "";
      return u.toString();
    } catch {
      return String(window.location.href || "");
    }
  };

  (function ensureCanonical() {
    const url = canonicalUrl();
    safeAttr(byId("ffCanonical"), "href", url);
    safeAttr(byId("ffOgUrl"), "content", url);
  })();

  /* =========================
    Social OG placeholder
  ========================= */

  function svgOgPlaceholderDataUri(title, subtitle) {
    const t = String(title || "Fundraiser").slice(0, 64);
    const s = String(subtitle || "FutureFunded").slice(0, 64);

    const svg =
`<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="630">
  <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#0b1020"/><stop offset="1" stop-color="#c2410c"/></linearGradient></defs>
  <rect width="1200" height="630" fill="url(#g)"/>
  <circle cx="220" cy="160" r="140" fill="rgba(249,115,22,.22)"/>
  <circle cx="980" cy="520" r="220" fill="rgba(255,255,255,.08)"/>
  <rect x="84" y="92" width="1032" height="446" rx="42" fill="rgba(255,255,255,.06)" stroke="rgba(255,255,255,.12)"/>
  <text x="120" y="230" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="68" font-weight="900" fill="#ffffff">${escapeHtml(t)}</text>
  <text x="120" y="304" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="34" font-weight="650" fill="rgba(255,255,255,.86)">${escapeHtml(s)}</text>
  <text x="120" y="400" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="26" font-weight="650" fill="rgba(255,255,255,.76)">Secure checkout • Instant receipt</text>
  <text x="120" y="444" font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" font-size="24" font-weight="650" fill="rgba(255,255,255,.70)">Powered by FutureFunded</text>
</svg>`;

    const encoded = encodeURIComponent(svg).replace(/%0A/g, "").replace(/%20/g, " ");
    return `data:image/svg+xml;charset=utf-8,${encoded}`;
  }

  function ensureSocialMeta(orgName) {
    const title = `${orgName} • Fundraiser`;
    const desc =
      qs('meta[name="description"]')?.getAttribute("content") ||
      "Donate securely in under a minute with instant email receipts and transparent impact.";

    qs('meta[property="og:title"]')?.setAttribute("content", title);
    qs('meta[property="og:description"]')?.setAttribute("content", desc);
    qs('meta[name="twitter:title"]')?.setAttribute("content", title);
    qs('meta[name="twitter:description"]')?.setAttribute("content", desc);

    const ogImg = qs('meta[property="og:image"]');
    const twImg = qs('meta[name="twitter:image"]');
    const existing = (ogImg?.getAttribute("content") || "").trim();

    if (!existing) {
      const img = svgOgPlaceholderDataUri(orgName, "FutureFunded • Secure checkout");
      ogImg?.setAttribute("content", img);
      twImg?.setAttribute("content", img);
    }
  }

  function injectJsonLd(orgName, goal, raised) {
    const el = byId("ffJsonLd");
    if (!el) return;

    const url = canonicalUrl();
    const json = {
      "@context": "https://schema.org",
      "@type": "DonateAction",
      name: `${orgName} Fundraiser`,
      target: url,
      description: qs('meta[name="description"]')?.getAttribute("content") || "",
      recipient: { "@type": "Organization", name: orgName },
      object: { "@type": "MonetaryAmount", currency: "USD", value: Number(raised) || 0 },
      additionalProperty: [
        { "@type": "PropertyValue", name: "goal", value: Number(goal) || 0 },
        { "@type": "PropertyValue", name: "raised", value: Number(raised) || 0 },
      ],
    };

    el.textContent = JSON.stringify(json);
  }

  function setCssBrand(accent) {
    const val = String(accent || "").trim();
    if (!val) return;
    try { document.documentElement?.style?.setProperty("--brand", val); } catch {}
  }

  /* =========================
    Formatting helpers
  ========================= */

  function fmtCurrency(n, currency = "USD") {
    const v = Number(n || 0);
    try {
      return new Intl.NumberFormat(undefined, {
        style: "currency",
        currency,
        maximumFractionDigits: 0,
      }).format(v);
    } catch {
      return `$${Math.round(v).toLocaleString()}`;
    }
  }

  function fmtPct(n) {
    const v = Number(n || 0);
    return `${Math.round(v)}%`;
  }

  function parseAmountInput(v) {
    const n = Number(String(v || "").replace(/[^\d.]/g, ""));
    if (!Number.isFinite(n)) return 0;
    return Math.max(0, Math.round(n));
  }

  function daysLeft(deadlineISO) {
    const d = deadlineISO ? new Date(deadlineISO) : null;
    if (!d || Number.isNaN(+d)) return null;
    const diff = d.getTime() - Date.now();
    return Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)));
  }

  function friendlyCountdown(targetISO) {
    const d = targetISO ? new Date(targetISO) : null;
    if (!d || Number.isNaN(+d)) return "—";
    const diff = d.getTime() - Date.now();
    if (diff <= 0) return "Happening now";

    const mins = Math.floor(diff / (1000 * 60));
    const hrs = Math.floor(mins / 60);
    const days = Math.floor(hrs / 24);

    if (days >= 2) return `${days} days`;
    if (days === 1) return "1 day";
    if (hrs >= 2) return `${hrs} hours`;
    if (hrs === 1) return "1 hour";
    if (mins >= 2) return `${mins} minutes`;
    return "Less than a minute";
  }

  /* =========================
    Config + State
  ========================= */

  const readJsonScript = (id) => {
    const el = byId(id);
    if (!el) return null;
    try {
      const txt = String(el.textContent || "").trim();
      return txt ? JSON.parse(txt) : null;
    } catch {
      return null;
    }
  };

  const DEFAULT_CONFIG = {
    brand: { markText: "FF", logoUrl: "/static/images/logo.webp", accent: "#f97316" },
    org: {
      shortName: "Connect ATX Elite",
      metaLine: "Youth Basketball • Austin, TX",
      seasonLabel: "Season Fund",
      sportLabel: "Youth program",
      heroAccentLine: "Help more kids stay on the floor.",
      story: "We’re funding real season costs—gym time, travel, and gear—so families aren’t carrying the full load."
    },
    fundraiser: {
      currency: "USD",
      goal: 25000,
      raised: 0,
      donors: 0,
      deadlineISO: "2026-02-28T23:59:59-06:00",
      match: { active: false, copy: "Match active: gifts are doubled up to a cap." },
    },
    events: [{ title: "Next tournament weekend", startISO: "2026-01-17T09:00:00-06:00" }],
    allocation: [
      { label: "Travel + tournament fees", pct: 35 },
      { label: "Gym time + coaching", pct: 25 },
      { label: "Uniforms + gear", pct: 20 },
      { label: "Snacks + training", pct: 10 },
      { label: "Scholarships", pct: 10 },
    ],
    impactOptions: [
      { id: "gear", tag: "Gear", amount: 75, title: "Uniforms + gear", desc: "Helps cover shoes, uniforms, and practice gear so every athlete is equipped.", hint: "Tap to donate $75", purpose: "donation" },
      { id: "gym", tag: "Gym time", amount: 150, title: "Practice gym time", desc: "Keeps consistent practice slots available for the whole program.", hint: "Tap to donate $150", purpose: "donation" },
      { id: "travel", tag: "Travel", amount: 250, title: "Tournament travel", desc: "Offsets hotels, entry fees, and travel costs that add up fast.", hint: "Tap to donate $250", purpose: "donation" },
      { id: "scholar", tag: "Scholarship", amount: 500, title: "Sponsor a scholarship", desc: "Helps a family cover season costs so a player can stay in the program.", hint: "Tap to donate $500", purpose: "donation" },
      { id: "vip", tag: "VIP", amount: 1000, title: "Become a VIP sponsor", desc: "Premium recognition on the leaderboard + share-ready sponsor message.", hint: "Tap to sponsor $1,000", purpose: "sponsor" },
      { id: "coach", tag: "Coaching", amount: 2000, title: "Support coaching + training", desc: "Supports coaches, training resources, and skill development for the season.", hint: "Tap to donate $2,000", purpose: "donation" },
    ],
    teams: [
      { id: "all", name: "All teams", blurb: "Maximum flexibility—funds support the whole program.", img: "", featured: true, needs: false, raised: 0, goal: 25000 },
      { id: "t12u", name: "12U", blurb: "Building fundamentals and confidence—big growth year.", img: "", featured: true, needs: true, raised: 0, goal: 6000 },
      { id: "t14u", name: "14U", blurb: "Competitive schedule with travel + tournament fees.", img: "", featured: true, needs: true, raised: 0, goal: 8000 },
      { id: "t16u", name: "16U", blurb: "High-intensity season prep and showcase weekends.", img: "", featured: false, needs: true, raised: 0, goal: 7000 },
      { id: "t18u", name: "18U", blurb: "Final season push—support travel, gym time, and scholarships.", img: "", featured: false, needs: false, raised: 0, goal: 4000 },
      { id: "skills", name: "Skills Program", blurb: "Off-season training, shooting reps, and strength work.", img: "", featured: false, needs: false, raised: 0, goal: 2000 },
    ],
    sponsorSpotlight: { active: true, title: "Local business spotlight", copy: "Sponsors get VIP placement + a ready-to-post sponsor message." },
    sponsorWall: [
      { name: "Acme Realty", meta: "Platinum sponsor", amount: 2500 },
      { name: "Southside Dental", meta: "Gold sponsor", amount: 1000 },
      { name: "Hill Country Fitness", meta: "Gold sponsor", amount: 1000 },
      { name: "Community Bank", meta: "Silver sponsor", amount: 500 },
    ],
    sponsorTiers: [
      { id: "silver", title: "Silver sponsor", amount: 250, desc: "Name listed on sponsor leaderboard + share-ready sponsor message.", perks: ["Leaderboard listing", "Receipt-ready", "Share kit"] },
      { id: "gold", title: "Gold sponsor", amount: 500, desc: "Higher placement + highlighted badge on the leaderboard.", perks: ["Priority placement", "Highlighted badge", "Share kit"] },
      { id: "platinum", title: "Platinum sponsor", amount: 1000, desc: "Top-tier recognition + spotlight eligibility.", perks: ["Top placement", "Spotlight eligible", "Share kit"] },
      { id: "title", title: "Title sponsor", amount: 2500, desc: "Premium VIP recognition + featured placement.", perks: ["Featured placement", "VIP badge", "Share kit"] },
    ],
    memberships: {
      monthly: [
        { id: "m_supporter", title: "Supporter", amount: 25, desc: "Monthly support that keeps gym time consistent.", badge: "Most popular" },
        { id: "m_booster", title: "Booster", amount: 50, desc: "Helps with travel + tournament fees over the season.", badge: "" },
        { id: "m_vip", title: "VIP", amount: 100, desc: "VIP recognition + major impact over time.", badge: "VIP" },
      ],
      annual: [
        { id: "a_supporter", title: "Supporter (Annual)", amount: 250, desc: "One annual gift that stabilizes planning.", badge: "" },
        { id: "a_booster", title: "Booster (Annual)", amount: 500, desc: "Bigger annual push for travel + gear.", badge: "Best value" },
        { id: "a_vip", title: "VIP (Annual)", amount: 1000, desc: "Premium annual support + VIP recognition.", badge: "VIP" },
      ],
    },
    updates: [
      { id: "u1", tag: "games", title: "Tournament weekend", whenISO: "2025-12-15T18:00:00-06:00", body: "Great effort this weekend. Next tournament is coming up—travel costs add up quickly." },
      { id: "u2", tag: "gear", title: "New practice gear", whenISO: "2025-12-03T12:00:00-06:00", body: "We’re refreshing practice gear so every player has what they need." },
      { id: "u3", tag: "travel", title: "Travel booked", whenISO: "2025-11-22T09:30:00-06:00", body: "Hotels + entry fees are booked. Thank you for helping keep weekends doable for families." },
    ],
    shareTemplates: {
      standard: "Support our season fundraiser—every gift helps cover gym time, travel, and gear. Donate here:",
      urgent: "We’re close to our next milestone—can you help today? Even $25 makes a difference. Donate here:",
      sponsor: "Local business owners: sponsor our youth program for premium recognition + community impact. Sponsor here:",
      membership: "Want to support monthly? Memberships stabilize season costs and help more kids stay on the floor. Join here:",
    },
    sponsorKitTemplate:
      "Hi! I’m reaching out to invite you to sponsor {ORG}. Your sponsorship helps cover gym time, travel, and gear for youth athletes.\n\nSponsors receive VIP recognition on our sponsor leaderboard and a receipt for records.\n\nSponsor here: {LINK}\n\nThank you for supporting our kids and community!",
    features: {
      recurringEnabled: true,
      membershipsEnabled: true,
      textToDonateEnabled: false,
      coverFeesEnabled: true,
      roundUpEnabled: true,
      sponsorSpotlightEnabled: true,
      liveStatusEnabled: true,
      commandPaletteEnabled: true
    },
  };

  const CONFIG = (() => {
    const raw = readJsonScript("ffConfig") || {};
    const serverCfg = (isPlainObject(raw) ? (safeClone(raw) || {}) : {});

    // If server sends empty arrays unintentionally, keep defaults instead of wiping.
    const dropEmpty = (k) => { if (Array.isArray(serverCfg[k]) && serverCfg[k].length === 0) delete serverCfg[k]; };
    ["teams","allocation","impactOptions","sponsorWall","sponsorTiers","updates","events"].forEach(dropEmpty);

    return deepMerge({}, DEFAULT_CONFIG, serverCfg);
  })();

  const state = {
    cfg: CONFIG,
    stripe: null,
    elements: null,
    clientSecret: "",
    checkoutReady: false,
    selected: {
      purpose: "donation",
      frequency: "once",
      amount: 0,
      teamId: "",
      tierId: "",
      membershipPlan: "",
      ref: "",
    },
    totals: { base: 0, roundUp: 0, fees: 0, total: 0 },
    activityMode: "gifts",
    lastStatusAt: null,
  };

  setCssBrand(state.cfg.brand?.accent);

  /* =========================
    Ref code from URL
  ========================= */

  function setRefFromUrl() {
    let ref = "";
    try { ref = (new URL(window.location.href)).searchParams.get("ref") || ""; } catch {}
    ref = String(ref || "").trim();
    if (!ref) return "";

    state.selected.ref = ref;

    safeRemoveAttr(byId("refPill"), "hidden");
    safeText(byId("refCodeText"), ref);

    safeRemoveAttr(byId("refNotice"), "hidden");
    safeText(byId("refNoticeCode"), ref);

    safeValue(byId("refCodeInput"), ref);
    return ref;
  }
  setRefFromUrl();

  /* =========================
    Static copy + branding
  ========================= */

  function initStaticCopy() {
    const { brand, org, fundraiser } = state.cfg;

    const logoUrl = String(brand?.logoUrl || "").trim();
    const markText = String(brand?.markText || "FF").trim();

    const orgName = String(org?.shortName || "Organization");
    const metaLine = String(org?.metaLine || "City • State");
    const seasonLabel = String(org?.seasonLabel || "Season Fund");
    const sportLabel = String(org?.sportLabel || "Youth program");
    const heroAccentLine = String(org?.heroAccentLine || "").trim();
    const story = String(org?.story || "").trim();

    safeText(byId("orgName"), orgName);
    safeText(byId("heroOrgLine"), `${orgName} • Fundraiser`);
    safeText(byId("orgMeta"), metaLine);
    safeText(byId("seasonPill"), seasonLabel);
    safeText(byId("sportPill"), sportLabel);

    if (heroAccentLine) safeText(byId("heroAccentLine"), heroAccentLine);
    if (story) safeText(byId("heroStory"), story);

    safeText(byId("orgPill"), orgName);
    safeText(byId("stickyOrg"), orgName);
    safeText(byId("footerOrgName"), orgName);
    safeText(byId("footerTagline"), "Fuel the season. Fund the future.");

    ensureSocialMeta(orgName);
    injectJsonLd(orgName, fundraiser?.goal, fundraiser?.raised);

    const setLogo = (imgEl) => {
      if (!imgEl) return;
      if (logoUrl) {
        imgEl.src = logoUrl;
        imgEl.hidden = false;
        return;
      }
      imgEl.hidden = true;
    };

    setLogo(byId("brandLogo"));
    setLogo(byId("heroLogo"));

    const footerLogo = byId("footerBrandLogo");
    if (footerLogo) {
      if (logoUrl) { footerLogo.src = logoUrl; footerLogo.hidden = false; }
      else footerLogo.hidden = true;
    }

    if (!logoUrl) {
      safeRemoveAttr(byId("brandMarkText"), "hidden");
      safeText(byId("brandMarkText"), markText);
      const brandLogo = byId("brandLogo");
      if (brandLogo) brandLogo.hidden = true;
    }

    safeText(byId("footerYear"), String(new Date().getFullYear()));

    const matchActive = !!state.cfg.fundraiser?.match?.active;
    if (matchActive) {
      safeRemoveAttr(byId("matchPill"), "hidden");
      safeRemoveAttr(byId("heroMatchPill"), "hidden");
      safeText(byId("matchPill"), "Match active");
      safeText(byId("heroMatchPill"), "Match active");
    }
  }
  initStaticCopy();

  /* =========================
    Nav spy (no-throw)
  ========================= */

  function initNavSpy() {
    const nav = byId("navLinks");
    if (!nav) return;

    const links = qsa('a[data-spy]', nav);
    if (!links.length || !window.IntersectionObserver) return;

    const sections = links
      .map((a) => {
        const id = (a.getAttribute("href") || "").slice(1);
        return { a, el: id ? byId(id) : null };
      })
      .filter((x) => x.el);

    if (!sections.length) return;

    const io = new IntersectionObserver(
      (entries) => {
        const visible = entries
          .filter((e) => e.isIntersecting)
          .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];
        if (!visible) return;

        const id = visible.target?.id;
        if (!id) return;

        for (const { a, el } of sections) safeAttr(a, "data-active", el?.id === id ? "true" : "false");
      },
      { rootMargin: "-30% 0px -55% 0px", threshold: [0.05, 0.1, 0.2] }
    );

    sections.forEach(({ el }) => { try { io.observe(el); } catch {} });
  }
  initNavSpy();

  /* =========================
    Allocation bars
  ========================= */

  function initAllocation() {
    const host = byId("allocationBars");
    if (!host) return;

    safeHtml(host, "");
    const items = Array.isArray(state.cfg.allocation) ? state.cfg.allocation : [];

    for (const it of items) {
      const pct = clamp(Number(it?.pct || 0), 0, 100);
      const row = document.createElement("div");
      row.className = "mini mini--compact";
      row.innerHTML = `
        <div class="cluster cluster-between" style="gap:10px;">
          <div class="help" style="font-weight:950; color:var(--text);">${escapeHtml(it?.label || "")}</div>
          <div class="help num">${pct}%</div>
        </div>
        <div class="meter" aria-hidden="true" style="margin-top:10px; height:10px;">
          <span style="width:${pct}%;"></span>
        </div>
      `;
      host.appendChild(row);
    }
  }
  initAllocation();

  /* =========================
    Donation selection + summary
  ========================= */

  function computeFeesEstimate(subtotal) {
    const pct = 0.029;
    const fixed = 0.30;
    const est = (subtotal * pct) + fixed;
    return Math.max(0, Math.round(est));
  }

  function computeRoundUp(base) {
    const next5 = Math.ceil(base / 5) * 5;
    return Math.max(0, next5 - base);
  }

  function teamLabelFromSelect() {
    const sel = byId("teamSelect");
    const val = sel?.value || "all";
    const opt = sel?.querySelector?.(`option[value="${cssEscape(val)}"]`);
    return opt ? String(opt.textContent || "").split("•")[0].trim() : "All teams";
  }

  function setSummary() {
    const currency = state.cfg.fundraiser?.currency || "USD";

    const amount = state.selected.amount || parseAmountInput(byId("amountInput")?.value);
    state.selected.amount = amount;

    const coverFees = !!byId("coverFees")?.checked;
    const roundUp = !!byId("roundUp")?.checked;

    const r = roundUp ? computeRoundUp(amount) : 0;
    const basePlus = amount + r;
    const fee = coverFees ? computeFeesEstimate(basePlus) : 0;
    const total = basePlus + fee;

    state.totals = { base: amount, roundUp: r, fees: fee, total };

    const purposeLabel =
      state.selected.purpose === "sponsor" ? "Sponsor" :
      state.selected.purpose === "membership" ? "Membership" :
      "Donation";

    safeText(byId("summaryPurpose"), purposeLabel);
    safeText(byId("summaryAmount"), fmtCurrency(amount, currency));
    safeText(byId("summaryFreq"), state.selected.frequency === "monthly" ? "Monthly" : "Once");
    safeText(byId("summaryTeam"), teamLabelFromSelect());
    safeText(byId("summaryTotal"), fmtCurrency(total, currency));

    const addOns = [
      roundUp ? `Round up: ${fmtCurrency(r, currency)}` : null,
      coverFees ? `Fees coverage: ${fmtCurrency(fee, currency)}` : null,
    ].filter(Boolean).join(" • ");
    safeText(byId("summaryAddOns"), addOns);

    const hint = (() => {
      const opts = Array.isArray(state.cfg.impactOptions) ? state.cfg.impactOptions : [];
      if (!opts.length) return "";
      const close = opts
        .map((o) => ({ o, d: Math.abs(Number(o?.amount || 0) - amount) }))
        .sort((a, b) => a.d - b.d)[0]?.o;
      if (!close) return "";
      return `Closest impact: ${close.title || "Impact"} (${fmtCurrency(close.amount || 0, currency)}).`;
    })();
    safeText(byId("summaryImpactHint"), hint);

    safeValue(byId("ffTotalHidden"), String(total));

    // keep sticky goal aligned if present
    const stickyGoal = byId("stickyGoal");
    if (stickyGoal) safeText(stickyGoal, byId("goalRow")?.textContent || fmtCurrency(state.cfg.fundraiser?.goal || 0, currency));
  }

  function setFrequencyUI(freq) {
    const set = (root) => {
      if (!root) return;
      qsa("button[data-frequency]", root).forEach((b) => {
        safeAttr(b, "aria-pressed", b.dataset.frequency === freq ? "true" : "false");
      });
    };

    set(qs("[data-ff-frequency]"));
    set(qs("[data-ff-frequency-top]"));

    safeValue(byId("frequencyHidden"), freq);
    state.selected.frequency = freq;
    setSummary();
  }

  function prefillDonation({ amount, purpose = "donation", frequency = null, tierId = "", membershipPlan = "", from = "ui" } = {}) {
    const amt = Math.max(0, Math.round(Number(amount || 0)));
    state.selected.amount = amt;
    state.selected.purpose = String(purpose || "donation");
    if (frequency) state.selected.frequency = String(frequency);

    state.selected.tierId = String(tierId || "");
    state.selected.membershipPlan = String(membershipPlan || "");

    safeValue(byId("selectedTierId"), state.selected.tierId);
    safeValue(byId("membershipPlanHidden"), state.selected.membershipPlan);
    safeValue(byId("purposeHidden"), state.selected.purpose);

    const amountInput = byId("amountInput");
    if (amountInput) amountInput.value = amt ? String(amt) : "";

    safeRemoveAttr(byId("donatePrefillPill"), "hidden");

    setFrequencyUI(state.selected.frequency);

    setSummary();
    track("prefill", { from, amount: amt, purpose: state.selected.purpose, tierId: state.selected.tierId, membershipPlan: state.selected.membershipPlan });

    const currency = state.cfg.fundraiser?.currency || "USD";
    toast("Prefilled", amt ? `Amount set to ${fmtCurrency(amt, currency)}.` : "Ready.");
  }

  on(byId("amountInput"), "input", debounce(() => {
    state.selected.amount = parseAmountInput(byId("amountInput")?.value);
    setSummary();
  }, 80), false, "amountInput");

  on(byId("roundUp"), "change", setSummary, false, "roundUpChange");
  on(byId("coverFees"), "change", setSummary, false, "coverFeesChange");

  function initAddOns() {
    if (!state.cfg.features?.roundUpEnabled) byId("roundUp")?.closest?.("label")?.classList?.add?.("hide");
    if (!state.cfg.features?.coverFeesEnabled) byId("coverFees")?.closest?.("label")?.classList?.add?.("hide");
  }
  initAddOns();

  function initFrequency() {
    const enabled = !!state.cfg.features?.recurringEnabled;
    if (!enabled) {
      safeAttr(byId("recurringRow"), "hidden", "");
      byId("donateFrequencyRow")?.classList?.add?.("hide");
      qsa('button[data-frequency="monthly"]').forEach((b) => safeAttr(b, "disabled", "disabled"));
      return;
    }
    safeRemoveAttr(byId("recurringRow"), "hidden");
  }
  initFrequency();

  /* =========================
    Impact cards
  ========================= */

  function initImpactCards() {
    const host = byId("impactGrid");
    if (!host) return;

    safeHtml(host, "");
    const items = Array.isArray(state.cfg.impactOptions) ? state.cfg.impactOptions : [];
    const currency = state.cfg.fundraiser?.currency || "USD";

    for (const it of items) {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "impact-card";
      safeAttr(btn, "role", "listitem");

      btn.innerHTML = `
        <div class="impact-top">
          <span class="tag">${escapeHtml(it?.tag || "Impact")}</span>
          <span class="pill pill-muted">Prefill</span>
        </div>
        <div class="impact-amt num">${escapeHtml(fmtCurrency(it?.amount || 0, currency))}</div>
        <div class="impact-title">${escapeHtml(it?.title || "")}</div>
        <div class="impact-desc">${escapeHtml(it?.desc || "")}</div>
        <div class="impact-hint">${escapeHtml(it?.hint || "Tap to prefill")}</div>
      `;

      on(btn, "click", () => {
        prefillDonation({ amount: Number(it?.amount || 0), purpose: String(it?.purpose || "donation"), from: "impact" });
        byId("donate")?.scrollIntoView?.({ behavior: "smooth", block: "start" });
      }, false, `impact:${it?.id || it?.title || Math.random()}`);

      host.appendChild(btn);
    }
  }
  initImpactCards();

  /* =========================
    Updates (safe + no duplicate listeners)
  ========================= */

  function initUpdates() {
    const allHost = byId("updatesList");
    if (!allHost) return;

    const all = Array.isArray(state.cfg.updates) ? state.cfg.updates : [];
    const byTag = {
      games: byId("updatesGames"),
      travel: byId("updatesTravel"),
      gear: byId("updatesGear"),
    };

    const renderList = (items, container) => {
      if (!container) return;
      safeHtml(container, "");

      if (!items.length) {
        const empty = document.createElement("div");
        empty.className = "notice";
        empty.innerHTML = `<div class="kicker">No updates</div><p class="help">Check back soon.</p>`;
        container.appendChild(empty);
        return;
      }

      for (const u of items) {
        const when = u?.whenISO ? new Date(u.whenISO) : null;
        const metaTxt = when && !Number.isNaN(+when)
          ? when.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" })
          : "";

        const el = document.createElement("div");
        el.className = "update";
        el.innerHTML = `
          <div class="update-top">
            <div>
              <div class="update-title">${escapeHtml(u?.title || "Update")}</div>
              <div class="help" style="margin-top:.25rem;">${escapeHtml(String(u?.tag || ""))}</div>
            </div>
            <div class="update-meta">${escapeHtml(metaTxt)}</div>
          </div>
          <p>${escapeHtml(u?.body || "")}</p>
          <div class="update-actions">
            <button class="btn btn-secondary btn-sm" type="button" data-ff-share-open>Share</button>
            <button class="btn btn-ghost btn-sm" type="button" data-ff-copy-link>Copy link</button>
          </div>
        `;
        container.appendChild(el);
      }
    };

    renderList(all, allHost);
    Object.keys(byTag).forEach((tag) => renderList(all.filter((x) => String(x?.tag || "") === tag), byTag[tag]));

    const tabs = byId("updatesTabs");
    if (!tabs) return;

    on(tabs, "click", (e) => {
      const btn = e.target?.closest?.("button[data-tab]");
      if (!btn) return;

      const tab = btn.dataset.tab || "all";
      const panels = {
        all: byId("updatesAll"),
        games: byId("updatesGames"),
        travel: byId("updatesTravel"),
        gear: byId("updatesGear"),
      };

      qsa("button[data-tab]", tabs).forEach((b) => safeAttr(b, "aria-selected", b === btn ? "true" : "false"));
      Object.entries(panels).forEach(([k, p]) => { if (p) p.hidden = k !== tab; });
    }, false, "updatesTabsClick");
  }
  initUpdates();

  /* =========================
    Teams (one-time init; null-safe)
  ========================= */

  function initTeams() {
    const grid = byId("teamsGrid");
    const select = byId("teamSelect");
    const pill = byId("teamsFilterPill");
    const empty = byId("teamsEmpty");
    if (!grid || !select) return;

    const items = Array.isArray(state.cfg.teams) ? state.cfg.teams : [];
    const teams = items.filter((t) => t && t.id && t.id !== "all");

    safeHtml(select, `<option value="all">All teams • Support the full program</option>`);
    for (const t of teams) {
      const opt = document.createElement("option");
      opt.value = String(t.id);
      opt.textContent = String(t.name || t.id);
      select.appendChild(opt);
    }

    safeText(byId("teamsCount"), String(teams.length));
    safeText(byId("teamsFeaturedCount"), String(teams.filter((t) => !!t.featured).length));
    safeText(byId("teamsNeedsCount"), String(teams.filter((t) => !!t.needs).length));

    const filterState = { mode: "all", q: "" };

    const setPill = () => {
      const map = { all: "All teams", featured: "Featured", needs: "Needing support" };
      if (pill) safeText(pill, map[filterState.mode] || "All teams");
    };

    const render = () => {
      const q = filterState.q.trim().toLowerCase();
      let list = teams.slice();

      if (filterState.mode === "featured") list = list.filter((t) => !!t.featured);
      if (filterState.mode === "needs") list = list.filter((t) => !!t.needs);
      if (q) list = list.filter((t) => String(t.name || "").toLowerCase().includes(q));

      safeHtml(grid, "");

      if (!list.length) {
        if (empty) safeRemoveAttr(empty, "hidden");
        return;
      }
      if (empty) safeAttr(empty, "hidden", "");

      const currency = state.cfg.fundraiser?.currency || "USD";

      for (const t of list) {
        const card = document.createElement("article");
        card.className = "team-card lift";

        const raised = Number(t.raised || 0);
        const goal = Number(t.goal || 0);
        const pct = goal > 0 ? clamp((raised / goal) * 100, 0, 100) : 0;

        card.innerHTML = `
          <div class="team-media">${t.img ? `<img class="team-img" src="${escapeHtml(t.img)}" alt="" loading="lazy" decoding="async" />` : ""}</div>
          <div class="team-body">
            <div class="team-head">
              <div style="min-width:0;">
                <div class="team-name">${escapeHtml(t.name || "")}</div>
                <div class="team-blurb">${escapeHtml(t.blurb || "")}</div>
              </div>
              <div class="team-raise">
                <div class="kicker">Raised</div>
                <div class="num" style="font-weight:950; font-size:var(--t-md);">${escapeHtml(fmtCurrency(raised, currency))}</div>
              </div>
            </div>
            <div class="divider" aria-hidden="true"></div>
            <div class="meter" aria-hidden="true" style="height:10px;"><span style="width:${pct}%;"></span></div>
            <div class="stat-row" style="margin-top:10px;">
              <span>${escapeHtml(fmtPct(pct))}</span>
              <span class="help">Goal: <span class="num">${escapeHtml(fmtCurrency(goal, currency))}</span></span>
            </div>
            <div class="inline-actions" style="margin-top:12px;">
              <button class="btn btn-primary btn-sm" type="button" data-team-pick="${escapeHtml(t.id)}">Donate to ${escapeHtml(t.name || "team")}</button>
              <button class="btn btn-ghost btn-sm" type="button" data-ff-share-open>Share</button>
            </div>
          </div>
        `;

        grid.appendChild(card);
      }

      qsa("button[data-team-pick]", grid).forEach((b) => {
        on(b, "click", () => {
          const id = b.getAttribute("data-team-pick") || "";
          select.value = id;
          select.dispatchEvent(new Event("change", { bubbles: true }));
          byId("donate")?.scrollIntoView?.({ behavior: "smooth", block: "start" });
          toast("Team selected", "Donation will be tagged to that team.");
          track("team_pick", { teamId: id });
        }, false, `teamPick:${b.getAttribute("data-team-pick")}`);
      });
    };

    on(byId("teamSearch"), "input", debounce((e) => {
      filterState.q = String(e.target?.value || "");
      render();
    }, 120), false, "teamSearchInput");

    const filter = byId("teamFilter");
    on(filter, "click", (e) => {
      const btn = e.target?.closest?.("button[data-team-filter]");
      if (!btn) return;

      filterState.mode = btn.dataset.teamFilter || "all";
      qsa("button[data-team-filter]", filter).forEach((x) => safeAttr(x, "aria-pressed", x === btn ? "true" : "false"));
      setPill();
      render();
    }, false, "teamFilterClick");

    on(select, "change", () => {
      const val = select.value || "all";
      safeValue(byId("selectedTeamId"), val === "all" ? "" : val);
      state.selected.teamId = val === "all" ? "" : val;
      setSummary();
      track("team_select", { teamId: state.selected.teamId || "all" });
    }, false, "teamSelectChange");

    setPill();
    render();
  }
  initTeams();

  /* =========================
    Sponsors
  ========================= */

  function initSponsors() {
    const tiersHost = byId("sponsorTiers");
    const currency = state.cfg.fundraiser?.currency || "USD";

    if (tiersHost) {
      safeHtml(tiersHost, "");
      const tiers = Array.isArray(state.cfg.sponsorTiers) ? state.cfg.sponsorTiers : [];

      for (const t of tiers) {
        const card = document.createElement("article");
        card.className = "tier lift";
        safeAttr(card, "role", "listitem");

        card.innerHTML = `
          <div class="tier-row">
            <div>
              <div class="kicker">${escapeHtml(t?.title || "Tier")}</div>
              <div class="tier-price num">${escapeHtml(fmtCurrency(t?.amount || 0, currency))}</div>
            </div>
            <span class="pill pill-accent">Sponsor</span>
          </div>
          <div class="tier-desc">${escapeHtml(t?.desc || "")}</div>
          <ul class="help" style="margin:.75rem 0 0; padding-left:1.1rem;">
            ${(Array.isArray(t?.perks) ? t.perks : []).slice(0, 4).map((p) => `<li>${escapeHtml(p)}</li>`).join("")}
          </ul>
          <div class="inline-actions" style="margin-top:12px;">
            <button class="btn btn-primary btn-sm" type="button" data-tier="${escapeHtml(t?.id || "")}" data-amt="${escapeHtml(String(t?.amount || 0))}">Choose tier</button>
            <button class="btn btn-ghost btn-sm" type="button" data-open-sponsor-kit="true">Sponsor kit</button>
          </div>
        `;
        tiersHost.appendChild(card);
      }

      qsa("button[data-tier]", tiersHost).forEach((b) => {
        on(b, "click", () => {
          const amt = Number(b.getAttribute("data-amt") || 0);
          const tierId = b.getAttribute("data-tier") || "";
          prefillDonation({ amount: amt, purpose: "sponsor", tierId, from: "tier" });
          byId("donate")?.scrollIntoView?.({ behavior: "smooth", block: "start" });
        }, false, `tier:${b.getAttribute("data-tier")}`);
      });
    }

    const wall = byId("sponsorWall");
    if (wall) {
      safeHtml(wall, "");
      const sponsors = Array.isArray(state.cfg.sponsorWall) ? state.cfg.sponsorWall : [];
      sponsors.forEach((s, idx) => {
        const row = document.createElement("div");
        row.className = "leader";
        row.innerHTML = `
          <div class="leader-left">
            <div class="rank num">${idx + 1}</div>
            <div style="min-width:0;">
              <div class="leader-name">${escapeHtml(s?.name || "Sponsor")}</div>
              <div class="leader-meta">${escapeHtml(s?.meta || "")}</div>
            </div>
          </div>
          <div class="leader-amt num">${escapeHtml(fmtCurrency(s?.amount || 0, currency))}</div>
        `;
        wall.appendChild(row);
      });
    }

    if (state.cfg.features?.sponsorSpotlightEnabled && state.cfg.sponsorSpotlight?.active) {
      safeRemoveAttr(byId("sponsorSpotlightPill"), "hidden");
      safeText(byId("spotlightTitle"), state.cfg.sponsorSpotlight?.title || "Spotlight");
      safeText(byId("spotlightCopy"), state.cfg.sponsorSpotlight?.copy || "");
    } else {
      safeAttr(byId("sponsorSpotlightPill"), "hidden", "");
    }
  }
  initSponsors();

  /* =========================
    Memberships
  ========================= */

  let membershipBilling = "monthly";

  function renderMembershipGrid(host, billing) {
    if (!host) return;
    safeHtml(host, "");

    const currency = state.cfg.fundraiser?.currency || "USD";
    const items = (billing === "annual" ? state.cfg.memberships?.annual : state.cfg.memberships?.monthly) || [];

    for (const p of items) {
      const card = document.createElement("button");
      card.type = "button";
      card.className = "impact-card";
      safeAttr(card, "role", "listitem");

      card.innerHTML = `
        <div class="impact-top">
          <span class="tag">${escapeHtml(p?.badge || (billing === "annual" ? "Annual" : "Monthly"))}</span>
          <span class="pill pill-muted">Membership</span>
        </div>
        <div class="impact-amt num">${escapeHtml(fmtCurrency(p?.amount || 0, currency))}</div>
        <div class="impact-title">${escapeHtml(p?.title || "")}</div>
        <div class="impact-desc">${escapeHtml(p?.desc || "")}</div>
        <div class="impact-hint">Tap to select</div>
      `;

      on(card, "click", () => {
        const freq = billing === "annual" ? "once" : "monthly";
        prefillDonation({
          amount: Number(p?.amount || 0),
          purpose: "membership",
          frequency: freq,
          membershipPlan: String(p?.id || ""),
          from: "membership",
        });
        closeModal("membershipsModal");
        byId("donate")?.scrollIntoView?.({ behavior: "smooth", block: "start" });
      }, false, `membership:${p?.id || p?.title}`);

      host.appendChild(card);
    }
  }

  function syncMembershipBillingButtons() {
    const set = (root) => {
      if (!root) return;
      qsa("button[data-membership-billing]", root).forEach((b) => {
        safeAttr(b, "aria-pressed", b.dataset.membershipBilling === membershipBilling ? "true" : "false");
      });
    };
    set(byId("membershipBilling"));
    set(byId("membershipsModalBilling"));
  }

  function initMemberships() {
    const enabled = !!state.cfg.features?.membershipsEnabled;
    if (!enabled) {
      byId("memberships")?.classList?.add?.("hide");
      return;
    }

    const billing = byId("membershipBilling");
    const grid = byId("membershipGrid");
    const modalGrid = byId("membershipsModalGrid");
    const modalBilling = byId("membershipsModalBilling");

    on(billing, "click", (e) => {
      const btn = e.target?.closest?.("button[data-membership-billing]");
      if (!btn) return;
      membershipBilling = btn.dataset.membershipBilling || "monthly";
      syncMembershipBillingButtons();
      renderMembershipGrid(grid, membershipBilling);
      track("membership_billing_toggle", { billing: membershipBilling });
    }, false, "membershipBillingClick");

    on(modalBilling, "click", (e) => {
      const btn = e.target?.closest?.("button[data-membership-billing]");
      if (!btn) return;
      membershipBilling = btn.dataset.membershipBilling || "monthly";
      syncMembershipBillingButtons();
      renderMembershipGrid(modalGrid, membershipBilling);
    }, false, "membershipModalBillingClick");

    renderMembershipGrid(grid, membershipBilling);
    renderMembershipGrid(modalGrid, membershipBilling);
    syncMembershipBillingButtons();
  }
  initMemberships();

  function openMemberships() {
    if (!state.cfg.features?.membershipsEnabled) return;
    syncMembershipBillingButtons();
    renderMembershipGrid(byId("membershipsModalGrid"), membershipBilling);
    openModal("membershipsModal");
    track("memberships_open", {});
  }

  /* =========================
    Events
  ========================= */

  function initEvents() {
    const setEvent = (ev) => {
      safeText(byId("eventTitle"), ev?.title || "Upcoming event");
      const tick = () => {
        safeText(byId("eventCountdown"), `Starts in ${friendlyCountdown(ev?.startISO)}`);
      };
      tick();
      setInterval(tick, 20_000);
    };

    const local = Array.isArray(state.cfg.events) ? state.cfg.events : [];
    if (local[0]) setEvent(local[0]);

    fetchJson(getEventsEndpoint(), { method: "GET", timeoutMs: 7000 })
      .then((data) => {
        const ev = data?.events?.[0] || data?.[0] || null;
        if (ev?.title && ev?.startISO) setEvent(ev);
      })
      .catch(() => {});
  }
  initEvents();

  /* =========================
    QR
  ========================= */

  function initQr() {
    const img = byId("donateQr");
    if (!img) return;

    const ep = getQrEndpoint();
    let link;
    try {
      link = new URL(window.location.href);
      link.hash = "";
      if (state.selected.ref) link.searchParams.set("ref", state.selected.ref);
    } catch {
      return;
    }

    if (ep) {
      try {
        const u = new URL(ep, window.location.origin);
        u.searchParams.set("target", link.toString());
        img.src = u.toString();
        return;
      } catch {}
    }

    try {
      const google = new URL("https://chart.googleapis.com/chart");
      google.searchParams.set("cht", "qr");
      google.searchParams.set("chs", "220x220");
      google.searchParams.set("chl", link.toString());
      img.src = google.toString();
    } catch {}
  }
  initQr();

  /* =========================
    Text-to-donate
  ========================= */

  function initTextToDonate() {
    const card = byId("textDonateCard");
    if (!card) return;

    const phone = (meta("ff-text-to-donate-phone") || "").trim();
    const keyword = (meta("ff-text-to-donate-keyword") || "").trim();
    const enabled = !!state.cfg.features?.textToDonateEnabled && phone && keyword;

    if (!enabled) { card.hidden = true; return; }
    card.hidden = false;

    safeText(byId("textDonatePhone"), phone);
    safeText(byId("textDonateKeyword"), keyword);

    const sms = byId("textDonateSmsLink");
    if (sms) sms.href = `sms:${encodeURIComponent(phone)}?&body=${encodeURIComponent(keyword)}`;

    on(byId("textDonateCopy"), "click", async () => {
      await copyText(`${keyword} → ${phone}`);
      toast("Copied", "Text-to-donate copied.");
    }, false, "textDonateCopy");
  }
  initTextToDonate();

  /* =========================
    Progress UI (NO null throws)
  ========================= */

  function initProgressUI() {
    const currency = state.cfg.fundraiser?.currency || "USD";
    const goal = Number(state.cfg.fundraiser?.goal || 0);
    const raised = Number(state.cfg.fundraiser?.raised || 0);
    const donors = Number(state.cfg.fundraiser?.donors || 0);
    const pct = goal > 0 ? clamp((raised / goal) * 100, 0, 100) : 0;

    safeText(byId("goalPill"), fmtCurrency(goal, currency));
    safeText(byId("goalRow"), fmtCurrency(goal, currency));
    safeText(byId("raisedBig"), fmtCurrency(raised, currency));
    safeText(byId("raisedRow"), fmtCurrency(raised, currency));
    safeText(byId("pctText"), String(Math.round(pct)));

    const overallBar = byId("overallBar");
    safeStyle(overallBar, "width", `${pct.toFixed(2)}%`);

    const meter = overallBar?.parentElement;
    if (meter) {
      safeAttr(meter, "aria-valuenow", String(Math.round(pct)));
      safeAttr(meter, "aria-valuetext", `${Math.round(pct)}% funded`);
    }

    const remaining = Math.max(0, goal - raised);
    safeText(byId("remainingText"), fmtCurrency(remaining, currency));

    safeText(byId("stickyRaised"), fmtCurrency(raised, currency));
    safeText(byId("stickyPct"), fmtPct(pct));
    safeText(byId("stickyGoal"), fmtCurrency(goal, currency));

    const avg = donors > 0 ? Math.round(raised / donors) : 0;
    safeText(byId("donorsText"), String(donors));
    safeText(byId("avgGiftText"), fmtCurrency(avg, currency));

    const dl = state.cfg.fundraiser?.deadlineISO;
    const dleft = daysLeft(dl);
    safeText(byId("daysLeftText"), dleft == null ? "—" : String(dleft));

    safeText(
      byId("deadlineText"),
      dl ? new Date(dl).toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" }) : "—"
    );

    const nextMilestone = (() => {
      const marks = [25, 50, 75, 100].map((p) => Math.round(goal * (p / 100)));
      const next = marks.find((m) => m > raised);
      return next || goal;
    })();
    safeText(byId("nextMilestoneText"), fmtCurrency(nextMilestone, currency));

    const pill = byId("countdownPill");
    if (pill && dl) {
      const tick = () => {
        const left = daysLeft(dl);
        if (left == null) safeText(pill, "Ends soon");
        else if (left === 0) safeText(pill, "Final day");
        else safeText(pill, `${left} days left`);
      };
      tick();
      setInterval(tick, 45_000);
    }

    const last = state.lastStatusAt ? new Date(state.lastStatusAt) : null;
    const upd = last && !Number.isNaN(+last)
      ? last.toLocaleTimeString(undefined, { hour: "2-digit", minute: "2-digit" })
      : "—";

    safeText(byId("lastUpdatedText"), `Updated ${upd}`);
    safeText(byId("lastUpdatedPill"), `Updated ${upd}`);

    injectJsonLd(String(state.cfg.org?.shortName || "Organization"), goal, raised);
    setSummary();
  }
  initProgressUI();

  /* =========================
    Activity segment
  ========================= */

  function renderActivity() {
    const list = byId("giftsList");
    if (!list) return;

    const currency = state.cfg.fundraiser?.currency || "USD";
    const gifts = Array.isArray(state.cfg._live?.gifts) ? state.cfg._live.gifts : [];
    const top = Array.isArray(state.cfg._live?.topDonors) ? state.cfg._live.topDonors : [];
    const refs = Array.isArray(state.cfg._live?.refLeaders) ? state.cfg._live.refLeaders : [];

    const rows = state.activityMode === "top" ? top : state.activityMode === "refs" ? refs : gifts;

    safeHtml(list, "");

    if (!rows.length) {
      const empty = document.createElement("div");
      empty.className = "gift";
      empty.innerHTML =
        `<div><div class="who">Be the first</div><div class="when">Your gift will appear here.</div></div>` +
        `<div class="amt num">${escapeHtml(fmtCurrency(state.selected.amount || 25, currency))}</div>`;
      list.appendChild(empty);
      return;
    }

    const max = 5;
    rows.slice(0, max).forEach((g) => {
      const who = state.activityMode === "refs" ? (g?.name || "Supporter") : (g?.name || "Donor");
      const when = g?.when ? new Date(g.when) : (g?.whenISO ? new Date(g.whenISO) : null);
      const whenTxt = when && !Number.isNaN(+when)
        ? when.toLocaleDateString(undefined, { month: "short", day: "numeric" })
        : (g?.meta || "");

      const amt = state.activityMode === "refs" ? Number(g?.count || 0) : Number(g?.amount || 0);
      const right = state.activityMode === "refs" ? `${amt} shares` : fmtCurrency(amt, currency);

      const el = document.createElement("div");
      el.className = "gift";
      el.innerHTML = `
        <div>
          <div class="who">${escapeHtml(String(who).slice(0, 26))}</div>
          <div class="when">${escapeHtml(String(whenTxt || ""))}</div>
        </div>
        <div class="amt num">${escapeHtml(String(right))}</div>
      `;
      list.appendChild(el);
    });
  }

  function initActivitySegment() {
    const seg = byId("activitySeg");
    if (!seg) return;

    on(seg, "click", (e) => {
      const btn = e.target?.closest?.("button[data-activity]");
      if (!btn) return;

      state.activityMode = btn.dataset.activity || "gifts";
      qsa("button[data-activity]", seg).forEach((b) => safeAttr(b, "aria-pressed", b === btn ? "true" : "false"));
      renderActivity();
      track("activity_mode", { mode: state.activityMode });
    }, false, "activitySegClick");
  }
  initActivitySegment();

  function initActivityDefaults() {
    if (!state.cfg._live) state.cfg._live = {};
    if (!Array.isArray(state.cfg._live.gifts) || !state.cfg._live.gifts.length) {
      state.cfg._live.gifts = [
        { name: "Supporter", when: new Date(Date.now() - 1000 * 60 * 60 * 3).toISOString(), amount: 75 },
        { name: "Donor", when: new Date(Date.now() - 1000 * 60 * 60 * 22).toISOString(), amount: 150 },
        { name: "Anonymous", when: new Date(Date.now() - 1000 * 60 * 60 * 30).toISOString(), amount: 25 },
      ];
    }
    renderActivity();
  }
  initActivityDefaults();

  /* =========================
    Share modal (preview + links)
  ========================= */

  function canonicalUrlWithRef() {
    const u = new URL(canonicalUrl());
    const ref = String(state.selected.ref || "").trim();
    if (ref) u.searchParams.set("ref", ref);
    return u.toString();
  }

  function updateSharePreview() {
    const variant = byId("shareVariant")?.value || "standard";
    const base =
      state.cfg.shareTemplates?.[variant] ||
      state.cfg.shareTemplates?.standard ||
      "";

    const url = canonicalUrlWithRef();
    const msg = `${base} ${url}`.trim();

    safeText(byId("sharePreviewText"), msg);

    const encMsg = encodeURIComponent(msg);
    const encUrl = encodeURIComponent(url);

    const x = byId("shareX");
    const fb = byId("shareFb");
    const em = byId("shareEmail");

    if (x) x.href = `https://twitter.com/intent/tweet?text=${encMsg}`;
    if (fb) fb.href = `https://www.facebook.com/sharer/sharer.php?u=${encUrl}`;
    if (em) em.href = `mailto:?subject=${encodeURIComponent(document.title)}&body=${encMsg}`;
  }

  on(byId("shareVariant"), "change", updateSharePreview, false, "shareVariantChange");

  on(byId("shareCopyBtn"), "click", async () => {
    await copyLink();
    toast("Copied", "Fundraiser link copied.");
  }, false, "shareCopyBtn");

  on(byId("shareNativeBtn"), "click", async () => {
    const text = byId("sharePreviewText")?.textContent || "";
    const url = canonicalUrlWithRef();

    if (navigator.share) {
      try {
        await navigator.share({ title: document.title, text, url });
        track("native_share", { ok: true });
        closeModal("shareModal");
        return;
      } catch {
        track("native_share", { ok: false });
      }
    }
    toast("Share not available", "Copy the link instead.");
  }, false, "shareNativeBtn");

  /* =========================
    Copy helpers
  ========================= */

  async function copyText(txt) {
    const t = String(txt || "");
    if (!t) return false;

    try {
      if (navigator.clipboard?.writeText) {
        await navigator.clipboard.writeText(t);
        return true;
      }
    } catch {}

    const ta = document.createElement("textarea");
    ta.value = t;
    ta.setAttribute("readonly", "");
    ta.style.position = "fixed";
    ta.style.top = "-9999px";
    document.body.appendChild(ta);

    try {
      ta.select();
      document.execCommand("copy");
    } catch {}

    try { ta.remove(); } catch {}
    return true;
  }

  async function copyLink() {
    let url;
    try {
      url = new URL(window.location.href);
      url.hash = "";
      if (state.selected.ref) url.searchParams.set("ref", state.selected.ref);
    } catch {
      return copyText(String(window.location.href || ""));
    }
    await copyText(url.toString());
  }

  on(byId("copyUpdateTemplate"), "click", async () => {
    const txt = byId("updateTemplateText")?.textContent || "";
    await copyText(txt);
    toast("Copied", "Update template copied.");
    track("copy_update_template", {});
  }, false, "copyUpdateTemplate");

  /* =========================
    Sponsor kit
  ========================= */

  function openSponsorKit() {
    const org = String(state.cfg.org?.shortName || "Organization");

    let link = canonicalUrlWithRef();
    safeValue(byId("sponsorKitLink"), link);

    const tpl = String(state.cfg.sponsorKitTemplate || "");
    const msg = tpl.replaceAll("{ORG}", org).replaceAll("{LINK}", link);
    safeValue(byId("sponsorKitCaption"), msg);

    const copyLinkBtn = byId("sponsorKitCopyLink");
    const copyMsgBtn = byId("sponsorKitCopyCaption");

    on(copyLinkBtn, "click", async () => {
      await copyText(link);
      toast("Copied", "Sponsor link copied.");
      track("sponsor_kit_copy_link", {});
    }, { once: true }, "sponsorKitCopyLinkOnce");

    on(copyMsgBtn, "click", async () => {
      await copyText(msg);
      toast("Copied", "Sponsor message copied.");
      track("sponsor_kit_copy_msg", {});
    }, { once: true }, "sponsorKitCopyMsgOnce");

    openModal("sponsorKitModal");
    track("sponsor_kit_open", {});
  }

  /* =========================
    Command palette
  ========================= */

  const COMMANDS = [
    { id: "donate", label: "Go to Donate", hint: "Jump to donation form", run: () => { location.hash = "#donate"; closeModal("commandModal"); } },
    { id: "copy", label: "Copy fundraiser link", hint: "Copies link (with ref if present)", run: async () => { await copyLink(); toast("Copied", "Link copied."); closeModal("commandModal"); } },
    { id: "share", label: "Open Share", hint: "Share modal + templates", run: () => { closeModal("commandModal"); openModal("shareModal"); updateSharePreview(); } },
    { id: "trust", label: "Open Trust center", hint: "Security, receipts, privacy", run: () => { closeModal("commandModal"); openModal("trustModal"); } },
    { id: "sponsor", label: "Open Sponsor kit", hint: "Copy sponsor message + link", run: () => { closeModal("commandModal"); openSponsorKit(); } },
    { id: "memberships", label: "Pick a membership", hint: "Monthly/annual plans", run: () => { closeModal("commandModal"); openMemberships(); } },
    { id: "theme", label: "Toggle theme", hint: "Light/dark", run: () => { byId("themeToggle")?.click?.(); closeModal("commandModal"); } },
  ];

  function buildCommandList() {
    const host = byId("commandList");
    const input = byId("commandSearch");
    if (!host || !input) return;

    const render = (q = "") => {
      const query = String(q || "").trim().toLowerCase();
      safeHtml(host, "");

      const list = COMMANDS
        .filter((c) => !query || c.label.toLowerCase().includes(query) || String(c.hint || "").toLowerCase().includes(query))
        .slice(0, 9);

      if (!list.length) {
        const row = document.createElement("div");
        row.className = "mini mini--soft";
        row.innerHTML = `<div class="kicker">No matches</div><div class="help">Try a different query.</div>`;
        host.appendChild(row);
        return;
      }

      list.forEach((c, idx) => {
        const row = document.createElement("button");
        row.type = "button";
        row.className = "mini mini--soft";
        row.style.textAlign = "left";
        safeAttr(row, "role", "option");
        row.dataset.cmd = c.id;

        row.innerHTML = `
          <div class="cluster cluster-between" style="align-items:flex-start;">
            <div style="min-width:0;">
              <div style="font-weight:950; letter-spacing:-.02em;">${escapeHtml(c.label)}</div>
              <div class="help">${escapeHtml(c.hint || "")}</div>
            </div>
            <span class="pill pill-muted">Enter</span>
          </div>
        `;

        on(row, "click", () => c.run(), false, `cmdClick:${c.id}`);
        if (idx === 0) row.dataset.primary = "true";
        host.appendChild(row);
      });
    };

    on(input, "input", () => render(input.value), false, "commandSearchInput");
    on(input, "keydown", (e) => {
      if (e.key !== "Enter") return;
      const primary = host.querySelector?.('[data-primary="true"]');
      const id = primary?.dataset?.cmd;
      const cmd = COMMANDS.find((c) => c.id === id);
      if (cmd) { e.preventDefault(); cmd.run(); }
    }, false, "commandSearchEnter");

    render("");
  }

  function openCommandPalette() {
    if (!state.cfg.features?.commandPaletteEnabled) return;
    buildCommandList();
    openModal("commandModal");

    const input = byId("commandSearch");
    if (input) {
      input.value = "";
      input.dispatchEvent(new Event("input", { bubbles: true }));
      input.focus?.();
    }
    track("command_open", {});
  }

  /* =========================
    Form purpose hidden fields (keep synced; safe)
  ========================= */

  function syncPurposeHidden() {
    safeValue(byId("purposeHidden"), state.selected.purpose || "donation");
    safeValue(byId("selectedTierId"), state.selected.tierId || "");
    safeValue(byId("membershipPlanHidden"), state.selected.membershipPlan || "");
  }
  setInterval(syncPurposeHidden, 800);

  /* =========================
    Progress default amount
  ========================= */

  (function initProgressActions() {
    const a = byId("amountInput");
    if (a && !a.value) {
      state.selected.amount = Number(state.cfg.impactOptions?.[0]?.amount || 75);
      a.value = String(state.selected.amount);
      setSummary();
    }
  })();

  /* =========================
    Netbar (offline detection)
  ========================= */

  (function initNetbar() {
    const bar = byId("netbar");
    const dismiss = byId("netbarDismiss");
    if (!bar) return;

    const set = (show) => { bar.hidden = !show; };

    const update = () => set(navigator.onLine === false);

    on(window, "online", update, false, "netbarOnline");
    on(window, "offline", update, false, "netbarOffline");

    on(dismiss, "click", () => set(false), false, "netbarDismiss");

    update();
  })();

  /* =========================
    Live status refresh (safe re-init)
  ========================= */

  async function refreshStatusFromServer({ silent = true } = {}) {
    if (!state.cfg.features?.liveStatusEnabled) return;

    try {
      const data = await fetchJson(getStatusEndpoint(), { method: "GET", timeoutMs: 9000 });

      const cfgPatch = {};
      if (data?.brand) cfgPatch.brand = data.brand;
      if (data?.org) cfgPatch.org = data.org;
      if (data?.fundraiser) cfgPatch.fundraiser = data.fundraiser;
      if (nonEmptyArray(data?.allocation)) cfgPatch.allocation = data.allocation;
      if (nonEmptyArray(data?.impactOptions)) cfgPatch.impactOptions = data.impactOptions;
      if (nonEmptyArray(data?.teams)) cfgPatch.teams = data.teams;
      if (nonEmptyArray(data?.sponsorWall)) cfgPatch.sponsorWall = data.sponsorWall;
      if (nonEmptyArray(data?.sponsorTiers)) cfgPatch.sponsorTiers = data.sponsorTiers;
      if (data?.memberships) cfgPatch.memberships = data.memberships;
      if (nonEmptyArray(data?.updates)) cfgPatch.updates = data.updates;

      cfgPatch._live = {
        gifts: data?.gifts || data?.recentGifts || [],
        topDonors: data?.topDonors || data?.top || [],
        refLeaders: data?.refLeaders || data?.ambassadors || [],
      };

      

      // Optional: if status doesn't include teams, load once from teams endpoint
      if (!state.__teamsEndpointLoaded && !nonEmptyArray(cfgPatch.teams)) {
        const ep = getTeamsEndpoint();
        if (ep) {
          try {
            const tRes = await fetchJson(ep, { method: "GET", timeoutMs: 9000 });
            const teamsArr = tRes?.teams || tRes?.data?.teams || tRes;
            if (nonEmptyArray(teamsArr)) cfgPatch.teams = teamsArr;
            state.__teamsEndpointLoaded = true;
          } catch {}
        }
      }
      state.cfg = deepMerge(state.cfg, cfgPatch);
      state.lastStatusAt = data?.updatedAt || data?.updated_at || new Date().toISOString();

      setCssBrand(state.cfg.brand?.accent);
      initStaticCopy();
      initAllocation();
      initImpactCards();
      initSponsors();
      initUpdates();
      initMemberships();
      initProgressUI();
      renderActivity();
      initQr();

      if (!silent) toast("Updated", "Live fundraising status refreshed.");
    } catch (err) {
      if (!silent) toast("Update failed", err?.message || "Could not refresh.");
    }
  }

  (function initPolling() {
    refreshStatusFromServer({ silent: true });
    renderActivity();

    const every = 20_000;
    setInterval(() => refreshStatusFromServer({ silent: true }), every);
  })();

  /* =========================
    Checkout (Stripe)
  ========================= */

  function showError(msg) {
    const el = byId("formError");
    if (!el) return;
    el.style.display = "block";
    el.innerHTML =
      `<div class="kicker">Action needed</div>` +
      `<p class="help" style="margin:.35rem 0 0;">${escapeHtml(msg || "Please check the form and try again.")}</p>`;
  }

  function setCheckoutError(msg) {
    const el = byId("checkoutModalError");
    if (!el) return;
    if (!msg) { el.style.display = "none"; el.textContent = ""; return; }
    el.style.display = "block";
    el.textContent = String(msg || "Checkout error.");
  }

  async function ensureStripe() {
    if (state.stripe) return state.stripe;
    const pk = getStripePk() || state.cfg?.stripePk || "";
    if (!pk) throw new Error("Stripe publishable key missing.");
    if (typeof window.Stripe !== "function") throw new Error("Stripe.js not loaded.");
    state.stripe = window.Stripe(pk);
    return state.stripe;
  }

  function stripeAppearance() {
    const theme = document.documentElement?.getAttribute?.("data-theme") || "dark";
    const isDark = theme === "dark";
    let brand = "#f97316";
    try { brand = getComputedStyle(document.documentElement).getPropertyValue("--brand").trim() || brand; } catch {}
    return {
      theme: isDark ? "night" : "stripe",
      variables: {
        colorPrimary: brand,
        fontFamily: "Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",
        borderRadius: "14px",
      },
    };
  }

  async function createCheckoutIntent(payload) {
    const idem = uuid();
    safeValue(byId("ffIdemHidden"), idem);
    const endpoint = getCheckoutEndpoint();
    const headers = { "X-Idempotency-Key": idem };
    return fetchJson(endpoint, { method: "POST", payload, headers, timeoutMs: 15000 });
  }

  async function mountPaymentElement(clientSecret) {
    await ensureStripe();
    if (!clientSecret) throw new Error("Missing client secret.");

    state.clientSecret = clientSecret;

    const root = byId("paymentElement");
    if (!root) throw new Error("Payment element container missing.");

    safeHtml(root, "");

    state.elements = state.stripe.elements({ clientSecret, appearance: stripeAppearance() });
    const paymentElement = state.elements.create("payment");
    paymentElement.mount(root);

    state.checkoutReady = true;
    const btn = byId("payNowBtn");
    if (btn) {
      btn.disabled = false;
      safeAttr(btn, "aria-disabled", "false");
    }
  }

  function confettiBurst() {
    const host = byId("ffConfetti");
    if (!host) return;

    host.hidden = false;
    safeHtml(host, "");

    const n = 42;
    for (let i = 0; i < n; i++) {
      const p = document.createElement("i");
      const left = Math.random() * 100;
      const delay = Math.random() * 0.15;
      const dur = 1.1 + Math.random() * 0.6;
      const w = 8 + Math.random() * 8;
      const h = 10 + Math.random() * 12;

      safeStyle(p, "left", `${left.toFixed(2)}vw`);
      safeStyle(p, "animationDelay", `${delay.toFixed(2)}s`);
      safeStyle(p, "animationDuration", `${dur.toFixed(2)}s`);
      safeStyle(p, "width", `${w.toFixed(0)}px`);
      safeStyle(p, "height", `${h.toFixed(0)}px`);

      host.appendChild(p);
    }

    setTimeout(() => { host.hidden = true; safeHtml(host, ""); }, 1700);
  }

  function fillSuccessModal({ email, purpose, amount, frequency, team }) {
    safeText(byId("successEmail"), email || "—");
    safeText(byId("successPurpose"), purpose || "—");
    safeText(byId("successAmount"), amount || "—");
    safeText(byId("successFrequency"), frequency || "—");
    safeText(byId("successTeam"), team || "—");
  }

  async function startCheckout() {
    const currency = state.cfg.fundraiser?.currency || "USD";

    const amount = parseAmountInput(byId("amountInput")?.value);
    const email = String(byId("emailInput")?.value || "").trim();
    const name = String(byId("nameInput")?.value || "").trim();
    const message = String(byId("noteInput")?.value || "").trim();

    const teamId = String(byId("teamSelect")?.value || "all");
    const anonymous = !!byId("donorAnonymous")?.checked;
    const updatesOptIn = !!byId("updatesOptIn")?.checked;

    if (!amount || amount < 1) { showError("Enter a valid amount."); return; }
    if (!email || !isEmail(email)) { showError("Enter a valid email for your receipt."); return; }

    state.selected.amount = amount;

    const coverFees = !!byId("coverFees")?.checked;
    const roundUp = !!byId("roundUp")?.checked;

    const r = roundUp ? computeRoundUp(amount) : 0;
    const basePlus = amount + r;
    const fee = coverFees ? computeFeesEstimate(basePlus) : 0;
    const total = basePlus + fee;

    const payload = {
      amount: total,
      currency,
      base_amount: amount,
      round_up: r,
      cover_fees: coverFees ? fee : 0,
      purpose: state.selected.purpose || "donation",
      frequency: state.selected.frequency || "once",
      teamId: teamId === "all" ? "" : teamId,
      tierId: state.selected.tierId || "",
      membershipPlan: state.selected.membershipPlan || "",
      ref: state.selected.ref || "",
      donor: { email, name, anonymous, updatesOptIn, message },
      meta: {
        userAgent: navigator.userAgent,
        page: "fundraiser",
        idem_hint: String(byId("ffIdemHidden")?.value || ""),
      },
    };

    track("checkout_start", { purpose: payload.purpose, frequency: payload.frequency, amount: payload.amount });

    const fe = byId("formError");
    if (fe) fe.style.display = "none";

    setCheckoutError("");

    openModal("checkoutModal");

    const loading = byId("checkoutLoading");
    if (loading) loading.style.display = "block";

    const payBtn = byId("payNowBtn");
    if (payBtn) {
      payBtn.disabled = true;
      safeAttr(payBtn, "aria-disabled", "true");
    }

    try {
      const res = await createCheckoutIntent(payload);
      const clientSecret =
        res?.clientSecret ||
        res?.client_secret ||
        res?.data?.clientSecret ||
        res?.data?.client_secret;

      if (!clientSecret) throw new Error("Server did not return client secret.");

      if (loading) loading.style.display = "none";
      await mountPaymentElement(clientSecret);
      toast("Checkout ready", "Confirm payment to finish.");
    } catch (err) {
      if (loading) loading.style.display = "none";
      setCheckoutError(err?.message || "Could not start checkout.");
      track("checkout_start_failed", { message: String(err?.message || "") });
    }
  }

  async function confirmPayment() {
    if (!state.stripe || !state.elements || !state.clientSecret) return;

    const payBtn = byId("payNowBtn");
    if (payBtn) {
      payBtn.disabled = true;
      safeAttr(payBtn, "aria-disabled", "true");
    }

    setCheckoutError("");

    try {
      const { error, paymentIntent } = await state.stripe.confirmPayment({
        elements: state.elements,
        confirmParams: { return_url: canonicalUrl() },
        redirect: "if_required",
      });

      if (error) throw error;

      closeModal("checkoutModal");
      confettiBurst();

      const email = String(byId("emailInput")?.value || "").trim();
      const currency = state.cfg.fundraiser?.currency || "USD";
      const amount = fmtCurrency(state.totals.total || state.selected.amount, currency);

      const purpose =
        state.selected.purpose === "sponsor" ? "Sponsor" :
        state.selected.purpose === "membership" ? "Membership" :
        "Donation";

      const frequency = state.selected.frequency === "monthly" ? "Monthly" : "Once";
      const team = teamLabelFromSelect();

      fillSuccessModal({ email, purpose, amount, frequency, team });
      openModal("successModal");

      track("checkout_success", { pi: paymentIntent?.id || "", amount: state.totals.total || 0 });

      setTimeout(() => refreshStatusFromServer({ silent: true }), 2500);
    } catch (err) {
      setCheckoutError(err?.message || "Payment could not be confirmed.");
      if (payBtn) {
        payBtn.disabled = false;
        safeAttr(payBtn, "aria-disabled", "false");
      }
      track("checkout_confirm_failed", { message: String(err?.message || "") });
    }
  }

  on(byId("donationForm"), "submit", (e) => { e.preventDefault(); startCheckout(); }, false, "donationFormSubmit");
  on(byId("payNowBtn"), "click", () => confirmPayment(), false, "payNowClick");

  /* =========================
    Footer year (extra safety)
  ========================= */

  (function initFooterYear() {
    safeText(byId("footerYear"), String(new Date().getFullYear()));
  })();

})();
</script>

</body>
</html>
